var e;!function(e){e.Eq="=",e.Lt="<",e.Gt=">",e.GtEq=">=",e.LtEq="<="}(e||(e={}));class t{properties=[];constraints=[];addProperty(e,t){const r=this.properties.findIndex((t=>t.key===e));return r>=0?this.properties[r]={key:e,value:t}:this.properties.push({key:e,value:t}),this}addConstraint(t,r,n=e.Eq){return this.constraints.push({key:t,value:r,comparisonOperator:n}),this}getDecorations(){return{properties:this.properties,constraints:this.constraints.map((e=>`(${e.key+e.comparisonOperator+e.value})`))}}getDemandRequest(){const e=this.getDecorations();let t;t=e.constraints.length?1==e.constraints.length?e.constraints[0]:`(&${e.constraints.join("\n\t")})`:"(&)";const r={};return e.properties.forEach((e=>r[e.key]=e.value)),{constraints:t,properties:r}}parseConstraint(t){for(const r in e){const n=e[r],i=t.slice(1,-1).split(n);if(2===i.length)return{key:i[0],value:i[1],comparisonOperator:e[r]}}throw new Error(`Unable to parse constraint "${t}"`)}addDecoration(e){return e.properties&&e.properties.forEach((e=>{this.addProperty(e.key,e.value)})),e.constraints&&e.constraints.forEach((e=>{const{key:t,value:r,comparisonOperator:n}={...this.parseConstraint(e)};this.addConstraint(t,r,n)})),this}addDecorations(e){return e.forEach((e=>this.addDecoration(e))),this}}var r="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function n(e,t){return function(){return e.apply(t,arguments)}}const{toString:i}=Object.prototype,{getPrototypeOf:o}=Object,s=(a=Object.create(null),e=>{const t=i.call(e);return a[t]||(a[t]=t.slice(8,-1).toLowerCase())});var a;const c=e=>(e=e.toLowerCase(),t=>s(t)===e),u=e=>t=>typeof t===e,{isArray:l}=Array,h=u("undefined");const d=c("ArrayBuffer");const f=u("string"),p=u("function"),g=u("number"),m=e=>null!==e&&"object"==typeof e,v=e=>{if("object"!==s(e))return!1;const t=o(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},y=c("Date"),b=c("File"),w=c("Blob"),S=c("FileList"),P=c("URLSearchParams");function A(e,t,{allOwnKeys:r=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),l(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let s;for(n=0;n<o;n++)s=i[n],t.call(null,e[s],s,e)}}function O(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:r,R=e=>!h(e)&&e!==E;const _=(I="undefined"!=typeof Uint8Array&&o(Uint8Array),e=>I&&e instanceof I);var I;const j=c("HTMLFormElement"),T=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),x=c("RegExp"),k=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};A(r,((r,i)=>{!1!==t(r,i,e)&&(n[i]=r)})),Object.defineProperties(e,n)},N="abcdefghijklmnopqrstuvwxyz",B="0123456789",M={DIGIT:B,ALPHA:N,ALPHA_DIGIT:N+N.toUpperCase()+B};var D={isArray:l,isArrayBuffer:d,isBuffer:function(e){return null!==e&&!h(e)&&null!==e.constructor&&!h(e.constructor)&&p(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{const t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||i.call(e)===t||p(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&d(e.buffer),t},isString:f,isNumber:g,isBoolean:e=>!0===e||!1===e,isObject:m,isPlainObject:v,isUndefined:h,isDate:y,isFile:b,isBlob:w,isRegExp:x,isFunction:p,isStream:e=>m(e)&&p(e.pipe),isURLSearchParams:P,isTypedArray:_,isFileList:S,forEach:A,merge:function e(){const{caseless:t}=R(this)&&this||{},r={},n=(n,i)=>{const o=t&&O(r,i)||i;v(r[o])&&v(n)?r[o]=e(r[o],n):v(n)?r[o]=e({},n):l(n)?r[o]=n.slice():r[o]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&A(arguments[e],n);return r},extend:(e,t,r,{allOwnKeys:i}={})=>(A(t,((t,i)=>{r&&p(t)?e[i]=n(t,r):e[i]=t}),{allOwnKeys:i}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,s,a;const c={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),s=i.length;s-- >0;)a=i[s],n&&!n(a,e,t)||c[a]||(t[a]=e[a],c[a]=!0);e=!1!==r&&o(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:s,kindOfTest:c,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(l(e))return e;let t=e.length;if(!g(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:j,hasOwnProperty:T,hasOwnProp:T,reduceDescriptors:k,freezeMethods:e=>{k(e,((t,r)=>{if(p(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];p(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach((e=>{r[e]=!0}))};return l(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:O,global:E,isContextDefined:R,ALPHABET:M,generateString:(e=16,t=M.ALPHA_DIGIT)=>{let r="";const{length:n}=t;for(;e--;)r+=t[Math.random()*n|0];return r},isSpecCompliantForm:function(e){return!!(e&&p(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(m(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=l(e)?[]:{};return A(e,((e,t)=>{const o=r(e,n+1);!h(o)&&(i[t]=o)})),t[n]=void 0,i}}return e};return r(e,0)}},C=[],U=[],F="undefined"!=typeof Uint8Array?Uint8Array:Array,L=!1;function q(){L=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)C[t]=e[t],U[e.charCodeAt(t)]=t;U["-".charCodeAt(0)]=62,U["_".charCodeAt(0)]=63}function $(e,t,r){for(var n,i,o=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(C[(i=n)>>18&63]+C[i>>12&63]+C[i>>6&63]+C[63&i]);return o.join("")}function V(e){var t;L||q();for(var r=e.length,n=r%3,i="",o=[],s=16383,a=0,c=r-n;a<c;a+=s)o.push($(e,a,a+s>c?c:a+s));return 1===n?(t=e[r-1],i+=C[t>>2],i+=C[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=C[t>>10],i+=C[t>>4&63],i+=C[t<<2&63],i+="="),o.push(i),o.join("")}function z(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-l)-1,f>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+h],h+=d,l-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),o-=u}return(f?-1:1)*s*Math.pow(2,o-n)}function H(e,t,r,n,i,o){var s,a,c,u=8*o-i-1,l=(1<<u)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*c-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+f]=255&s,f+=p,s/=256,u-=8);e[r+f-p]|=128*g}var Y={}.toString,G=Array.isArray||function(e){return"[object Array]"==Y.call(e)};Z.TYPED_ARRAY_SUPPORT=void 0===r.TYPED_ARRAY_SUPPORT||r.TYPED_ARRAY_SUPPORT;var W=K();function K(){return Z.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function J(e,t){if(K()<t)throw new RangeError("Invalid typed array length");return Z.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Z.prototype:(null===e&&(e=new Z(t)),e.length=t),e}function Z(e,t,r){if(!(Z.TYPED_ARRAY_SUPPORT||this instanceof Z))return new Z(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return ee(this,e)}return X(this,e,t,r)}function X(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);Z.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Z.prototype:e=te(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!Z.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|ie(t,r);e=J(e,n);var i=e.write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(ne(t)){var r=0|re(t.length);return 0===(e=J(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?J(e,0):te(e,t);if("Buffer"===t.type&&G(t.data))return te(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Q(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function ee(e,t){if(Q(t),e=J(e,t<0?0:0|re(t)),!Z.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function te(e,t){var r=t.length<0?0:0|re(t.length);e=J(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function re(e){if(e>=K())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K().toString(16)+" bytes");return 0|e}function ne(e){return!(null==e||!e._isBuffer)}function ie(e,t){if(ne(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return xe(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return ke(e).length;default:if(n)return xe(e).length;t=(""+t).toLowerCase(),n=!0}}function oe(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return we(this,t,r);case"utf8":case"utf-8":return me(this,t,r);case"ascii":return ye(this,t,r);case"latin1":case"binary":return be(this,t,r);case"base64":return ge(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Se(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function se(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function ae(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Z.from(t,n)),ne(t))return 0===t.length?-1:ce(e,t,r,n,i);if("number"==typeof t)return t&=255,Z.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):ce(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function ce(e,t,r,n,i){var o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){for(var h=!0,d=0;d<c;d++)if(u(e,o+d)!==u(t,d)){h=!1;break}if(h)return o}return-1}function ue(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function le(e,t,r,n){return Ne(xe(t,e.length-r),e,r,n)}function he(e,t,r,n){return Ne(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function de(e,t,r,n){return he(e,t,r,n)}function fe(e,t,r,n){return Ne(ke(t),e,r,n)}function pe(e,t,r,n){return Ne(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function ge(e,t,r){return 0===t&&r===e.length?V(e):V(e.slice(t,r))}function me(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,c,u=e[i],l=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=ve)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=ve));return r}(n)}Z.poolSize=8192,Z._augment=function(e){return e.__proto__=Z.prototype,e},Z.from=function(e,t,r){return X(null,e,t,r)},Z.TYPED_ARRAY_SUPPORT&&(Z.prototype.__proto__=Uint8Array.prototype,Z.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Z[Symbol.species]),Z.alloc=function(e,t,r){return function(e,t,r,n){return Q(t),t<=0?J(e,t):void 0!==r?"string"==typeof n?J(e,t).fill(r,n):J(e,t).fill(r):J(e,t)}(null,e,t,r)},Z.allocUnsafe=function(e){return ee(null,e)},Z.allocUnsafeSlow=function(e){return ee(null,e)},Z.isBuffer=Be,Z.compare=function(e,t){if(!ne(e)||!ne(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Z.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Z.concat=function(e,t){if(!G(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Z.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Z.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!ne(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},Z.byteLength=ie,Z.prototype._isBuffer=!0,Z.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)se(this,t,t+1);return this},Z.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)se(this,t,t+3),se(this,t+1,t+2);return this},Z.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)se(this,t,t+7),se(this,t+1,t+6),se(this,t+2,t+5),se(this,t+3,t+4);return this},Z.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?me(this,0,e):oe.apply(this,arguments)},Z.prototype.equals=function(e){if(!ne(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Z.compare(this,e)},Z.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Z.prototype.compare=function(e,t,r,n,i){if(!ne(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(n,i),u=e.slice(t,r),l=0;l<a;++l)if(c[l]!==u[l]){o=c[l],s=u[l];break}return o<s?-1:s<o?1:0},Z.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Z.prototype.indexOf=function(e,t,r){return ae(this,e,t,r,!0)},Z.prototype.lastIndexOf=function(e,t,r){return ae(this,e,t,r,!1)},Z.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return ue(this,e,t,r);case"utf8":case"utf-8":return le(this,e,t,r);case"ascii":return he(this,e,t,r);case"latin1":case"binary":return de(this,e,t,r);case"base64":return fe(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pe(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Z.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ve=4096;function ye(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function be(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function we(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=Te(e[o]);return i}function Se(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function Pe(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function Ae(e,t,r,n,i,o){if(!ne(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function Oe(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function Ee(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function Re(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function _e(e,t,r,n,i){return i||Re(e,0,r,4),H(e,t,r,n,23,4),r+4}function Ie(e,t,r,n,i){return i||Re(e,0,r,8),H(e,t,r,n,52,8),r+8}Z.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),Z.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Z.prototype;else{var i=t-e;r=new Z(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},Z.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||Pe(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},Z.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||Pe(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Z.prototype.readUInt8=function(e,t){return t||Pe(e,1,this.length),this[e]},Z.prototype.readUInt16LE=function(e,t){return t||Pe(e,2,this.length),this[e]|this[e+1]<<8},Z.prototype.readUInt16BE=function(e,t){return t||Pe(e,2,this.length),this[e]<<8|this[e+1]},Z.prototype.readUInt32LE=function(e,t){return t||Pe(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Z.prototype.readUInt32BE=function(e,t){return t||Pe(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Z.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||Pe(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Z.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||Pe(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},Z.prototype.readInt8=function(e,t){return t||Pe(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Z.prototype.readInt16LE=function(e,t){t||Pe(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Z.prototype.readInt16BE=function(e,t){t||Pe(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Z.prototype.readInt32LE=function(e,t){return t||Pe(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Z.prototype.readInt32BE=function(e,t){return t||Pe(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Z.prototype.readFloatLE=function(e,t){return t||Pe(e,4,this.length),z(this,e,!0,23,4)},Z.prototype.readFloatBE=function(e,t){return t||Pe(e,4,this.length),z(this,e,!1,23,4)},Z.prototype.readDoubleLE=function(e,t){return t||Pe(e,8,this.length),z(this,e,!0,52,8)},Z.prototype.readDoubleBE=function(e,t){return t||Pe(e,8,this.length),z(this,e,!1,52,8)},Z.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Ae(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},Z.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||Ae(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},Z.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,1,255,0),Z.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Z.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,2,65535,0),Z.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Oe(this,e,t,!0),t+2},Z.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,2,65535,0),Z.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Oe(this,e,t,!1),t+2},Z.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,4,4294967295,0),Z.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Ee(this,e,t,!0),t+4},Z.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,4,4294967295,0),Z.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ee(this,e,t,!1),t+4},Z.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);Ae(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Z.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);Ae(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},Z.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,1,127,-128),Z.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Z.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,2,32767,-32768),Z.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Oe(this,e,t,!0),t+2},Z.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,2,32767,-32768),Z.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Oe(this,e,t,!1),t+2},Z.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,4,2147483647,-2147483648),Z.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Ee(this,e,t,!0),t+4},Z.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||Ae(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Z.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ee(this,e,t,!1),t+4},Z.prototype.writeFloatLE=function(e,t,r){return _e(this,e,t,!0,r)},Z.prototype.writeFloatBE=function(e,t,r){return _e(this,e,t,!1,r)},Z.prototype.writeDoubleLE=function(e,t,r){return Ie(this,e,t,!0,r)},Z.prototype.writeDoubleBE=function(e,t,r){return Ie(this,e,t,!1,r)},Z.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!Z.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},Z.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Z.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var s=ne(e)?e:xe(new Z(e,n).toString()),a=s.length;for(o=0;o<r-t;++o)this[o+t]=s[o%a]}return this};var je=/[^+\/0-9A-Za-z-_]/g;function Te(e){return e<16?"0"+e.toString(16):e.toString(16)}function xe(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function ke(e){return function(e){var t,r,n,i,o,s;L||q();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new F(3*a/4-o),n=o>0?a-4:a;var c=0;for(t=0,r=0;t<n;t+=4,r+=3)i=U[e.charCodeAt(t)]<<18|U[e.charCodeAt(t+1)]<<12|U[e.charCodeAt(t+2)]<<6|U[e.charCodeAt(t+3)],s[c++]=i>>16&255,s[c++]=i>>8&255,s[c++]=255&i;return 2===o?(i=U[e.charCodeAt(t)]<<2|U[e.charCodeAt(t+1)]>>4,s[c++]=255&i):1===o&&(i=U[e.charCodeAt(t)]<<10|U[e.charCodeAt(t+1)]<<4|U[e.charCodeAt(t+2)]>>2,s[c++]=i>>8&255,s[c++]=255&i),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(je,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Ne(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function Be(e){return null!=e&&(!!e._isBuffer||Me(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Me(e.slice(0,0))}(e))}function Me(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var De=Object.freeze({__proto__:null,Buffer:Z,INSPECT_MAX_BYTES:50,SlowBuffer:function(e){return+e!=e&&(e=0),Z.alloc(+e)},isBuffer:Be,kMaxLength:W});function Ce(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}D.inherits(Ce,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:D.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Ue=Ce.prototype,Fe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Fe[e]={value:e}})),Object.defineProperties(Ce,Fe),Object.defineProperty(Ue,"isAxiosError",{value:!0}),Ce.from=(e,t,r,n,i,o)=>{const s=Object.create(Ue);return D.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Ce.call(s,e.message,t,r,n,i),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};function Le(e){return D.isPlainObject(e)||D.isArray(e)}function qe(e){return D.endsWith(e,"[]")?e.slice(0,-2):e}function $e(e,t,r){return e?e.concat(t).map((function(e,t){return e=qe(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}const Ve=D.toFlatObject(D,{},null,(function(e){return/^is[A-Z]/.test(e)}));function ze(e,t,r){if(!D.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=D.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!D.isUndefined(t[e])}))).metaTokens,i=r.visitor||u,o=r.dots,s=r.indexes,a=(r.Blob||"undefined"!=typeof Blob&&Blob)&&D.isSpecCompliantForm(t);if(!D.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(D.isDate(e))return e.toISOString();if(!a&&D.isBlob(e))throw new Ce("Blob is not supported. Use a Buffer instead.");return D.isArrayBuffer(e)||D.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Z.from(e):e}function u(e,r,i){let a=e;if(e&&!i&&"object"==typeof e)if(D.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(D.isArray(e)&&function(e){return D.isArray(e)&&!e.some(Le)}(e)||(D.isFileList(e)||D.endsWith(r,"[]"))&&(a=D.toArray(e)))return r=qe(r),a.forEach((function(e,n){!D.isUndefined(e)&&null!==e&&t.append(!0===s?$e([r],n,o):null===s?r:r+"[]",c(e))})),!1;return!!Le(e)||(t.append($e(i,r,o),c(e)),!1)}const l=[],h=Object.assign(Ve,{defaultVisitor:u,convertValue:c,isVisitable:Le});if(!D.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!D.isUndefined(r)){if(-1!==l.indexOf(r))throw Error("Circular reference detected in "+n.join("."));l.push(r),D.forEach(r,(function(r,o){!0===(!(D.isUndefined(r)||null===r)&&i.call(t,r,D.isString(o)?o.trim():o,n,h))&&e(r,n?n.concat(o):[o])})),l.pop()}}(e),t}function He(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Ye(e,t){this._pairs=[],e&&ze(e,this,t)}const Ge=Ye.prototype;function We(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ke(e,t,r){if(!t)return e;const n=r&&r.encode||We,i=r&&r.serialize;let o;if(o=i?i(t,r):D.isURLSearchParams(t)?t.toString():new Ye(t,r).toString(n),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}Ge.append=function(e,t){this._pairs.push([e,t])},Ge.toString=function(e){const t=e?function(t){return e.call(this,t,He)}:He;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var Je=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){D.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Ze={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var Xe={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:Ye,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};function Qe(e){function t(e,r,n,i){let o=e[i++];const s=Number.isFinite(+o),a=i>=e.length;if(o=!o&&D.isArray(n)?n.length:o,a)return D.hasOwnProp(n,o)?n[o]=[n[o],r]:n[o]=r,!s;n[o]&&D.isObject(n[o])||(n[o]=[]);return t(e,r,n[o],i)&&D.isArray(n[o])&&(n[o]=function(e){const t={},r=Object.keys(e);let n;const i=r.length;let o;for(n=0;n<i;n++)o=r[n],t[o]=e[o];return t}(n[o])),!s}if(D.isFormData(e)&&D.isFunction(e.entries)){const r={};return D.forEachEntry(e,((e,n)=>{t(function(e){return D.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,r,0)})),r}return null}const et={"Content-Type":void 0};const tt={transitional:Ze,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=D.isObject(e);i&&D.isHTMLForm(e)&&(e=new FormData(e));if(D.isFormData(e))return n&&n?JSON.stringify(Qe(e)):e;if(D.isArrayBuffer(e)||D.isBuffer(e)||D.isStream(e)||D.isFile(e)||D.isBlob(e))return e;if(D.isArrayBufferView(e))return e.buffer;if(D.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ze(e,new Xe.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return Xe.isNode&&D.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=D.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ze(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,r){if(D.isString(e))try{return(t||JSON.parse)(e),D.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||tt.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(e&&D.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw Ce.from(e,Ce.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Xe.classes.FormData,Blob:Xe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};D.forEach(["delete","get","head"],(function(e){tt.headers[e]={}})),D.forEach(["post","put","patch"],(function(e){tt.headers[e]=D.merge(et)}));var rt=tt;const nt=D.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const it=Symbol("internals");function ot(e){return e&&String(e).trim().toLowerCase()}function st(e){return!1===e||null==e?e:D.isArray(e)?e.map(st):String(e)}function at(e,t,r,n,i){return D.isFunction(n)?n.call(this,t,r):(i&&(t=r),D.isString(t)?D.isString(n)?-1!==t.indexOf(n):D.isRegExp(n)?n.test(t):void 0:void 0)}class ct{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(e,t,r){const i=ot(t);if(!i)throw new Error("header name must be a non-empty string");const o=D.findKey(n,i);(!o||void 0===n[o]||!0===r||void 0===r&&!1!==n[o])&&(n[o||t]=st(e))}const o=(e,t)=>D.forEach(e,((e,r)=>i(e,r,t)));return D.isPlainObject(e)||e instanceof this.constructor?o(e,t):D.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z]+$/.test(e.trim())?o((e=>{const t={};let r,n,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),r=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!r||t[r]&&nt[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)})),t})(e),t):null!=e&&i(t,e,r),this}get(e,t){if(e=ot(e)){const r=D.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(D.isFunction(t))return t.call(this,e,r);if(D.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ot(e)){const r=D.findKey(this,e);return!(!r||void 0===this[r]||t&&!at(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function i(e){if(e=ot(e)){const i=D.findKey(r,e);!i||t&&!at(0,r[i],i,t)||(delete r[i],n=!0)}}return D.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];e&&!at(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return D.forEach(this,((n,i)=>{const o=D.findKey(r,i);if(o)return t[o]=st(n),void delete t[i];const s=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,r)=>t.toUpperCase()+r))}(i):String(i).trim();s!==i&&delete t[i],t[s]=st(n),r[s]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return D.forEach(this,((r,n)=>{null!=r&&!1!==r&&(t[n]=e&&D.isArray(r)?r.join(", "):r)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach((e=>r.set(e))),r}static accessor(e){const t=(this[it]=this[it]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=ot(e);t[n]||(!function(e,t){const r=D.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})}))}(r,e),t[n]=!0)}return D.isArray(e)?e.forEach(n):n(e),this}}ct.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),D.freezeMethods(ct.prototype),D.freezeMethods(ct);var ut=ct;function lt(e,t){const r=this||rt,n=t||r,i=ut.from(n.headers);let o=n.data;return D.forEach(e,(function(e){o=e.call(r,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function ht(e){return!(!e||!e.__CANCEL__)}function dt(e,t,r){Ce.call(this,null==e?"canceled":e,Ce.ERR_CANCELED,t,r),this.name="CanceledError"}D.inherits(dt,Ce,{__CANCEL__:!0});var ft=Xe.isStandardBrowserEnv?{write:function(e,t,r,n,i,o){const s=[];s.push(e+"="+encodeURIComponent(t)),D.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),D.isString(n)&&s.push("path="+n),D.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function pt(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var gt=Xe.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function n(r){let n=r;return e&&(t.setAttribute("href",n),n=t.href),t.setAttribute("href",n),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return r=n(window.location.href),function(e){const t=D.isString(e)?n(e):e;return t.protocol===r.protocol&&t.host===r.host}}():function(){return!0};function mt(e,t){let r=0;const n=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),u=n[s];i||(i=c),r[o]=a,n[o]=c;let l=s,h=0;for(;l!==o;)h+=r[l++],l%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),c-i<t)return;const d=u&&c-u;return d?Math.round(1e3*h/d):void 0}}(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-r,c=n(a);r=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&o<=s?(s-o)/c:void 0,event:i};u[t?"download":"upload"]=!0,e(u)}}var vt="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,r){let n=e.data;const i=ut.from(e.headers).normalize(),o=e.responseType;let s;function a(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}D.isFormData(n)&&(Xe.isStandardBrowserEnv||Xe.isStandardBrowserWebWorkerEnv)&&i.setContentType(!1);let c=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",r=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+r))}const u=pt(e.baseURL,e.url);function l(){if(!c)return;const n=ut.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());!function(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new Ce("Request failed with status code "+r.status,[Ce.ERR_BAD_REQUEST,Ce.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}((function(e){t(e),a()}),(function(e){r(e),a()}),{data:o&&"text"!==o&&"json"!==o?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:n,config:e,request:c}),c=null}if(c.open(e.method.toUpperCase(),Ke(u,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=l:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(l)},c.onabort=function(){c&&(r(new Ce("Request aborted",Ce.ECONNABORTED,e,c)),c=null)},c.onerror=function(){r(new Ce("Network Error",Ce.ERR_NETWORK,e,c)),c=null},c.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const n=e.transitional||Ze;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new Ce(t,n.clarifyTimeoutError?Ce.ETIMEDOUT:Ce.ECONNABORTED,e,c)),c=null},Xe.isStandardBrowserEnv){const t=(e.withCredentials||gt(u))&&e.xsrfCookieName&&ft.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===n&&i.setContentType(null),"setRequestHeader"in c&&D.forEach(i.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),D.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),o&&"json"!==o&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",mt(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",mt(e.onUploadProgress)),(e.cancelToken||e.signal)&&(s=t=>{c&&(r(!t||t.type?new dt(null,e,c):t),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s)));const h=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(u);h&&-1===Xe.protocols.indexOf(h)?r(new Ce("Unsupported protocol "+h+":",Ce.ERR_BAD_REQUEST,e)):c.send(n||null)}))};const yt={http:null,xhr:vt};D.forEach(yt,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));var bt={getAdapter:e=>{e=D.isArray(e)?e:[e];const{length:t}=e;let r,n;for(let i=0;i<t&&(r=e[i],!(n=D.isString(r)?yt[r.toLowerCase()]:r));i++);if(!n){if(!1===n)throw new Ce(`Adapter ${r} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(D.hasOwnProp(yt,r)?`Adapter '${r}' is not available in the build`:`Unknown adapter '${r}'`)}if(!D.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:yt};function wt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new dt(null,e)}function St(e){wt(e),e.headers=ut.from(e.headers),e.data=lt.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return bt.getAdapter(e.adapter||rt.adapter)(e).then((function(t){return wt(e),t.data=lt.call(e,e.transformResponse,t),t.headers=ut.from(t.headers),t}),(function(t){return ht(t)||(wt(e),t&&t.response&&(t.response.data=lt.call(e,e.transformResponse,t.response),t.response.headers=ut.from(t.response.headers))),Promise.reject(t)}))}const Pt=e=>e instanceof ut?e.toJSON():e;function At(e,t){t=t||{};const r={};function n(e,t,r){return D.isPlainObject(e)&&D.isPlainObject(t)?D.merge.call({caseless:r},e,t):D.isPlainObject(t)?D.merge({},t):D.isArray(t)?t.slice():t}function i(e,t,r){return D.isUndefined(t)?D.isUndefined(e)?void 0:n(void 0,e,r):n(e,t,r)}function o(e,t){if(!D.isUndefined(t))return n(void 0,t)}function s(e,t){return D.isUndefined(t)?D.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(r,i,o){return o in t?n(r,i):o in e?n(void 0,r):void 0}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t)=>i(Pt(e),Pt(t),!0)};return D.forEach(Object.keys(e).concat(Object.keys(t)),(function(n){const o=c[n]||i,s=o(e[n],t[n],n);D.isUndefined(s)&&o!==a||(r[n]=s)})),r}const Ot="1.3.4",Et={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Et[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const Rt={};Et.transitional=function(e,t,r){function n(e,t){return"[Axios v1.3.4] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,o)=>{if(!1===e)throw new Ce(n(i," has been removed"+(t?" in "+t:"")),Ce.ERR_DEPRECATED);return t&&!Rt[i]&&(Rt[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}};var _t={assertOptions:function(e,t,r){if("object"!=typeof e)throw new Ce("options must be an object",Ce.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const o=n[i],s=t[o];if(s){const t=e[o],r=void 0===t||s(t,o,e);if(!0!==r)throw new Ce("option "+o+" must be "+r,Ce.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new Ce("Unknown option "+o,Ce.ERR_BAD_OPTION)}},validators:Et};const It=_t.validators;let jt=class{constructor(e){this.defaults=e,this.interceptors={request:new Je,response:new Je}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=At(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;let o;void 0!==r&&_t.assertOptions(r,{silentJSONParsing:It.transitional(It.boolean),forcedJSONParsing:It.transitional(It.boolean),clarifyTimeoutError:It.transitional(It.boolean)},!1),void 0!==n&&_t.assertOptions(n,{encode:It.function,serialize:It.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase(),o=i&&D.merge(i.common,i[t.method]),o&&D.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=ut.concat(o,i);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const c=[];let u;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,h=0;if(!a){const e=[St.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,c),l=e.length,u=Promise.resolve(t);h<l;)u=u.then(e[h++],e[h++]);return u}l=s.length;let d=t;for(h=0;h<l;){const e=s[h++],t=s[h++];try{d=e(d)}catch(e){t.call(this,e);break}}try{u=St.call(this,d)}catch(e){return Promise.reject(e)}for(h=0,l=c.length;h<l;)u=u.then(c[h++],c[h++]);return u}getUri(e){return Ke(pt((e=At(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};D.forEach(["delete","get","head","options"],(function(e){jt.prototype[e]=function(t,r){return this.request(At(r||{},{method:e,url:t,data:(r||{}).data}))}})),D.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(At(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}jt.prototype[e]=t(),jt.prototype[e+"Form"]=t(!0)}));var Tt=jt;class xt{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const r=this;this.promise.then((e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e,n,i){r.reason||(r.reason=new dt(e,n,i),t(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new xt((function(t){e=t})),cancel:e}}}var kt=xt;const Nt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Nt).forEach((([e,t])=>{Nt[t]=e}));var Bt=Nt;const Mt=function e(t){const r=new Tt(t),i=n(Tt.prototype.request,r);return D.extend(i,Tt.prototype,r,{allOwnKeys:!0}),D.extend(i,r,null,{allOwnKeys:!0}),i.create=function(r){return e(At(t,r))},i}(rt);Mt.Axios=Tt,Mt.CanceledError=dt,Mt.CancelToken=kt,Mt.isCancel=ht,Mt.VERSION=Ot,Mt.toFormData=ze,Mt.AxiosError=Ce,Mt.Cancel=Mt.CanceledError,Mt.all=function(e){return Promise.all(e)},Mt.spread=function(e){return function(t){return e.apply(null,t)}},Mt.isAxiosError=function(e){return D.isObject(e)&&!0===e.isAxiosError},Mt.mergeConfig=At,Mt.AxiosHeaders=ut,Mt.formToJSON=e=>Qe(D.isHTMLForm(e)?new FormData(e):e),Mt.HttpStatusCode=Bt,Mt.default=Mt;var Dt=Mt;const Ct=(e,t=!1)=>new Promise((r=>setTimeout(r,e*(t?1:1e3)))),Ut={},Ft={};class Lt{level="debug";debug(e){this.print("debug",e)}error(e){this.print("error",e)}info(e){this.print("info",e)}log(e){this.print("log",e)}setLevel(e){this.level=e}warn(e){this.print("warn",e)}table(e){console.table(e)}print(e,t){console.log(`${(new Date).toISOString()} [${e}] ${t}`)}}const qt="undefined"!=typeof window&&void 0!==window.document,$t="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;function Vt(e){if(qt)throw new Error(`Feature ${e} is unsupported in the browser.`)}const zt="http://girepo.dev.golem.network:8000",Ht="_girepo._tcp.dev.golem.network",Yt="http";class Gt{logger;constructor(e){this.logger=e}static create({logger:e}){return new Gt(e)}async isRecordValid(e){try{return await Dt.head(e,{timeout:1e4}),!0}catch(t){return t?.response?.status>200&&t?.response?.status<500||(this.logger?.warn(`Url ${e} is not responding. ${t?.message}`),!1)}}async resolveRepoUrl(){try{const e=qt?await this.resolveRepoUrlForBrowser():await this.resolveRepoUrlForNode();for(;e.length>0;){const t=e.splice(e.length*Math.random()|0,1)[0];if(await this.isRecordValid(t))return t}}catch(e){this.logger?.warn(`Error occurred while trying to get SRV record : ${e}`)}return null}async getRepoUrl(){const e=await this.resolveRepoUrl();return e?(this.logger?.debug(`Using image repository: ${e}.`),e):(this.logger?.warn(`Problem resolving image repository: ${Ht}, falling back to ${zt}.`),zt)}async resolveRepoUrlForBrowser(){const{data:e}=await Dt.get(`https://dns.google/resolve?type=srv&name=${Ht}`,{timeout:5e3});return(e?.Answer||[]).map((e=>{const[,,t,r]=e&&e.data&&e.data.split?e.data.split(" "):[];return r&&t?`${Yt}://${r.substring(0,r.length-1)}:${t}`:null})).filter((e=>e))}async resolveRepoUrlForNode(){return new Promise(((e,t)=>{Promise.resolve().then((function(){return wv})).then((r=>{r.resolveSrv(Ht,((r,n)=>{r&&t(r),e(n?.map((e=>e.name&&e.port?`${Yt}://${e.name}:${e.port}`:null)))}))})).catch((e=>t(e)))}))}}const Wt={engine:"vm",minMemGib:.5,minStorageGib:2,minCpuThreads:1,minCpuCores:1,capabilities:[]};var Kt;!function(e){e.UNKNOWN="",e.GVMKIT_SQUASH="gvmkit-squash"}(Kt||(Kt={}));class Jt{packageFormat;imageHash;repoUrl;engine;minMemGib;minStorageGib;minCpuThreads;minCpuCores;capabilities;logger;constructor(e){this.packageFormat=Kt.GVMKIT_SQUASH,this.imageHash=e.imageHash,this.repoUrl=e.repoUrl,this.engine=e.engine||Wt.engine,this.minMemGib=e.minMemGib||Wt.minMemGib,this.minStorageGib=e.minStorageGib||Wt.minStorageGib,this.minCpuThreads=e.minCpuThreads||Wt.minCpuThreads,this.minCpuCores=e.minCpuCores||Wt.minCpuCores,this.capabilities=e.capabilities||Wt.capabilities,this.logger=e.logger}}class Zt{options;logger;constructor(e){this.options=e,this.logger=e.logger}static create(e){const t=new Jt(e);return new Zt(t)}async getDemandDecoration(){const r=await this.resolveTaskPackageUrl(),n=new t;return n.addProperty("golem.srv.comp.task_package",r).addProperty("golem.srv.comp.vm.package_format",this.options.packageFormat).addConstraint("golem.inf.mem.gib",this.options.minMemGib.toString(),e.GtEq).addConstraint("golem.inf.storage.gib",this.options.minStorageGib.toString(),e.GtEq).addConstraint("golem.runtime.name",this.options.engine).addConstraint("golem.inf.cpu.threads",this.options.minCpuThreads.toString(),e.GtEq),this.options.capabilities.length&&n.addConstraint("golem.runtime.capabilities",this.options.capabilities.join(",")),n.getDecorations()}async getRepoUrl(){if(this.options.repoUrl)return this.options.repoUrl;const e=Gt.create({logger:this.logger});return await e.getRepoUrl()}async resolveTaskPackageUrl(){const e=await this.getRepoUrl(),t=await Dt.get(`${e}/image.${this.options.imageHash}.link`);if(200!=t.status)throw this.logger?.error("Unable to resolve task package url: Response "+t.status),Error(`Error: ${t.status}`);const r=await t.data;return`hash:sha3:${this.options.imageHash}:${r}`}}const Xt=-1;var Qt;!function(e){e.TIME="golem.usage.duration_sec",e.CPU="golem.usage.cpu_sec",e.STORAGE="golem.usage.storage_gib",e.MAXMEM="golem.usage.gib",e.UNKNOWN=""}(Qt||(Qt={}));class er{defaultStrategy;constructor(e,t){this.defaultStrategy=new rr(new tr(60,1,new Map([[Qt.TIME,.1],[Qt.CPU,.2]]),t),.5,e,t)}getDemandDecoration(){return this.defaultStrategy.getDemandDecoration()}scoreProposal(e){return this.defaultStrategy.scoreProposal(e)}}class tr{expectedTimeSecs;maxFixedPrice;maxPriceFor;logger;constructor(e=60,t,r,n){this.expectedTimeSecs=e,this.maxFixedPrice=t,this.maxPriceFor=r,this.logger=n}getDemandDecoration(){return{constraints:["(golem.com.pricing.model=linear)"],properties:[]}}scoreProposal(e){if("payu"!==e.properties["golem.com.scheme"])return this.logger?.debug(`Rejected offer ${e.id}: unsupported scheme '${e.properties["golem.com.scheme"]}'`),Xt;const t=new Set([Qt.TIME,Qt.CPU]),r=e.properties["golem.com.pricing.model.linear.coeffs"]||[],n=e.properties["golem.com.usage.vector"]||[],i=parseFloat(r.pop()||"0");let o={};for(let e=0;e<r.length;e++)o={...o,[n[e]]:parseFloat(r[e])};for(const r in o)if(!t.has(r))return this.logger?.debug(`Rejected offer ${e.id}: unsupported counter '${r}'`),Xt;if(void 0!==this.maxFixedPrice&&i>this.maxFixedPrice)return this.logger?.debug(`Rejected offer ${e.id}: fixed price higher than fixed price cap ${this.maxFixedPrice}.`),Xt;if(i<0)return this.logger?.debug(`Rejected offer ${e.id}: negative fixed price`),Xt;let s=i;for(const r of t){if(o[r]<0)return this.logger?.debug(`Rejected offer ${e.id}: negative price for '${r}'`),Xt;if(this.maxPriceFor){const t=this.maxPriceFor.get(r);if(void 0!==t&&o[r]>t)return this.logger?.debug(`Rejected offer ${e.id}: price for '${r}' higher than price cap ${t}`),Xt}s+=o[r]*this.expectedTimeSecs}return 100/(s+1.01)}}class rr{baseStrategy;factor;computationHistory;logger;constructor(e,t,r,n){this.baseStrategy=e,this.factor=t,this.computationHistory=r,this.logger=n}getDemandDecoration(){return this.baseStrategy.getDemandDecoration()}scoreProposal(e){let t=this.baseStrategy.scoreProposal(e);return this.computationHistory.isProviderLastAgreementRejected(e.issuerId)&&t>0&&(t*=this.factor,this.logger?.debug(`Decreasing score for offer ${e.id} from '${e.issuerId}'`)),t}}var nr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ir(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];return r.push.apply(r,arguments),new(Function.bind.apply(t,r))}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var or={},sr={},ar={};Object.defineProperty(ar,"__esModule",{value:!0}),ar.Configuration=void 0;ar.Configuration=class{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ \t]+/[^;/ \t]+[+]json)[ \t]*(;.*)?$","i");return null!==e&&(t.test(e)||"application/json-patch+json"===e.toLowerCase())}};var cr,ur={},lr={};cr=lr,Object.defineProperty(cr,"__esModule",{value:!0}),cr.AgreementStateEnum=void 0,function(e){e.Proposal="Proposal",e.Pending="Pending",e.Cancelled="Cancelled",e.Rejected="Rejected",e.Approved="Approved",e.Expired="Expired",e.Terminated="Terminated"}(cr.AgreementStateEnum||(cr.AgreementStateEnum={}));var hr={};Object.defineProperty(hr,"__esModule",{value:!0});var dr={};Object.defineProperty(dr,"__esModule",{value:!0});var fr={};Object.defineProperty(fr,"__esModule",{value:!0});var pr={};Object.defineProperty(pr,"__esModule",{value:!0});var gr={};Object.defineProperty(gr,"__esModule",{value:!0});var mr={};Object.defineProperty(mr,"__esModule",{value:!0});var vr={};Object.defineProperty(vr,"__esModule",{value:!0});var yr={};Object.defineProperty(yr,"__esModule",{value:!0});var br={};Object.defineProperty(br,"__esModule",{value:!0});var wr={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.AgreementTerminatedEventAllOfTerminatorEnum=void 0,(t=e.AgreementTerminatedEventAllOfTerminatorEnum||(e.AgreementTerminatedEventAllOfTerminatorEnum={})).Requestor="Requestor",t.Provider="Provider"}(wr);var Sr={};Object.defineProperty(Sr,"__esModule",{value:!0});var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0});var Or={};Object.defineProperty(Or,"__esModule",{value:!0});var Er={};Object.defineProperty(Er,"__esModule",{value:!0});var Rr={};Object.defineProperty(Rr,"__esModule",{value:!0});var _r={};Object.defineProperty(_r,"__esModule",{value:!0});var Ir={};Object.defineProperty(Ir,"__esModule",{value:!0});var jr={};Object.defineProperty(jr,"__esModule",{value:!0});var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0});var xr={};Object.defineProperty(xr,"__esModule",{value:!0});var kr={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.ProposalAllOfStateEnum=void 0,(t=e.ProposalAllOfStateEnum||(e.ProposalAllOfStateEnum={})).Initial="Initial",t.Draft="Draft",t.Rejected="Rejected",t.Accepted="Accepted",t.Expired="Expired"}(kr);var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});var Br={};Object.defineProperty(Br,"__esModule",{value:!0});var Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});var Cr,Ur={};function Fr(){return Cr||(Cr=1,function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(ao(),e),r(ar,e),r(ur,e)}(sr)),sr}Object.defineProperty(Ur,"__esModule",{value:!0}),function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(lr,e),r(hr,e),r(dr,e),r(fr,e),r(pr,e),r(gr,e),r(mr,e),r(vr,e),r(yr,e),r(br,e),r(wr,e),r(Sr,e),r(Pr,e),r(Ar,e),r(Or,e),r(Er,e),r(Rr,e),r(_r,e),r(Ir,e),r(jr,e),r(Tr,e),r(xr,e),r(kr,e),r(Nr,e),r(Br,e),r(Mr,e),r(Dr,e),r(Ur,e)}(ur);var Lr={},qr={},$r={get exports(){return qr},set exports(e){qr=e}},Vr={},zr={get exports(){return Vr},set exports(e){Vr=e}},Hr=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},Yr=Hr,Gr=Object.prototype.toString;function Wr(e){return"[object Array]"===Gr.call(e)}function Kr(e){return void 0===e}function Jr(e){return null!==e&&"object"==typeof e}function Zr(e){if("[object Object]"!==Gr.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function Xr(e){return"[object Function]"===Gr.call(e)}function Qr(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),Wr(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var en={isArray:Wr,isArrayBuffer:function(e){return"[object ArrayBuffer]"===Gr.call(e)},isBuffer:function(e){return null!==e&&!Kr(e)&&null!==e.constructor&&!Kr(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:Jr,isPlainObject:Zr,isUndefined:Kr,isDate:function(e){return"[object Date]"===Gr.call(e)},isFile:function(e){return"[object File]"===Gr.call(e)},isBlob:function(e){return"[object Blob]"===Gr.call(e)},isFunction:Xr,isStream:function(e){return Jr(e)&&Xr(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:Qr,merge:function e(){var t={};function r(r,n){Zr(t[n])&&Zr(r)?t[n]=e(t[n],r):Zr(r)?t[n]=e({},r):Wr(r)?t[n]=r.slice():t[n]=r}for(var n=0,i=arguments.length;n<i;n++)Qr(arguments[n],r);return t},extend:function(e,t,r){return Qr(t,(function(t,n){e[n]=r&&"function"==typeof t?Yr(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}},tn=en;function rn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var nn=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(tn.isURLSearchParams(t))n=t.toString();else{var i=[];tn.forEach(t,(function(e,t){null!=e&&(tn.isArray(e)?t+="[]":e=[e],tn.forEach(e,(function(e){tn.isDate(e)?e=e.toISOString():tn.isObject(e)&&(e=JSON.stringify(e)),i.push(rn(t)+"="+rn(e))})))})),n=i.join("&")}if(n){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e},on=en;function sn(){this.handlers=[]}sn.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},sn.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},sn.prototype.forEach=function(e){on.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var an=sn;function cn(){throw new Error("setTimeout has not been defined")}function un(){throw new Error("clearTimeout has not been defined")}var ln=cn,hn=un;function dn(e){if(ln===setTimeout)return setTimeout(e,0);if((ln===cn||!ln)&&setTimeout)return ln=setTimeout,setTimeout(e,0);try{return ln(e,0)}catch(t){try{return ln.call(null,e,0)}catch(t){return ln.call(this,e,0)}}}"function"==typeof r.setTimeout&&(ln=setTimeout),"function"==typeof r.clearTimeout&&(hn=clearTimeout);var fn,pn=[],gn=!1,mn=-1;function vn(){gn&&fn&&(gn=!1,fn.length?pn=fn.concat(pn):mn=-1,pn.length&&yn())}function yn(){if(!gn){var e=dn(vn);gn=!0;for(var t=pn.length;t;){for(fn=pn,pn=[];++mn<t;)fn&&fn[mn].run();mn=-1,t=pn.length}fn=null,gn=!1,function(e){if(hn===clearTimeout)return clearTimeout(e);if((hn===un||!hn)&&clearTimeout)return hn=clearTimeout,clearTimeout(e);try{return hn(e)}catch(t){try{return hn.call(null,e)}catch(t){return hn.call(this,e)}}}(e)}}function bn(e,t){this.fun=e,this.array=t}bn.prototype.run=function(){this.fun.apply(null,this.array)};function wn(){}var Sn=wn,Pn=wn,An=wn,On=wn,En=wn,Rn=wn,_n=wn;var In=r.performance||{},jn=In.now||In.mozNow||In.msNow||In.oNow||In.webkitNow||function(){return(new Date).getTime()};var Tn=new Date;var xn,kn,Nn,Bn,Mn,Dn,Cn,Un,Fn,Ln,qn,$n,Vn,zn,Hn,Yn,Gn,Wn,Kn={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];pn.push(new bn(e,t)),1!==pn.length||gn||dn(yn)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Sn,addListener:Pn,once:An,off:On,removeListener:En,removeAllListeners:Rn,emit:_n,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*jn.call(In),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Tn)/1e3}},Jn=en,Zn=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e};function Xn(){if(kn)return xn;kn=1;var e=Zn;return xn=function(t,r,n,i,o){var s=new Error(t);return e(s,r,n,i,o)},xn}function Qn(){if(Bn)return Nn;Bn=1;var e=Xn();return Nn=function(t,r,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?r(e("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)},Nn}function ei(){if(Dn)return Mn;Dn=1;var e=en;return Mn=e.isStandardBrowserEnv()?{write:function(t,r,n,i,o,s){var a=[];a.push(t+"="+encodeURIComponent(r)),e.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),e.isString(i)&&a.push("path="+i),e.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Mn}function ti(){return Un?Cn:(Un=1,Cn=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)})}function ri(){return Ln?Fn:(Ln=1,Fn=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e})}function ni(){if($n)return qn;$n=1;var e=ti(),t=ri();return qn=function(r,n){return r&&!e(n)?t(r,n):n}}function ii(){if(zn)return Vn;zn=1;var e=en,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Vn=function(r){var n,i,o,s={};return r?(e.forEach(r.split("\n"),(function(r){if(o=r.indexOf(":"),n=e.trim(r.substr(0,o)).toLowerCase(),i=e.trim(r.substr(o+1)),n){if(s[n]&&t.indexOf(n)>=0)return;s[n]="set-cookie"===n?(s[n]?s[n]:[]).concat([i]):s[n]?s[n]+", "+i:i}})),s):s}}function oi(){if(Yn)return Hn;Yn=1;var e=en;return Hn=e.isStandardBrowserEnv()?function(){var t,r=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var t=e;return r&&(n.setAttribute("href",t),t=n.href),n.setAttribute("href",t),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=i(window.location.href),function(r){var n=e.isString(r)?i(r):r;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0}}function si(){if(Wn)return Gn;Wn=1;var e=en,t=Qn(),r=ei(),n=nn,i=ni(),o=ii(),s=oi(),a=Xn();return Gn=function(c){return new Promise((function(u,l){var h=c.data,d=c.headers,f=c.responseType;e.isFormData(h)&&delete d["Content-Type"];var p=new XMLHttpRequest;if(c.auth){var g=c.auth.username||"",m=c.auth.password?unescape(encodeURIComponent(c.auth.password)):"";d.Authorization="Basic "+btoa(g+":"+m)}var v=i(c.baseURL,c.url);function y(){if(p){var e="getAllResponseHeaders"in p?o(p.getAllResponseHeaders()):null,r={data:f&&"text"!==f&&"json"!==f?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:e,config:c,request:p};t(u,l,r),p=null}}if(p.open(c.method.toUpperCase(),n(v,c.params,c.paramsSerializer),!0),p.timeout=c.timeout,"onloadend"in p?p.onloadend=y:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(y)},p.onabort=function(){p&&(l(a("Request aborted",c,"ECONNABORTED",p)),p=null)},p.onerror=function(){l(a("Network Error",c,null,p)),p=null},p.ontimeout=function(){var e="timeout of "+c.timeout+"ms exceeded";c.timeoutErrorMessage&&(e=c.timeoutErrorMessage),l(a(e,c,c.transitional&&c.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",p)),p=null},e.isStandardBrowserEnv()){var b=(c.withCredentials||s(v))&&c.xsrfCookieName?r.read(c.xsrfCookieName):void 0;b&&(d[c.xsrfHeaderName]=b)}"setRequestHeader"in p&&e.forEach(d,(function(e,t){void 0===h&&"content-type"===t.toLowerCase()?delete d[t]:p.setRequestHeader(t,e)})),e.isUndefined(c.withCredentials)||(p.withCredentials=!!c.withCredentials),f&&"json"!==f&&(p.responseType=c.responseType),"function"==typeof c.onDownloadProgress&&p.addEventListener("progress",c.onDownloadProgress),"function"==typeof c.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",c.onUploadProgress),c.cancelToken&&c.cancelToken.promise.then((function(e){p&&(p.abort(),l(e),p=null)})),h||(h=null),p.send(h)}))},Gn}var ai=en,ci=function(e,t){Jn.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))},ui=Zn,li={"Content-Type":"application/x-www-form-urlencoded"};function hi(e,t){!ai.isUndefined(e)&&ai.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var di,fi={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==Kn&&"[object process]"===Object.prototype.toString.call(Kn))&&(di=si()),di),transformRequest:[function(e,t){return ci(t,"Accept"),ci(t,"Content-Type"),ai.isFormData(e)||ai.isArrayBuffer(e)||ai.isBuffer(e)||ai.isStream(e)||ai.isFile(e)||ai.isBlob(e)?e:ai.isArrayBufferView(e)?e.buffer:ai.isURLSearchParams(e)?(hi(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):ai.isObject(e)||t&&"application/json"===t["Content-Type"]?(hi(t,"application/json"),function(e,t,r){if(ai.isString(e))try{return(t||JSON.parse)(e),ai.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,r=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,i=!r&&"json"===this.responseType;if(i||n&&ai.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw ui(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};fi.headers={common:{Accept:"application/json, text/plain, */*"}},ai.forEach(["delete","get","head"],(function(e){fi.headers[e]={}})),ai.forEach(["post","put","patch"],(function(e){fi.headers[e]=ai.merge(li)}));var pi,gi,mi=fi,vi=en,yi=mi;function bi(){return gi?pi:(gi=1,pi=function(e){return!(!e||!e.__CANCEL__)})}var wi=en,Si=function(e,t,r){var n=this||yi;return vi.forEach(r,(function(r){e=r.call(n,e,t)})),e},Pi=bi(),Ai=mi;function Oi(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var Ei=en,Ri=function(e,t){t=t||{};var r={},n=["url","method","data"],i=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function a(e,t){return Ei.isPlainObject(e)&&Ei.isPlainObject(t)?Ei.merge(e,t):Ei.isPlainObject(t)?Ei.merge({},t):Ei.isArray(t)?t.slice():t}function c(n){Ei.isUndefined(t[n])?Ei.isUndefined(e[n])||(r[n]=a(void 0,e[n])):r[n]=a(e[n],t[n])}Ei.forEach(n,(function(e){Ei.isUndefined(t[e])||(r[e]=a(void 0,t[e]))})),Ei.forEach(i,c),Ei.forEach(o,(function(n){Ei.isUndefined(t[n])?Ei.isUndefined(e[n])||(r[n]=a(void 0,e[n])):r[n]=a(void 0,t[n])})),Ei.forEach(s,(function(n){n in t?r[n]=a(e[n],t[n]):n in e&&(r[n]=a(void 0,e[n]))}));var u=n.concat(i).concat(o).concat(s),l=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return Ei.forEach(l,c),r},_i={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}]},Ii={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){Ii[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var ji={},Ti=_i.version.split(".");function xi(e,t){for(var r=t?t.split("."):Ti,n=e.split("."),i=0;i<3;i++){if(r[i]>n[i])return!0;if(r[i]<n[i])return!1}return!1}Ii.transitional=function(e,t,r){var n=t&&xi(t);function i(e,t){return"[Axios v"+_i.version+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,o,s){if(!1===e)throw new Error(i(o," has been removed in "+t));return n&&!ji[o]&&(ji[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,o,s)}};var ki,Ni,Bi,Mi,Di,Ci,Ui,Fi,Li={isOlderVersion:xi,assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),i=n.length;i-- >0;){var o=n[i],s=t[o];if(s){var a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+o)}},validators:Ii},qi=en,$i=nn,Vi=an,zi=function(e){return Oi(e),e.headers=e.headers||{},e.data=Si.call(e,e.data,e.headers,e.transformRequest),e.headers=wi.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),wi.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||Ai.adapter)(e).then((function(t){return Oi(e),t.data=Si.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return Pi(t)||(Oi(e),t&&t.response&&(t.response.data=Si.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},Hi=Ri,Yi=Li,Gi=Yi.validators;function Wi(e){this.defaults=e,this.interceptors={request:new Vi,response:new Vi}}function Ki(){if(Ni)return ki;function e(e){this.message=e}return Ni=1,e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,ki=e}Wi.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=Hi(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&Yi.assertOptions(t,{silentJSONParsing:Gi.transitional(Gi.boolean,"1.0.0"),forcedJSONParsing:Gi.transitional(Gi.boolean,"1.0.0"),clarifyTimeoutError:Gi.transitional(Gi.boolean,"1.0.0")},!1);var r=[],n=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(n=n&&t.synchronous,r.unshift(t.fulfilled,t.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!n){var s=[zi,void 0];for(Array.prototype.unshift.apply(s,r),s=s.concat(o),i=Promise.resolve(e);s.length;)i=i.then(s.shift(),s.shift());return i}for(var a=e;r.length;){var c=r.shift(),u=r.shift();try{a=c(a)}catch(e){u(e);break}}try{i=zi(a)}catch(e){return Promise.reject(e)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},Wi.prototype.getUri=function(e){return e=Hi(this.defaults,e),$i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},qi.forEach(["delete","get","head","options"],(function(e){Wi.prototype[e]=function(t,r){return this.request(Hi(r||{},{method:e,url:t,data:(r||{}).data}))}})),qi.forEach(["post","put","patch"],(function(e){Wi.prototype[e]=function(t,r,n){return this.request(Hi(n||{},{method:e,url:t,data:r}))}}));var Ji=en,Zi=Hr,Xi=Wi,Qi=Ri;function eo(e){var t=new Xi(e),r=Zi(Xi.prototype.request,t);return Ji.extend(r,Xi.prototype,t),Ji.extend(r,t),r}var to=eo(mi);to.Axios=Xi,to.create=function(e){return eo(Qi(to.defaults,e))},to.Cancel=Ki(),to.CancelToken=function(){if(Mi)return Bi;Mi=1;var e=Ki();function t(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var r;this.promise=new Promise((function(e){r=e}));var n=this;t((function(t){n.reason||(n.reason=new e(t),r(n.reason))}))}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.source=function(){var e;return{token:new t((function(t){e=t})),cancel:e}},Bi=t}(),to.isCancel=bi(),to.all=function(e){return Promise.all(e)},to.spread=Ci?Di:(Ci=1,Di=function(e){return function(t){return e.apply(null,t)}}),to.isAxiosError=Fi?Ui:(Fi=1,Ui=function(e){return"object"==typeof e&&!0===e.isAxiosError}),zr.exports=to,Vr.default=to,$r.exports=Vr;var ro={},no={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RequiredError=e.BaseAPI=e.COLLECTION_FORMATS=e.BASE_PATH=void 0;const t=qr;e.BASE_PATH="http://localhost/market-api/v1".replace(/\/+$/,""),e.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"\t",pipes:"|"};e.BaseAPI=class{constructor(r,n=e.BASE_PATH,i=t.default){this.basePath=n,this.axios=i,r&&(this.configuration=r,this.basePath=r.basePath||this.basePath)}};class r extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}e.RequiredError=r}(no);var io=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(ro,"__esModule",{value:!0}),ro.createRequestFunction=ro.toPathString=ro.serializeDataIfNeeded=ro.setSearchParams=ro.setOAuthToObject=ro.setBearerAuthToObject=ro.setBasicAuthToObject=ro.setApiKeyToObject=ro.assertParamExists=ro.DUMMY_BASE_URL=void 0;const oo=no;var so;function ao(){return so||(so=1,function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(Fr(),e),r(Lr,e)}(or)),or}ro.DUMMY_BASE_URL="https://example.com",ro.assertParamExists=function(e,t,r){if(null==r)throw new oo.RequiredError(t,`Required parameter ${t} was null or undefined when calling ${e}.`)},ro.setApiKeyToObject=function(e,t,r){return io(this,void 0,void 0,(function*(){if(r&&r.apiKey){const n="function"==typeof r.apiKey?yield r.apiKey(t):yield r.apiKey;e[t]=n}}))},ro.setBasicAuthToObject=function(e,t){t&&(t.username||t.password)&&(e.auth={username:t.username,password:t.password})},ro.setBearerAuthToObject=function(e,t){return io(this,void 0,void 0,(function*(){if(t&&t.accessToken){const r="function"==typeof t.accessToken?yield t.accessToken():yield t.accessToken;e.Authorization="Bearer "+r}}))},ro.setOAuthToObject=function(e,t,r,n){return io(this,void 0,void 0,(function*(){if(n&&n.accessToken){const i="function"==typeof n.accessToken?yield n.accessToken(t,r):yield n.accessToken;e.Authorization="Bearer "+i}}))},ro.setSearchParams=function(e,...t){const r=new URLSearchParams(e.search);for(const e of t)for(const t in e)if(Array.isArray(e[t])){r.delete(t);for(const n of e[t])r.append(t,n)}else r.set(t,e[t]);e.search=r.toString()},ro.serializeDataIfNeeded=function(e,t,r){const n="string"!=typeof e;return(n&&r&&r.isJsonMime?r.isJsonMime(t.headers["Content-Type"]):n)?JSON.stringify(void 0!==e?e:{}):e||""},ro.toPathString=function(e){return e.pathname+e.search+e.hash},ro.createRequestFunction=function(e,t,r,n){return(i=t,o=r)=>{const s=Object.assign(Object.assign({},e.options),{url:((null==n?void 0:n.basePath)||o)+e.url});return i.request(s)}},function(e){var t=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.RequestorApi=e.RequestorApiFactory=e.RequestorApiFp=e.RequestorApiAxiosParamCreator=void 0;const r=qr,n=ro,i=no;e.RequestorApiAxiosParamCreator=function(e){return{cancelAgreement:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("cancelAgreement","agreementId",r);const t="/agreements/{agreementId}/cancel".replace("{agreementId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={};yield n.setBearerAuthToObject(u,e),u["Content-Type"]="application/json",n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),c.data=n.serializeDataIfNeeded(i,c,e),{url:n.toPathString(s),options:c}})),collectAgreementEvents:(r,i,o,s,a={})=>t(this,void 0,void 0,(function*(){const t=new URL("/agreementEvents",n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"GET"},c),a),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==r&&(h.timeout=r),void 0!==i&&(h.afterTimestamp=i instanceof Date?i.toISOString():i),void 0!==o&&(h.maxEvents=o),void 0!==s&&(h.appSessionId=s),n.setSearchParams(t,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),a.headers),{url:n.toPathString(t),options:u}})),collectOffers:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("collectOffers","subscriptionId",r);const t="/demands/{subscriptionId}/events".replace("{subscriptionId}",encodeURIComponent(String(r))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"GET"},c),s),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==i&&(h.timeout=i),void 0!==o&&(h.maxEvents=o),n.setSearchParams(a,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),s.headers),{url:n.toPathString(a),options:u}})),confirmAgreement:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("confirmAgreement","agreementId",r);const t="/agreements/{agreementId}/confirm".replace("{agreementId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={},l={};yield n.setBearerAuthToObject(u,e),void 0!==i&&(l.appSessionId=i),n.setSearchParams(s,l);let h=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),h),o.headers),{url:n.toPathString(s),options:c}})),counterProposalDemand:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("counterProposalDemand","subscriptionId",r),n.assertParamExists("counterProposalDemand","proposalId",i),n.assertParamExists("counterProposalDemand","demandOfferBase",o);const t="/demands/{subscriptionId}/proposals/{proposalId}".replace("{subscriptionId}",encodeURIComponent(String(r))).replace("{proposalId}",encodeURIComponent(String(i))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),s),l={};yield n.setBearerAuthToObject(l,e),l["Content-Type"]="application/json",n.setSearchParams(a,{});let h=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),h),s.headers),u.data=n.serializeDataIfNeeded(o,u,e),{url:n.toPathString(a),options:u}})),createAgreement:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("createAgreement","agreementProposal",r);const t=new URL("/agreements",n.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},o),i),a={};yield n.setBearerAuthToObject(a,e),a["Content-Type"]="application/json",n.setSearchParams(t,{});let c=o&&o.headers?o.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},a),c),i.headers),s.data=n.serializeDataIfNeeded(r,s,e),{url:n.toPathString(t),options:s}})),getAgreement:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getAgreement","agreementId",r);const t="/agreements/{agreementId}".replace("{agreementId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getDemands:(r={})=>t(this,void 0,void 0,(function*(){const t=new URL("/demands",n.DUMMY_BASE_URL);let i;e&&(i=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},i),r),s={};yield n.setBearerAuthToObject(s,e),n.setSearchParams(t,{});let a=i&&i.headers?i.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},s),a),r.headers),{url:n.toPathString(t),options:o}})),getProposalOffer:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getProposalOffer","subscriptionId",r),n.assertParamExists("getProposalOffer","proposalId",i);const t="/demands/{subscriptionId}/proposals/{proposalId}".replace("{subscriptionId}",encodeURIComponent(String(r))).replace("{proposalId}",encodeURIComponent(String(i))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"GET"},a),o),u={};yield n.setBearerAuthToObject(u,e),n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),{url:n.toPathString(s),options:c}})),queryReplyDemands:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("queryReplyDemands","subscriptionId",r),n.assertParamExists("queryReplyDemands","queryId",i),n.assertParamExists("queryReplyDemands","body",o);const t="/demands/{subscriptionId}/propertyQuery/{queryId}".replace("{subscriptionId}",encodeURIComponent(String(r))).replace("{queryId}",encodeURIComponent(String(i))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),s),l={};yield n.setBearerAuthToObject(l,e),l["Content-Type"]="application/json",n.setSearchParams(a,{});let h=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),h),s.headers),u.data=n.serializeDataIfNeeded(o,u,e),{url:n.toPathString(a),options:u}})),rejectProposalOffer:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("rejectProposalOffer","subscriptionId",r),n.assertParamExists("rejectProposalOffer","proposalId",i);const t="/demands/{subscriptionId}/proposals/{proposalId}/reject".replace("{subscriptionId}",encodeURIComponent(String(r))).replace("{proposalId}",encodeURIComponent(String(i))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),s),l={};yield n.setBearerAuthToObject(l,e),l["Content-Type"]="application/json",n.setSearchParams(a,{});let h=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),h),s.headers),u.data=n.serializeDataIfNeeded(o,u,e),{url:n.toPathString(a),options:u}})),subscribeDemand:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("subscribeDemand","demandOfferBase",r);const t=new URL("/demands",n.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},o),i),a={};yield n.setBearerAuthToObject(a,e),a["Content-Type"]="application/json",n.setSearchParams(t,{});let c=o&&o.headers?o.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},a),c),i.headers),s.data=n.serializeDataIfNeeded(r,s,e),{url:n.toPathString(t),options:s}})),terminateAgreement:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("terminateAgreement","agreementId",r);const t="/agreements/{agreementId}/terminate".replace("{agreementId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={};yield n.setBearerAuthToObject(u,e),u["Content-Type"]="application/json",n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),c.data=n.serializeDataIfNeeded(i,c,e),{url:n.toPathString(s),options:c}})),unsubscribeDemand:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("unsubscribeDemand","subscriptionId",r);const t="/demands/{subscriptionId}".replace("{subscriptionId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"DELETE"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),waitForApproval:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("waitForApproval","agreementId",r);const t="/agreements/{agreementId}/wait".replace("{agreementId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={},l={};yield n.setBearerAuthToObject(u,e),void 0!==i&&(l.timeout=i),n.setSearchParams(s,l);let h=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),h),o.headers),{url:n.toPathString(s),options:c}}))}},e.RequestorApiFp=function(o){const s=e.RequestorApiAxiosParamCreator(o);return{cancelAgreement(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.cancelAgreement(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},collectAgreementEvents(e,a,c,u,l){return t(this,void 0,void 0,(function*(){const t=yield s.collectAgreementEvents(e,a,c,u,l);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},collectOffers(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.collectOffers(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},confirmAgreement(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.confirmAgreement(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},counterProposalDemand(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.counterProposalDemand(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},createAgreement(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.createAgreement(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getAgreement(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getAgreement(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getDemands(e){return t(this,void 0,void 0,(function*(){const t=yield s.getDemands(e);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getProposalOffer(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.getProposalOffer(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},queryReplyDemands(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.queryReplyDemands(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},rejectProposalOffer(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.rejectProposalOffer(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},subscribeDemand(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.subscribeDemand(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},terminateAgreement(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.terminateAgreement(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},unsubscribeDemand(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.unsubscribeDemand(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},waitForApproval(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.waitForApproval(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))}}},e.RequestorApiFactory=function(t,r,n){const i=e.RequestorApiFp(t);return{cancelAgreement:(e,t,o)=>i.cancelAgreement(e,t,o).then((e=>e(n,r))),collectAgreementEvents:(e,t,o,s,a)=>i.collectAgreementEvents(e,t,o,s,a).then((e=>e(n,r))),collectOffers:(e,t,o,s)=>i.collectOffers(e,t,o,s).then((e=>e(n,r))),confirmAgreement:(e,t,o)=>i.confirmAgreement(e,t,o).then((e=>e(n,r))),counterProposalDemand:(e,t,o,s)=>i.counterProposalDemand(e,t,o,s).then((e=>e(n,r))),createAgreement:(e,t)=>i.createAgreement(e,t).then((e=>e(n,r))),getAgreement:(e,t)=>i.getAgreement(e,t).then((e=>e(n,r))),getDemands:e=>i.getDemands(e).then((e=>e(n,r))),getProposalOffer:(e,t,o)=>i.getProposalOffer(e,t,o).then((e=>e(n,r))),queryReplyDemands:(e,t,o,s)=>i.queryReplyDemands(e,t,o,s).then((e=>e(n,r))),rejectProposalOffer:(e,t,o,s)=>i.rejectProposalOffer(e,t,o,s).then((e=>e(n,r))),subscribeDemand:(e,t)=>i.subscribeDemand(e,t).then((e=>e(n,r))),terminateAgreement:(e,t,o)=>i.terminateAgreement(e,t,o).then((e=>e(n,r))),unsubscribeDemand:(e,t)=>i.unsubscribeDemand(e,t).then((e=>e(n,r))),waitForApproval:(e,t,o)=>i.waitForApproval(e,t,o).then((e=>e(n,r)))}};e.RequestorApi=class extends i.BaseAPI{cancelAgreement(t,r,n){return e.RequestorApiFp(this.configuration).cancelAgreement(t,r,n).then((e=>e(this.axios,this.basePath)))}collectAgreementEvents(t,r,n,i,o){return e.RequestorApiFp(this.configuration).collectAgreementEvents(t,r,n,i,o).then((e=>e(this.axios,this.basePath)))}collectOffers(t,r,n,i){return e.RequestorApiFp(this.configuration).collectOffers(t,r,n,i).then((e=>e(this.axios,this.basePath)))}confirmAgreement(t,r,n){return e.RequestorApiFp(this.configuration).confirmAgreement(t,r,n).then((e=>e(this.axios,this.basePath)))}counterProposalDemand(t,r,n,i){return e.RequestorApiFp(this.configuration).counterProposalDemand(t,r,n,i).then((e=>e(this.axios,this.basePath)))}createAgreement(t,r){return e.RequestorApiFp(this.configuration).createAgreement(t,r).then((e=>e(this.axios,this.basePath)))}getAgreement(t,r){return e.RequestorApiFp(this.configuration).getAgreement(t,r).then((e=>e(this.axios,this.basePath)))}getDemands(t){return e.RequestorApiFp(this.configuration).getDemands(t).then((e=>e(this.axios,this.basePath)))}getProposalOffer(t,r,n){return e.RequestorApiFp(this.configuration).getProposalOffer(t,r,n).then((e=>e(this.axios,this.basePath)))}queryReplyDemands(t,r,n,i){return e.RequestorApiFp(this.configuration).queryReplyDemands(t,r,n,i).then((e=>e(this.axios,this.basePath)))}rejectProposalOffer(t,r,n,i){return e.RequestorApiFp(this.configuration).rejectProposalOffer(t,r,n,i).then((e=>e(this.axios,this.basePath)))}subscribeDemand(t,r){return e.RequestorApiFp(this.configuration).subscribeDemand(t,r).then((e=>e(this.axios,this.basePath)))}terminateAgreement(t,r,n){return e.RequestorApiFp(this.configuration).terminateAgreement(t,r,n).then((e=>e(this.axios,this.basePath)))}unsubscribeDemand(t,r){return e.RequestorApiFp(this.configuration).unsubscribeDemand(t,r).then((e=>e(this.axios,this.basePath)))}waitForApproval(t,r,n){return e.RequestorApiFp(this.configuration).waitForApproval(t,r,n).then((e=>e(this.axios,this.basePath)))}}}(Lr);var co=ao(),uo=Fr();const lo={basePath:"http://127.0.0.1:7465",subnetTag:"public",marketTimeout:18e4,maxOfferEvents:10,offerFetchingInterval:1e4,marketOfferExpiration:9e5,debitNotesAcceptanceTimeout:30};class ho{api;yagnaOptions;timeout;expiration;subnetTag;maxOfferEvents;offerFetchingInterval;proposalTimeout;logger;eventTarget;constructor(e){const t=e?.yagnaOptions?.apiKey||process.env.YAGNA_APPKEY;if(!t)throw new Error("Api key not defined");const r=e?.yagnaOptions?.basePath||process.env.YAGNA_API_URL||lo.basePath,n=new uo.Configuration({apiKey:t,basePath:`${r}/market-api/v1`,accessToken:t});this.yagnaOptions=e?.yagnaOptions,this.api=new co.RequestorApi(n),this.subnetTag=e?.subnetTag||process.env.YAGNA_SUBNET||lo.subnetTag,this.timeout=e?.marketTimeout||lo.marketTimeout,this.expiration=e?.marketOfferExpiration||lo.marketOfferExpiration,this.offerFetchingInterval=e?.offerFetchingInterval||lo.offerFetchingInterval,this.logger=e?.logger,this.maxOfferEvents=e?.maxOfferEvents||lo.maxOfferEvents,this.eventTarget=e?.eventTarget}}class fo extends ho{debitNotesAcceptanceTimeout;constructor(e){super(e),this.debitNotesAcceptanceTimeout=e?.debitNotesAcceptanceTimeout||lo.debitNotesAcceptanceTimeout}}class po{agreementPoolService;options;marketStrategy;demand;allowedPaymentPlatforms=[];logger;constructor(e,t){this.agreementPoolService=e,this.options=new fo(t),this.marketStrategy=t?.strategy||new er(this.agreementPoolService,this.logger),this.logger=this.options?.logger}async run(e,t){for(const e of t)e.paymentPlatform&&this.allowedPaymentPlatforms.push(e.paymentPlatform);this.demand=await Go.create(e,t,this.options),this.demand.addEventListener(Yo,(e=>{const t=e.proposal;t.isInitial()?this.processInitialProposal(t):t.isDraft()?this.processDraftProposal(t):t.isExpired()?this.logger?.debug(`Proposal hes expired ${t.id}`):t.isRejected()&&this.logger?.debug(`Proposal hes rejected ${t.id}`)})),this.logger?.debug("Market Service has started")}async end(){this.demand&&(this.demand.removeEventListener(Yo,null),await this.demand.unsubscribe().catch((e=>this.logger?.error(`Could not unsubscribe demand. ${e}`)))),this.logger?.debug("Market Service has been stopped")}async processInitialProposal(e){this.logger?.debug(`New proposal has been received (${e.id})`);const t=this.marketStrategy.scoreProposal(e);e.score=t,this.logger?.debug(`Scored proposal ${e.id}. Score: ${t}`);try{const{result:t,reason:r}=this.isProposalValid(e);if(t){const t=this.getCommonPaymentPlatforms(e.properties)[0];await e.respond(t).catch((e=>this.logger?.debug(e))),this.logger?.debug(`Proposal has been responded (${e.id})`)}else await e.reject(r),this.logger?.debug(`Proposal has been rejected (${e.id}). Reason: ${r}`)}catch(e){this.logger?.error(e)}}isProposalValid(e){const t=e.properties["golem.com.payment.debit-notes.accept-timeout?"];if(t&&t<this.options.debitNotesAcceptanceTimeout)return{result:!1,reason:"Debit note acceptance timeout too short"};const r=this.getCommonPaymentPlatforms(e.properties);return r?.length?e.score&&e.score<0?{result:!1,reason:"Score is to low"}:{result:!0}:{result:!1,reason:"No common payment platform"}}async processDraftProposal(e){this.agreementPoolService.addProposal(e.id),this.logger?.debug(`Proposal has been confirmed with provider ${e.issuerId} and added to agreement pool (${e.id})`)}getCommonPaymentPlatforms(e){const t=Object.keys(e).filter((e=>e.startsWith("golem.com.payment.platform."))).map((e=>e.split(".")[4]))||["NGNT"];return this.allowedPaymentPlatforms.filter((e=>t.includes(e)))}}const go="GolemEvent";class mo extends Event{detail;constructor(e,t){super(e,t),this.detail=t.detail}}class vo extends mo{constructor(e){super(go,{detail:e})}}class yo extends vo{}class bo extends vo{}class wo extends vo{}class So extends vo{}class Po extends vo{}class Ao extends vo{}class Oo extends vo{}class Eo extends vo{}class Ro extends vo{}class _o extends vo{}class Io extends vo{}class jo extends vo{}class To extends vo{}class xo extends vo{}class ko extends vo{}class No extends vo{}class Bo extends vo{}class Mo extends vo{}class Do extends vo{}class Co extends vo{}class Uo extends vo{}class Fo extends vo{}class Lo extends vo{}class qo extends vo{}class $o extends vo{}class Vo extends vo{}class zo{taskPackage;allocations;options;constructor(e,t,r){this.taskPackage=e,this.allocations=t,this.options=new ho(r)}async create(){const e=await this.getDecorations(),r=(new t).addDecorations(e).getDemandRequest(),{data:n}=await this.options.api.subscribeDemand(r).catch((e=>{const t=e.response?.data?.message||e.toString();throw this.options.eventTarget?.dispatchEvent(new _o({reason:t})),new Error(`Could not publish demand on the market. ${t}`)}));return this.options.eventTarget?.dispatchEvent(new Ro({id:n})),this.options.logger?.info("Demand published on the market"),new Go(n,r,this.options)}async getDecorations(){const e=await this.taskPackage.getDemandDecoration(),t=[];for(const e of this.allocations)t.push(await e.getDemandDecoration());const r=this.getBaseDecorations();return[e,...t,r]}getBaseDecorations(){return(new t).addProperty("golem.srv.caps.multi-activity",!0).addProperty("golem.srv.comp.expiration",Date.now()+this.options.expiration).addProperty("golem.node.debug.subnet",this.options.subnetTag).addConstraint("golem.com.pricing.model","linear").addConstraint("golem.node.debug.subnet",this.options.subnetTag).getDecorations()}}class Ho{subscriptionId;api;demandRequest;eventTarget;id;issuerId;properties;constraints;timestamp;state;prevProposalId;_score=null;constructor(e,t,r,n,i){this.subscriptionId=e,this.api=t,this.demandRequest=n,this.eventTarget=i,this.id=r.proposalId,this.issuerId=r.issuerId,this.properties=r.properties,this.constraints=r.constraints,this.state=r.state,this.prevProposalId=r.prevProposalId,this.timestamp=r.timestamp}set score(e){this._score=e}get score(){return this._score}isInitial(){return this.state===ur.ProposalAllOfStateEnum.Initial}isDraft(){return this.state===ur.ProposalAllOfStateEnum.Draft}isExpired(){return this.state===ur.ProposalAllOfStateEnum.Expired}isRejected(){return this.state===ur.ProposalAllOfStateEnum.Rejected}async reject(e="no reason"){await this.api.rejectProposalOffer(this.subscriptionId,this.id,{message:e}).catch((e=>{throw new Error(e?.response?.data?.message||e)})),this.eventTarget?.dispatchEvent(new To({id:this.id,providerId:this.issuerId}))}async respond(e){this.demandRequest.properties["golem.com.payment.chosen-platform"]=e,await this.api.counterProposalDemand(this.subscriptionId,this.id,this.demandRequest,{timeout:2e4}).catch((e=>{throw new Error(e?.response?.data?.message||e)})),this.eventTarget?.dispatchEvent(new xo({id:this.id,providerId:this.issuerId}))}}const Yo="ProposalReceived";class Go extends EventTarget{id;demandRequest;options;isRunning=!0;logger;static async create(e,t,r){return new zo(e,t,r).create()}constructor(e,t,r){super(),this.id=e,this.demandRequest=t,this.options=r,this.logger=this.options.logger,this.subscribe().catch((e=>this.logger?.error(e)))}async unsubscribe(){this.isRunning=!1,await this.options.api.unsubscribeDemand(this.id),this.removeEventListener(Yo,null),this.logger?.debug(`Demand ${this.id} unsubscribed`)}async subscribe(){for(;this.isRunning;)try{const{data:e}=await this.options.api.collectOffers(this.id,3,this.options.maxOfferEvents,{timeout:5e3});for(const t of e){if("ProposalRejectedEvent"===t.eventType){this.logger?.debug(`Proposal rejected. Reason: ${t.reason?.message}`);continue}if("ProposalEvent"!==t.eventType)continue;const e=new Ho(this.id,this.options.api,t.proposal,this.demandRequest,this.options.eventTarget);this.dispatchEvent(new Wo(Yo,e)),this.options.eventTarget?.dispatchEvent(new jo({id:e.id,providerId:e.issuerId}))}}catch(e){if(this.isRunning){const t=e.response?.data?.message||e;this.options.eventTarget?.dispatchEvent(new Io({id:this.id,reason:t})),this.logger?.warn(`Unable to collect offers. ${t}`)}}finally{await Ct(this.options.offerFetchingInterval,!0)}}}class Wo extends Event{proposal;constructor(e,t){super(e,t),this.proposal=t}}const Ko="http://127.0.0.1:7465",Jo=3e4,Zo=5,Xo=100,Qo=1e4,es=60;class ts{options;agreementRequestTimeout;agreementWaitingForApprovalTimeout;api;logger;eventTarget;constructor(e){this.options=e;const t=e?.yagnaOptions?.apiKey||process.env.YAGNA_APPKEY;if(!t)throw new Error("Api key not defined");const r=e?.yagnaOptions?.basePath||process.env.YAGNA_API_URL||Ko,n=new uo.Configuration({apiKey:t,basePath:`${r}/market-api/v1`,accessToken:t});this.api=new co.RequestorApi(n),this.agreementRequestTimeout=e?.agreementRequestTimeout||Jo,this.agreementWaitingForApprovalTimeout=e?.agreementWaitingForApprovalTimeout||es,this.logger=e?.logger,this.eventTarget=e?.eventTarget}}class rs extends ts{agreementEventPoolingInterval;agreementEventPoolingMaxEventsPerRequest;agreementWaitingForProposalTimout;constructor(e){super(e),this.agreementWaitingForProposalTimout=e?.agreementWaitingForProposalTimout||Qo,this.agreementEventPoolingInterval=e?.agreementEventPoolingInterval||Zo,this.agreementEventPoolingMaxEventsPerRequest=e?.agreementEventPoolingMaxEventsPerRequest||Xo}}class ns{logger;options;constructor(e){this.options=new ts(e),this.logger=e?.logger}async create(e){try{const t={proposalId:e,validTo:new Date(+new Date+3600).toISOString()},{data:r}=await this.options.api.createAgreement(t,{timeout:this.options.agreementRequestTimeout}),{data:n}=await this.options.api.getAgreement(r),i={name:n?.offer.properties["golem.node.id.name"],id:n?.offer.providerId};if(!i.id||!i.name)throw new Error("Unable to get provider info");const o=new os(r,i,this.options);return this.options.eventTarget?.dispatchEvent(new ko({id:r,providerId:i.id,providerName:i.name,proposalId:e})),this.logger?.debug(`Agreement ${r} created`),o}catch(e){throw new Error(`Unable to create agreement ${e?.response?.data?.message||e?.response?.data||e}`)}}}var is;!function(e){e.Proposal="Proposal",e.Pending="Pending",e.Cancelled="Cancelled",e.Rejected="Rejected",e.Approved="Approved",e.Expired="Expired",e.Terminated="Terminated"}(is||(is={}));class os{id;provider;options;agreementData;logger;constructor(e,t,r){this.id=e,this.provider=t,this.options=r,this.logger=r.logger}static async create(e,t){return new ns(t).create(e)}async refreshDetails(){const{data:e}=await this.options.api.getAgreement(this.id,{timeout:this.options.agreementRequestTimeout});this.agreementData=e}async getState(){return await this.refreshDetails(),this.agreementData.state}async confirm(){try{await this.options.api.confirmAgreement(this.id),await this.options.api.waitForApproval(this.id,this.options.agreementWaitingForApprovalTimeout),this.logger?.debug(`Agreement ${this.id} approved`),this.options.eventTarget?.dispatchEvent(new No({id:this.id,providerId:this.provider.id}))}catch(e){throw this.logger?.error(`Unable to confirm agreement ${this.id}. ${e}`),e}}async isFinalState(){const e=await this.getState();return e!==is.Pending&&e!==is.Proposal}async terminate(e={message:"Finished"}){try{await this.options.api.terminateAgreement(this.id,e),this.options.eventTarget?.dispatchEvent(new Mo({id:this.id,providerId:this.provider.id})),this.logger?.debug(`Agreement ${this.id} terminated`)}catch(e){throw new Error(`Unable to terminate agreement ${this.id}. ${e.response?.data?.message||e.response?.data||e}`)}}}class ss{agreementServiceOptions;logger;config;proposals=[];agreements=new Map;agreementIdsToReuse=[];isServiceRunning=!1;lastAgreementRejectedByProvider=new Map;initialTime=Date.now();constructor(e){this.agreementServiceOptions=e,this.config=new rs(e),this.logger=e?.logger}async run(){this.isServiceRunning=!0,this.initialTime=+new Date,this.logger?.debug("Agreement Pool Service has started")}addProposal(e){this.proposals.push(e),this.logger?.debug(`New offer proposal added to pool (${e})`)}async getAgreement(){let e;for(;!e&&this.isServiceRunning;)e=await this.getAvailableAgreement()||await this.createAgreement();if(!e&&!this.isServiceRunning)throw new Error("Unable to get agreement. Agreement service is not running");return e}async releaseAgreement(e,t=!1){const r=await this.agreements.get(e);if(!r)throw new Error(`Agreement ${e} cannot found in pool`);t?(this.agreementIdsToReuse.unshift(e),this.logger?.debug(`Agreement ${e} has been released for reuse`)):(await r.terminate(),this.agreements.delete(e),this.logger?.debug(`Agreement ${e} has been released and terminated`))}async end(){this.isServiceRunning=!1,await this.terminateAll({message:"All computations done"}),this.logger?.debug("Agreement Pool Service has been stopped")}isProviderLastAgreementRejected(e){return!!this.lastAgreementRejectedByProvider.get(e)}async terminateAll(e){for(const t of this.agreements.values())await t.getState()!==is.Terminated&&await t.terminate(e).catch((e=>this.logger?.warn(`Agreement ${t.id} cannot be terminated. ${e}`)))}async getAvailableAgreement(){let e;for(;!e&&this.agreementIdsToReuse.length>0;){const t=this.agreementIdsToReuse.pop();if(!t)continue;const r=this.agreements.get(t);if(!r)throw new Error(`Agreement ${t} cannot found in pool`);const n=await r.getState().catch((e=>{this.logger?.warn(`Unable to retrieve state of agreement ${r.id}. `+e)}));n===is.Approved?e=r:this.logger?.debug(`Agreement ${r.id} is no longer available. Current state: ${n}`)}return e}async createAgreement(){let e;for(;!e&&this.isServiceRunning;){const t=await this.getAvailableProposal();if(!t)break;this.logger?.debug(`Creating agreement using proposal ID: ${t}`);try{e=await os.create(t,this.config.options),e=await this.waitForAgreementApproval(e);const r=await e.getState();if(this.lastAgreementRejectedByProvider.set(e.provider.id,r===is.Rejected),r!==is.Approved)throw new Error(`Agreement ${e.id} cannot be approved. Current state: ${r}`)}catch(t){this.logger?.error(`Unable to create agreement form available proposal: ${t?.data?.message||t}`),await Ct(2),e=null}}return e?(this.agreements.set(e.id,e),this.logger?.info(`Agreement confirmed by provider ${e.provider.name}`)):this.isServiceRunning&&this.logger?.debug("Agreement cannot be created due to no available offers from market"),e}async getAvailableProposal(){let e,t=!1;const r=setTimeout((()=>t=!0),this.config.agreementWaitingForProposalTimout);for(;!e&&this.isServiceRunning&&!t;)e=this.proposals.pop(),e||(+new Date>this.initialTime+9e3&&this.logger?.warn("No offers have been collected from the market"),await Ct(10));return clearTimeout(r),this.initialTime=+new Date,e}async waitForAgreementApproval(e){return await e.getState()===is.Proposal&&(await e.confirm(),this.logger?.debug(`Agreement proposed to provider '${e.provider.name}'`)),await this.config.api.waitForApproval(e.id,this.config.agreementWaitingForApprovalTimeout),e}}var as={};function cs(){}function us(){us.init.call(this)}function ls(e){return void 0===e._maxListeners?us.defaultMaxListeners:e._maxListeners}function hs(e,t,r,n){var i,o,s,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]):(o=e._events=new cs,e._eventsCount=0),s){if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),!s.warned&&(i=ls(e))&&i>0&&s.length>i){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=o[t]=r,++e._eventsCount;return e}function ds(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function fs(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function ps(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}cs.prototype=Object.create(null),us.EventEmitter=us,us.usingDomains=!1,us.prototype.domain=void 0,us.prototype._events=void 0,us.prototype._maxListeners=void 0,us.defaultMaxListeners=10,us.init=function(){this.domain=null,us.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new cs,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},us.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},us.prototype.getMaxListeners=function(){return ls(this)},us.prototype.emit=function(e){var t,r,n,i,o,s,a,c="error"===e;if(s=this._events)c=c&&null==s.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=s[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=ps(e,n),o=0;o<n;++o)i[o].call(r)}(r,l,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,o=ps(e,i),s=0;s<i;++s)o[s].call(r,n)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=e.length,s=ps(e,o),a=0;a<o;++a)s[a].call(r,n,i)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var s=e.length,a=ps(e,s),c=0;c<s;++c)a[c].call(r,n,i,o)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,o=ps(e,i),s=0;s<i;++s)o[s].apply(r,n)}(r,l,this,i)}return!0},us.prototype.addListener=function(e,t){return hs(this,e,t,!1)},us.prototype.on=us.prototype.addListener,us.prototype.prependListener=function(e,t){return hs(this,e,t,!0)},us.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,ds(this,e,t)),this},us.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,ds(this,e,t)),this},us.prototype.removeListener=function(e,t){var r,n,i,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new cs:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new cs,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,s||t)}return this},us.prototype.off=function(e,t){return this.removeListener(e,t)},us.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new cs,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new cs:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new cs,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},us.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},us.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):fs.call(e,t)},us.prototype.listenerCount=fs,us.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var gs,ms,vs=ir(Object.freeze({__proto__:null,EventEmitter:us,default:us})),ys="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},bs=ir(Object.freeze({__proto__:null,default:ys}));function ws(){return ms?gs:(ms=1,gs=vs.EventEmitter)}var Ss=ir(De),Ps="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},As=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},Os=/%[sdj%]/g;function Es(e){if(!qs(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(Ts(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,o=String(e).replace(Os,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),s=n[r];r<i;s=n[++r])Us(s)||!Hs(s)?o+=" "+s:o+=" "+Ts(s);return o}function Rs(e,t){if(Vs(r.process))return function(){return Rs(e,t).apply(this,arguments)};if(!0===Kn.noDeprecation)return e;var n=!1;return function(){if(!n){if(Kn.throwDeprecation)throw new Error(t);Kn.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}}var _s,Is={};function js(e){if(Vs(_s)&&(_s=Kn.env.NODE_DEBUG||""),e=e.toUpperCase(),!Is[e])if(new RegExp("\\b"+e+"\\b","i").test(_s)){Is[e]=function(){var t=Es.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else Is[e]=function(){};return Is[e]}function Ts(e,t){var r={seen:[],stylize:ks};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),Cs(t)?r.showHidden=t:t&&ta(r,t),Vs(r.showHidden)&&(r.showHidden=!1),Vs(r.depth)&&(r.depth=2),Vs(r.colors)&&(r.colors=!1),Vs(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=xs),Ns(r,e,r.depth)}function xs(e,t){var r=Ts.styles[t];return r?"["+Ts.colors[r][0]+"m"+e+"["+Ts.colors[r][1]+"m":e}function ks(e,t){return e}function Ns(e,t,r){if(e.customInspect&&t&&Ws(t.inspect)&&t.inspect!==Ts&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return qs(n)||(n=Ns(e,n,r)),n}var i=function(e,t){if(Vs(t))return e.stylize("undefined","undefined");if(qs(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(Ls(t))return e.stylize(""+t,"number");if(Cs(t))return e.stylize(""+t,"boolean");if(Us(t))return e.stylize("null","null")}(e,t);if(i)return i;var o=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),Gs(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return Bs(t);if(0===o.length){if(Ws(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(zs(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Ys(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Gs(t))return Bs(t)}var c,u="",l=!1,h=["{","}"];(Ds(t)&&(l=!0,h=["[","]"]),Ws(t))&&(u=" [Function"+(t.name?": "+t.name:"")+"]");return zs(t)&&(u=" "+RegExp.prototype.toString.call(t)),Ys(t)&&(u=" "+Date.prototype.toUTCString.call(t)),Gs(t)&&(u=" "+Bs(t)),0!==o.length||l&&0!=t.length?r<0?zs(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=l?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)ra(t,String(s))?o.push(Ms(e,t,r,n,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(Ms(e,t,r,n,i,!0))})),o}(e,t,r,s,o):o.map((function(n){return Ms(e,t,r,s,n,l)})),e.seen.pop(),function(e,t,r){var n=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(n>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,u,h)):h[0]+u+h[1]}function Bs(e){return"["+Error.prototype.toString.call(e)+"]"}function Ms(e,t,r,n,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),ra(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=Us(r)?Ns(e,c.value,null):Ns(e,c.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),Vs(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function Ds(e){return Array.isArray(e)}function Cs(e){return"boolean"==typeof e}function Us(e){return null===e}function Fs(e){return null==e}function Ls(e){return"number"==typeof e}function qs(e){return"string"==typeof e}function $s(e){return"symbol"==typeof e}function Vs(e){return void 0===e}function zs(e){return Hs(e)&&"[object RegExp]"===Zs(e)}function Hs(e){return"object"==typeof e&&null!==e}function Ys(e){return Hs(e)&&"[object Date]"===Zs(e)}function Gs(e){return Hs(e)&&("[object Error]"===Zs(e)||e instanceof Error)}function Ws(e){return"function"==typeof e}function Ks(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function Js(e){return Z.isBuffer(e)}function Zs(e){return Object.prototype.toString.call(e)}function Xs(e){return e<10?"0"+e.toString(10):e.toString(10)}Ts.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Ts.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Qs=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ea(){var e,t;console.log("%s - %s",(e=new Date,t=[Xs(e.getHours()),Xs(e.getMinutes()),Xs(e.getSeconds())].join(":"),[e.getDate(),Qs[e.getMonth()],t].join(" ")),Es.apply(null,arguments))}function ta(e,t){if(!t||!Hs(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function ra(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var na="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function ia(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(na&&e[na]){var t;if("function"!=typeof(t=e[na]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,na,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise((function(e,n){t=e,r=n})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),na&&Object.defineProperty(t,na,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,As(e))}function oa(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}function sa(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);var n=t.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var i=this,o=function(){return n.apply(i,arguments)};e.apply(this,t).then((function(e){Kn.nextTick(o.bind(null,null,e))}),(function(e){Kn.nextTick(oa.bind(null,e,o))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,As(e)),t}ia.custom=na;var aa,ca,ua,la,ha={inherits:Ps,_extend:ta,log:ea,isBuffer:Js,isPrimitive:Ks,isFunction:Ws,isError:Gs,isDate:Ys,isObject:Hs,isRegExp:zs,isUndefined:Vs,isSymbol:$s,isString:qs,isNumber:Ls,isNullOrUndefined:Fs,isNull:Us,isBoolean:Cs,isArray:Ds,inspect:Ts,deprecate:Rs,format:Es,debuglog:js,promisify:ia,callbackify:sa},da=ir(Object.freeze({__proto__:null,_extend:ta,callbackify:sa,debuglog:js,default:ha,deprecate:Rs,format:Es,inherits:Ps,inspect:Ts,isArray:Ds,isBoolean:Cs,isBuffer:Js,isDate:Ys,isError:Gs,isFunction:Ws,isNull:Us,isNullOrUndefined:Fs,isNumber:Ls,isObject:Hs,isPrimitive:Ks,isRegExp:zs,isString:qs,isSymbol:$s,isUndefined:Vs,log:ea,promisify:ia}));function fa(){if(ca)return aa;function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function i(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}ca=1;var o=Ss.Buffer,s=da.inspect,a=s&&s.custom||"inspect";return aa=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var r,i,c;return r=e,(i=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return o.alloc(0);for(var t,r,n,i=o.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,r=i,n=a,o.prototype.copy.call(t,r,n),a+=s.data.length,s=s.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?n+=i:n+=i.slice(0,e),0==(e-=o)){o===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=o.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,s),0==(e-=s)){s===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(s));break}++n}return this.length-=n,t}},{key:a,value:function(e,r){return s(this,t(t({},r),{},{depth:0,customInspect:!1}))}}])&&n(r.prototype,i),c&&n(r,c),Object.defineProperty(r,"prototype",{writable:!1}),e}()}function pa(){if(la)return ua;function e(e,n){r(e,n),t(e)}function t(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}return la=1,ua={destroy:function(n,i){var o=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return s||a?(i?i(n):n&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Kn.nextTick(r,this,n)):Kn.nextTick(r,this,n)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(n||null,(function(r){!i&&r?o._writableState?o._writableState.errorEmitted?Kn.nextTick(t,o):(o._writableState.errorEmitted=!0,Kn.nextTick(e,o,r)):Kn.nextTick(e,o,r):i?(Kn.nextTick(t,o),i(r)):Kn.nextTick(t,o)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}var ga,ma,va,ya,ba,wa,Sa,Pa,Aa,Oa={};function Ea(){if(ga)return Oa;ga=1;var e={};function t(t,r,n){n||(n=Error);var i=function(e){var t,n;function i(t,n,i){return e.call(this,function(e,t,n){return"string"==typeof r?r:r(e,t,n)}(t,n,i))||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(n);i.prototype.name=n.name,i.prototype.code=t,e[t]=i}function r(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}return t("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),t("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,o;if("string"==typeof t&&function(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}(t,"not ")?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))o="The ".concat(e," ").concat(i," ").concat(r(t,"type"));else{var s=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(s," ").concat(i," ").concat(r(t,"type"))}return o+=". Received type ".concat(typeof n)}),TypeError),t("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),t("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),t("ERR_STREAM_PREMATURE_CLOSE","Premature close"),t("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),t("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),t("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),t("ERR_STREAM_WRITE_AFTER_END","write after end"),t("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),t("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),t("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),Oa.codes=e,Oa}function Ra(){if(va)return ma;va=1;var e=Ea().codes.ERR_INVALID_OPT_VALUE;return ma={getHighWaterMark:function(t,r,n,i){var o=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(r,i,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new e(i?n:"highWaterMark",o);return Math.floor(o)}return t.objectMode?16:16384}}}function _a(){if(ba)return ya;function e(e){try{if(!nr.localStorage)return!1}catch(e){return!1}var t=nr.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}return ba=1,ya=function(t,r){if(e("noDeprecation"))return t;var n=!1;return function(){if(!n){if(e("throwDeprecation"))throw new Error(r);e("traceDeprecation")?console.trace(r):console.warn(r),n=!0}return t.apply(this,arguments)}},ya}function Ia(){if(Sa)return wa;function e(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var t;Sa=1,wa=S,S.WritableState=w;var r={deprecate:_a()},n=ws(),i=Ss.Buffer,o=(void 0!==nr?nr:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var s,a=pa(),c=Ra().getHighWaterMark,u=Ea().codes,l=u.ERR_INVALID_ARG_TYPE,h=u.ERR_METHOD_NOT_IMPLEMENTED,d=u.ERR_MULTIPLE_CALLBACK,f=u.ERR_STREAM_CANNOT_PIPE,p=u.ERR_STREAM_DESTROYED,g=u.ERR_STREAM_NULL_VALUES,m=u.ERR_STREAM_WRITE_AFTER_END,v=u.ERR_UNKNOWN_ENCODING,y=a.errorOrDestroy;function b(){}function w(r,n,i){t=t||ja(),r=r||{},"boolean"!=typeof i&&(i=n instanceof t),this.objectMode=!!r.objectMode,i&&(this.objectMode=this.objectMode||!!r.writableObjectMode),this.highWaterMark=c(this,r,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===r.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=r.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if("function"!=typeof i)throw new d;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(Kn.nextTick(i,n),Kn.nextTick(_,e,t),e._writableState.errorEmitted=!0,y(e,n)):(i(n),e._writableState.errorEmitted=!0,y(e,n),_(e,t))}(e,r,n,t,i);else{var o=E(r)||e.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||O(e,r),n?Kn.nextTick(A,e,r,o,i):A(e,r,o,i)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==r.emitClose,this.autoDestroy=!!r.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}function S(e){var r=this instanceof(t=t||ja());if(!r&&!s.call(S,this))return new S(e);this._writableState=new w(e,this,r),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),n.call(this)}function P(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new p("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function A(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),_(e,t)}function O(t,r){r.bufferProcessing=!0;var n=r.bufferedRequest;if(t._writev&&n&&n.next){var i=r.bufferedRequestCount,o=new Array(i),s=r.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)o[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;o.allBuffers=c,P(t,r,!0,r.length,o,"",s.finish),r.pendingcb++,r.lastBufferedRequest=null,s.next?(r.corkedRequestsFree=s.next,s.next=null):r.corkedRequestsFree=new e(r),r.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,h=n.callback;if(P(t,r,!1,r.objectMode?1:u.length,u,l,h),n=n.next,r.bufferedRequestCount--,r.writing)break}null===n&&(r.lastBufferedRequest=null)}r.bufferedRequest=n,r.bufferProcessing=!1}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function R(e,t){e._final((function(r){t.pendingcb--,r&&y(e,r),t.prefinished=!0,e.emit("prefinish"),_(e,t)}))}function _(e,t){var r=E(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,Kn.nextTick(R,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}return bs(S,n),w.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(w.prototype,"buffer",{get:r.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===S&&(e&&e._writableState instanceof w)}})):s=function(e){return e instanceof this},S.prototype.pipe=function(){y(this,new f)},S.prototype.write=function(e,t,r){var n,s=this._writableState,a=!1,c=!s.objectMode&&(n=e,i.isBuffer(n)||n instanceof o);return c&&!i.isBuffer(e)&&(e=function(e){return i.from(e)}(e)),"function"==typeof t&&(r=t,t=null),c?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof r&&(r=b),s.ending?function(e,t){var r=new m;y(e,r),Kn.nextTick(t,r)}(this,r):(c||function(e,t,r,n){var i;return null===r?i=new g:"string"==typeof r||t.objectMode||(i=new l("chunk",["string","Buffer"],r)),!i||(y(e,i),Kn.nextTick(n,i),!1)}(this,s,e,r))&&(s.pendingcb++,a=function(e,t,r,n,o,s){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=i.from(t,r));return t}(t,n,o);n!==a&&(r=!0,o="buffer",n=a)}var c=t.objectMode?1:n.length;t.length+=c;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:o,isBuf:r,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else P(e,t,!1,c,n,o,s);return u}(this,s,c,e,t,r)),a},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||O(this,e))},S.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new v(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(e,t,r){r(new h("_write()"))},S.prototype._writev=null,S.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||function(e,t,r){t.ending=!0,_(e,t),r&&(t.finished?Kn.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),S.prototype.destroy=a.destroy,S.prototype._undestroy=a.undestroy,S.prototype._destroy=function(e,t){t(e)},wa}function ja(){if(Aa)return Pa;Aa=1;var e=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};Pa=s;var t=Xa(),r=Ia();bs(s,t);for(var n=e(r.prototype),i=0;i<n.length;i++){var o=n[i];s.prototype[o]||(s.prototype[o]=r.prototype[o])}function s(e){if(!(this instanceof s))return new s(e);t.call(this,e),r.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",a)))}function a(){this._writableState.ended||Kn.nextTick(c,this)}function c(e){e.end()}return Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),Pa}var Ta=Z.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function xa(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!Ta(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=Na;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=Ba;break;default:return void(this.write=ka)}this.charBuffer=new Z(6),this.charReceived=0,this.charLength=0}function ka(e){return e.toString(this.encoding)}function Na(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function Ba(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}xa.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var i;n=(t+=e.toString(this.encoding,0,n)).length-1;if((i=t.charCodeAt(n))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,n)}return t},xa.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},xa.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t};var Ma,Da,Ca,Ua,Fa,La,qa,$a,Va,za,Ha,Ya,Ga,Wa,Ka=ir(Object.freeze({__proto__:null,StringDecoder:xa}));function Ja(){if(Da)return Ma;Da=1;var e=Ea().codes.ERR_STREAM_PREMATURE_CLOSE;function t(){}return Ma=function r(n,i,o){if("function"==typeof i)return r(n,null,i);i||(i={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(o||t);var s=i.readable||!1!==i.readable&&n.readable,a=i.writable||!1!==i.writable&&n.writable,c=function(){n.writable||l()},u=n._writableState&&n._writableState.finished,l=function(){a=!1,u=!0,s||o.call(n)},h=n._readableState&&n._readableState.endEmitted,d=function(){s=!1,h=!0,a||o.call(n)},f=function(e){o.call(n,e)},p=function(){var t;return s&&!h?(n._readableState&&n._readableState.ended||(t=new e),o.call(n,t)):a&&!u?(n._writableState&&n._writableState.ended||(t=new e),o.call(n,t)):void 0},g=function(){n.req.on("finish",l)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(n)?a&&!n._writableState&&(n.on("end",c),n.on("close",c)):(n.on("complete",l),n.on("abort",p),n.req?g():n.on("request",g)),n.on("end",d),n.on("finish",l),!1!==i.error&&n.on("error",f),n.on("close",p),function(){n.removeListener("complete",l),n.removeListener("abort",p),n.removeListener("request",g),n.req&&n.req.removeListener("finish",l),n.removeListener("end",c),n.removeListener("close",c),n.removeListener("finish",l),n.removeListener("end",d),n.removeListener("error",f),n.removeListener("close",p)}},Ma}function Za(){if(Ua)return Ca;var e;function t(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Ua=1;var r=Ja(),n=Symbol("lastResolve"),i=Symbol("lastReject"),o=Symbol("error"),s=Symbol("ended"),a=Symbol("lastPromise"),c=Symbol("handlePromise"),u=Symbol("stream");function l(e,t){return{value:e,done:t}}function h(e){var t=e[n];if(null!==t){var r=e[u].read();null!==r&&(e[a]=null,e[n]=null,e[i]=null,t(l(r,!1)))}}function d(e){Kn.nextTick(h,e)}var f=Object.getPrototypeOf((function(){})),p=Object.setPrototypeOf((e={get stream(){return this[u]},next:function(){var e=this,t=this[o];if(null!==t)return Promise.reject(t);if(this[s])return Promise.resolve(l(void 0,!0));if(this[u].destroyed)return new Promise((function(t,r){Kn.nextTick((function(){e[o]?r(e[o]):t(l(void 0,!0))}))}));var r,n=this[a];if(n)r=new Promise(function(e,t){return function(r,n){e.then((function(){t[s]?r(l(void 0,!0)):t[c](r,n)}),n)}}(n,this));else{var i=this[u].read();if(null!==i)return Promise.resolve(l(i,!1));r=new Promise(this[c])}return this[a]=r,r}},t(e,Symbol.asyncIterator,(function(){return this})),t(e,"return",(function(){var e=this;return new Promise((function(t,r){e[u].destroy(null,(function(e){e?r(e):t(l(void 0,!0))}))}))})),e),f);return Ca=function(e){var h,f=Object.create(p,(t(h={},u,{value:e,writable:!0}),t(h,n,{value:null,writable:!0}),t(h,i,{value:null,writable:!0}),t(h,o,{value:null,writable:!0}),t(h,s,{value:e._readableState.endEmitted,writable:!0}),t(h,c,{value:function(e,t){var r=f[u].read();r?(f[a]=null,f[n]=null,f[i]=null,e(l(r,!1))):(f[n]=e,f[i]=t)},writable:!0}),h));return f[a]=null,r(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=f[i];return null!==t&&(f[a]=null,f[n]=null,f[i]=null,t(e)),void(f[o]=e)}var r=f[n];null!==r&&(f[a]=null,f[n]=null,f[i]=null,r(l(void 0,!0))),f[s]=!0})),e.on("readable",d.bind(null,f)),f},Ca}function Xa(){if($a)return qa;var e;$a=1,qa=S,S.ReadableState=w,vs.EventEmitter;var t=function(e,t){return e.listeners(t).length},r=ws(),n=Ss.Buffer,i=(void 0!==nr?nr:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var o,s=da;o=s&&s.debuglog?s.debuglog("stream"):function(){};var a,c,u,l=fa(),h=pa(),d=Ra().getHighWaterMark,f=Ea().codes,p=f.ERR_INVALID_ARG_TYPE,g=f.ERR_STREAM_PUSH_AFTER_EOF,m=f.ERR_METHOD_NOT_IMPLEMENTED,v=f.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;bs(S,r);var y=h.errorOrDestroy,b=["error","close","destroy","pause","resume"];function w(t,r,n){e=e||ja(),t=t||{},"boolean"!=typeof n&&(n=r instanceof e),this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=d(this,t,"readableHighWaterMark",n),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(a||(a=Ka.StringDecoder),this.decoder=new a(t.encoding),this.encoding=t.encoding)}function S(t){if(e=e||ja(),!(this instanceof S))return new S(t);var n=this instanceof e;this._readableState=new w(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),r.call(this)}function P(e,t,r,s,a){o("readableAddChunk",t);var c,u=e._readableState;if(null===t)u.reading=!1,function(e,t){if(o("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?R(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,_(e)))}(e,u);else if(a||(c=function(e,t){var r;o=t,n.isBuffer(o)||o instanceof i||"string"==typeof t||void 0===t||e.objectMode||(r=new p("chunk",["string","Buffer","Uint8Array"],t));var o;return r}(u,t)),c)y(e,c);else if(u.objectMode||t&&t.length>0)if("string"==typeof t||u.objectMode||Object.getPrototypeOf(t)===n.prototype||(t=function(e){return n.from(e)}(t)),s)u.endEmitted?y(e,new v):A(e,u,t,!0);else if(u.ended)y(e,new g);else{if(u.destroyed)return!1;u.reading=!1,u.decoder&&!r?(t=u.decoder.write(t),u.objectMode||0!==t.length?A(e,u,t,!1):I(e,u)):A(e,u,t,!1)}else s||(u.reading=!1,I(e,u));return!u.ended&&(u.length<u.highWaterMark||0===u.length)}function A(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&R(e)),I(e,t)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),S.prototype.destroy=h.destroy,S.prototype._undestroy=h.undestroy,S.prototype._destroy=function(e,t){t(e)},S.prototype.push=function(e,t){var r,i=this._readableState;return i.objectMode?r=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=n.from(e,t),t=""),r=!0),P(this,e,t,!1,r)},S.prototype.unshift=function(e){return P(this,e,null,!0,!1)},S.prototype.isPaused=function(){return!1===this._readableState.flowing},S.prototype.setEncoding=function(e){a||(a=Ka.StringDecoder);var t=new a(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var O=1073741824;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=O?e=O:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function R(e){var t=e._readableState;o("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(o("emitReadable",t.flowing),t.emittedReadable=!0,Kn.nextTick(_,e))}function _(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,N(e)}function I(e,t){t.readingMore||(t.readingMore=!0,Kn.nextTick(j,e,t))}function j(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(o("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function T(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function x(e){o("readable nexttick read 0"),e.read(0)}function k(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),N(e),t.flowing&&!t.reading&&e.read(0)}function N(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function M(e){var t=e._readableState;o("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,Kn.nextTick(D,t,e))}function D(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function C(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}return S.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return o("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?M(this):R(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&M(this),null;var n,i=t.needReadable;return o("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&o("length less than watermark",i=!0),t.ended||t.reading?o("reading or ended",i=!1):i&&(o("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(r,t))),null===(n=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&M(this)),null!==n&&this.emit("data",n),n},S.prototype._read=function(e){y(this,new m("_read()"))},S.prototype.pipe=function(e,r){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,o("pipe count=%d opts=%j",i.pipesCount,r);var s=(!r||!1!==r.end)&&e!==Kn.stdout&&e!==Kn.stderr?c:g;function a(t,r){o("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,o("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",u),e.removeListener("error",d),e.removeListener("unpipe",a),n.removeListener("end",c),n.removeListener("end",g),n.removeListener("data",h),l=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function c(){o("onend"),e.end()}i.endEmitted?Kn.nextTick(s):n.once("end",s),e.on("unpipe",a);var u=function(e){return function(){var r=e._readableState;o("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,0===r.awaitDrain&&t(e,"data")&&(r.flowing=!0,N(e))}}(n);e.on("drain",u);var l=!1;function h(t){o("ondata");var r=e.write(t);o("dest.write",r),!1===r&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==C(i.pipes,e))&&!l&&(o("false write response, pause",i.awaitDrain),i.awaitDrain++),n.pause())}function d(r){o("onerror",r),g(),e.removeListener("error",d),0===t(e,"error")&&y(e,r)}function f(){e.removeListener("finish",p),g()}function p(){o("onfinish"),e.removeListener("close",f),g()}function g(){o("unpipe"),n.unpipe(e)}return n.on("data",h),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",f),e.once("finish",p),e.emit("pipe",n),i.flowing||(o("pipe resume"),n.resume()),e},S.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=C(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},S.prototype.on=function(e,t){var n=r.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,o("on readable",i.length,i.reading),i.length?R(this):i.reading||Kn.nextTick(x,this))),n},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(e,t){var n=r.prototype.removeListener.call(this,e,t);return"readable"===e&&Kn.nextTick(T,this),n},S.prototype.removeAllListeners=function(e){var t=r.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||Kn.nextTick(T,this),t},S.prototype.resume=function(){var e=this._readableState;return e.flowing||(o("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,Kn.nextTick(k,e,t))}(this,e)),e.paused=!1,this},S.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},S.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(o("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(o("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<b.length;s++)e.on(b[s],this.emit.bind(this,b[s]));return this._read=function(t){o("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(S.prototype[Symbol.asyncIterator]=function(){return void 0===c&&(c=Za()),c(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),S._fromList=B,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(S.from=function(e,t){return void 0===u&&(u=La?Fa:(La=1,Fa=function(){throw new Error("Readable.from is not available in the browser")})),u(S,e,t)}),qa}function Qa(){if(za)return Va;za=1,Va=a;var e=Ea().codes,t=e.ERR_METHOD_NOT_IMPLEMENTED,r=e.ERR_MULTIPLE_CALLBACK,n=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,i=e.ERR_TRANSFORM_WITH_LENGTH_0,o=ja();function s(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(null===i)return this.emit("error",new r);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);o.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",c)}function c(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?u(this,null,null):this._flush((function(t,r){u(e,t,r)}))}function u(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new i;if(e._transformState.transforming)throw new n;return e.push(null)}return bs(a,o),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,o.prototype.push.call(this,e,t)},a.prototype._transform=function(e,r,n){n(new t("_transform()"))},a.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},a.prototype._destroy=function(e,t){o.prototype._destroy.call(this,e,(function(e){t(e)}))},Va}var ec=rc,tc=vs.EventEmitter;function rc(){tc.call(this)}bs(rc,tc),rc.Readable=Xa(),rc.Writable=Ia(),rc.Duplex=ja(),rc.Transform=Qa(),rc.PassThrough=function(){if(Ya)return Ha;Ya=1,Ha=t;var e=Qa();function t(r){if(!(this instanceof t))return new t(r);e.call(this,r)}return bs(t,e),t.prototype._transform=function(e,t,r){r(null,e)},Ha}(),rc.finished=Ja(),rc.pipeline=function(){if(Wa)return Ga;var e;Wa=1;var t=Ea().codes,r=t.ERR_MISSING_ARGS,n=t.ERR_STREAM_DESTROYED;function i(e){if(e)throw e}function o(e){e()}function s(e,t){return e.pipe(t)}return Ga=function(){for(var t=arguments.length,a=new Array(t),c=0;c<t;c++)a[c]=arguments[c];var u,l=function(e){return e.length?"function"!=typeof e[e.length-1]?i:e.pop():i}(a);if(Array.isArray(a[0])&&(a=a[0]),a.length<2)throw new r("streams");var h=a.map((function(t,r){var i=r<a.length-1;return function(t,r,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var s=!1;t.on("close",(function(){s=!0})),void 0===e&&(e=Ja()),e(t,{readable:r,writable:i},(function(e){if(e)return o(e);s=!0,o()}));var a=!1;return function(e){if(!s&&!a)return a=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void o(e||new n("pipe"))}}(t,i,r>0,(function(e){u||(u=e),e&&h.forEach(o),i||(h.forEach(o),l(u))}))}));return a.reduce(s)},Ga}(),rc.Stream=rc,rc.prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",a));var o=!1;function s(){o||(o=!0,e.end())}function a(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===tc.listenerCount(this,"error"))throw e}function u(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",s),r.removeListener("close",a),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("error",c),e.on("error",c),r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e};var nc={},ic={},oc={},sc={},ac={},cc={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RequiredError=e.BaseAPI=e.COLLECTION_FORMATS=e.BASE_PATH=void 0;const t=qr;e.BASE_PATH="http://localhost/activity-api/v1".replace(/\/+$/,""),e.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"\t",pipes:"|"};e.BaseAPI=class{constructor(r,n=e.BASE_PATH,i=t.default){this.basePath=n,this.axios=i,r&&(this.configuration=r,this.basePath=r.basePath||this.basePath)}};class r extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}e.RequiredError=r}(cc);var uc=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(ac,"__esModule",{value:!0}),ac.createRequestFunction=ac.toPathString=ac.serializeDataIfNeeded=ac.setSearchParams=ac.setOAuthToObject=ac.setBearerAuthToObject=ac.setBasicAuthToObject=ac.setApiKeyToObject=ac.assertParamExists=ac.DUMMY_BASE_URL=void 0;const lc=cc;ac.DUMMY_BASE_URL="https://example.com",ac.assertParamExists=function(e,t,r){if(null==r)throw new lc.RequiredError(t,`Required parameter ${t} was null or undefined when calling ${e}.`)},ac.setApiKeyToObject=function(e,t,r){return uc(this,void 0,void 0,(function*(){if(r&&r.apiKey){const n="function"==typeof r.apiKey?yield r.apiKey(t):yield r.apiKey;e[t]=n}}))},ac.setBasicAuthToObject=function(e,t){t&&(t.username||t.password)&&(e.auth={username:t.username,password:t.password})},ac.setBearerAuthToObject=function(e,t){return uc(this,void 0,void 0,(function*(){if(t&&t.accessToken){const r="function"==typeof t.accessToken?yield t.accessToken():yield t.accessToken;e.Authorization="Bearer "+r}}))},ac.setOAuthToObject=function(e,t,r,n){return uc(this,void 0,void 0,(function*(){if(n&&n.accessToken){const i="function"==typeof n.accessToken?yield n.accessToken(t,r):yield n.accessToken;e.Authorization="Bearer "+i}}))},ac.setSearchParams=function(e,...t){const r=new URLSearchParams(e.search);for(const e of t)for(const t in e)if(Array.isArray(e[t])){r.delete(t);for(const n of e[t])r.append(t,n)}else r.set(t,e[t]);e.search=r.toString()},ac.serializeDataIfNeeded=function(e,t,r){const n="string"!=typeof e;return(n&&r&&r.isJsonMime?r.isJsonMime(t.headers["Content-Type"]):n)?JSON.stringify(void 0!==e?e:{}):e||""},ac.toPathString=function(e){return e.pathname+e.search+e.hash},ac.createRequestFunction=function(e,t,r,n){return(i=t,o=r)=>{const s=Object.assign(Object.assign({},e.options),{url:((null==n?void 0:n.basePath)||o)+e.url});return i.request(s)}},function(e){var t=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.RequestorControlApi=e.RequestorControlApiFactory=e.RequestorControlApiFp=e.RequestorControlApiAxiosParamCreator=void 0;const r=qr,n=ac,i=cc;e.RequestorControlApiAxiosParamCreator=function(e){return{callEncrypted:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("callEncrypted","activityId",r),n.assertParamExists("callEncrypted","body",i);const t="/activity/{activityId}/encrypted".replace("{activityId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={};yield n.setBearerAuthToObject(u,e),u["Content-Type"]="application/octet-stream",n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),c.data=n.serializeDataIfNeeded(i,c,e),{url:n.toPathString(s),options:c}})),createActivity:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("createActivity","stringCreateActivityRequest",r);const t=new URL("/activity",n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"POST"},s),o),c={},u={};yield n.setBearerAuthToObject(c,e),void 0!==i&&(u.timeout=i),c["Content-Type"]="application/json",n.setSearchParams(t,u);let l=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),l),o.headers),a.data=n.serializeDataIfNeeded(r,a,e),{url:n.toPathString(t),options:a}})),destroyActivity:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("destroyActivity","activityId",r);const t="/activity/{activityId}".replace("{activityId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"DELETE"},a),o),u={},l={};yield n.setBearerAuthToObject(u,e),void 0!==i&&(l.timeout=i),n.setSearchParams(s,l);let h=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),h),o.headers),{url:n.toPathString(s),options:c}})),exec:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("exec","activityId",r),n.assertParamExists("exec","script",i);const t="/activity/{activityId}/exec".replace("{activityId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={};yield n.setBearerAuthToObject(u,e),u["Content-Type"]="application/json",n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),c.data=n.serializeDataIfNeeded(i,c,e),{url:n.toPathString(s),options:c}})),getExecBatchResults:(r,i,o,s,a={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getExecBatchResults","activityId",r),n.assertParamExists("getExecBatchResults","batchId",i);const t="/activity/{activityId}/exec/{batchId}".replace("{activityId}",encodeURIComponent(String(r))).replace("{batchId}",encodeURIComponent(String(i))),c=new URL(t,n.DUMMY_BASE_URL);let u;e&&(u=e.baseOptions);const l=Object.assign(Object.assign({method:"GET"},u),a),h={},d={};yield n.setBearerAuthToObject(h,e),void 0!==o&&(d.commandIndex=o),void 0!==s&&(d.timeout=s),n.setSearchParams(c,d);let f=u&&u.headers?u.headers:{};return l.headers=Object.assign(Object.assign(Object.assign({},h),f),a.headers),{url:n.toPathString(c),options:l}}))}},e.RequestorControlApiFp=function(o){const s=e.RequestorControlApiAxiosParamCreator(o);return{callEncrypted(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.callEncrypted(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},createActivity(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.createActivity(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},destroyActivity(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.destroyActivity(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},exec(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.exec(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getExecBatchResults(e,a,c,u,l){return t(this,void 0,void 0,(function*(){const t=yield s.getExecBatchResults(e,a,c,u,l);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))}}},e.RequestorControlApiFactory=function(t,r,n){const i=e.RequestorControlApiFp(t);return{callEncrypted:(e,t,o)=>i.callEncrypted(e,t,o).then((e=>e(n,r))),createActivity:(e,t,o)=>i.createActivity(e,t,o).then((e=>e(n,r))),destroyActivity:(e,t,o)=>i.destroyActivity(e,t,o).then((e=>e(n,r))),exec:(e,t,o)=>i.exec(e,t,o).then((e=>e(n,r))),getExecBatchResults:(e,t,o,s,a)=>i.getExecBatchResults(e,t,o,s,a).then((e=>e(n,r)))}};e.RequestorControlApi=class extends i.BaseAPI{callEncrypted(t,r,n){return e.RequestorControlApiFp(this.configuration).callEncrypted(t,r,n).then((e=>e(this.axios,this.basePath)))}createActivity(t,r,n){return e.RequestorControlApiFp(this.configuration).createActivity(t,r,n).then((e=>e(this.axios,this.basePath)))}destroyActivity(t,r,n){return e.RequestorControlApiFp(this.configuration).destroyActivity(t,r,n).then((e=>e(this.axios,this.basePath)))}exec(t,r,n){return e.RequestorControlApiFp(this.configuration).exec(t,r,n).then((e=>e(this.axios,this.basePath)))}getExecBatchResults(t,r,n,i,o){return e.RequestorControlApiFp(this.configuration).getExecBatchResults(t,r,n,i,o).then((e=>e(this.axios,this.basePath)))}}}(sc);var hc,dc={};function fc(){return hc||(hc=1,function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(hu(),e),r(sc,e),r(dc,e)}(oc)),oc}!function(e){var t=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.RequestorStateApi=e.RequestorStateApiFactory=e.RequestorStateApiFp=e.RequestorStateApiAxiosParamCreator=void 0;const r=qr,n=ac,i=cc;e.RequestorStateApiAxiosParamCreator=function(e){return{getActivityState:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getActivityState","activityId",r);const t="/activity/{activityId}/state".replace("{activityId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getActivityUsage:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getActivityUsage","activityId",r);const t="/activity/{activityId}/usage".replace("{activityId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getRunningCommand:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getRunningCommand","activityId",r);const t="/activity/{activityId}/command".replace("{activityId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}}))}},e.RequestorStateApiFp=function(o){const s=e.RequestorStateApiAxiosParamCreator(o);return{getActivityState(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getActivityState(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getActivityUsage(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getActivityUsage(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getRunningCommand(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getRunningCommand(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))}}},e.RequestorStateApiFactory=function(t,r,n){const i=e.RequestorStateApiFp(t);return{getActivityState:(e,t)=>i.getActivityState(e,t).then((e=>e(n,r))),getActivityUsage:(e,t)=>i.getActivityUsage(e,t).then((e=>e(n,r))),getRunningCommand:(e,t)=>i.getRunningCommand(e,t).then((e=>e(n,r)))}};e.RequestorStateApi=class extends i.BaseAPI{getActivityState(t,r){return e.RequestorStateApiFp(this.configuration).getActivityState(t,r).then((e=>e(this.axios,this.basePath)))}getActivityUsage(t,r){return e.RequestorStateApiFp(this.configuration).getActivityUsage(t,r).then((e=>e(this.axios,this.basePath)))}getRunningCommand(t,r){return e.RequestorStateApiFp(this.configuration).getRunningCommand(t,r).then((e=>e(this.axios,this.basePath)))}}}(dc);var pc={};Object.defineProperty(pc,"__esModule",{value:!0}),pc.Configuration=void 0;pc.Configuration=class{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ \t]+/[^;/ \t]+[+]json)[ \t]*(;.*)?$","i");return null!==e&&(t.test(e)||"application/json-patch+json"===e.toLowerCase())}};var gc={},mc={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.ActivityStateStateEnum=void 0,(t=e.ActivityStateStateEnum||(e.ActivityStateStateEnum={})).New="New",t.Initialized="Initialized",t.Deployed="Deployed",t.Ready="Ready",t.Unresponsive="Unresponsive",t.Terminated="Terminated"}(mc);var vc={};Object.defineProperty(vc,"__esModule",{value:!0});var yc={};Object.defineProperty(yc,"__esModule",{value:!0});var bc={};Object.defineProperty(bc,"__esModule",{value:!0});var wc={};Object.defineProperty(wc,"__esModule",{value:!0});var Sc={};Object.defineProperty(Sc,"__esModule",{value:!0});var Pc={};Object.defineProperty(Pc,"__esModule",{value:!0});var Ac={};Object.defineProperty(Ac,"__esModule",{value:!0});var Oc={};Object.defineProperty(Oc,"__esModule",{value:!0});var Ec={};Object.defineProperty(Ec,"__esModule",{value:!0});var Rc={};Object.defineProperty(Rc,"__esModule",{value:!0});var _c={};Object.defineProperty(_c,"__esModule",{value:!0});var Ic={};Object.defineProperty(Ic,"__esModule",{value:!0});var jc={};Object.defineProperty(jc,"__esModule",{value:!0});var Tc={};Object.defineProperty(Tc,"__esModule",{value:!0});var xc={};Object.defineProperty(xc,"__esModule",{value:!0});var kc={};Object.defineProperty(kc,"__esModule",{value:!0});var Nc={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.ExeScriptCommandResultResultEnum=void 0,(t=e.ExeScriptCommandResultResultEnum||(e.ExeScriptCommandResultResultEnum={})).Ok="Ok",t.Error="Error"}(Nc);var Bc={};Object.defineProperty(Bc,"__esModule",{value:!0});var Mc={};Object.defineProperty(Mc,"__esModule",{value:!0});var Dc={};Object.defineProperty(Dc,"__esModule",{value:!0});var Cc={};Object.defineProperty(Cc,"__esModule",{value:!0});var Uc={};Object.defineProperty(Uc,"__esModule",{value:!0});var Fc={};Object.defineProperty(Fc,"__esModule",{value:!0});var Lc={};Object.defineProperty(Lc,"__esModule",{value:!0});var qc={};Object.defineProperty(qc,"__esModule",{value:!0});var $c={};Object.defineProperty($c,"__esModule",{value:!0});var Vc={};Object.defineProperty(Vc,"__esModule",{value:!0});var zc={};Object.defineProperty(zc,"__esModule",{value:!0});var Hc={};Object.defineProperty(Hc,"__esModule",{value:!0});var Yc={};Object.defineProperty(Yc,"__esModule",{value:!0});var Gc={};Object.defineProperty(Gc,"__esModule",{value:!0});var Wc={};Object.defineProperty(Wc,"__esModule",{value:!0});var Kc={};Object.defineProperty(Kc,"__esModule",{value:!0});var Jc={};Object.defineProperty(Jc,"__esModule",{value:!0});var Zc={};Object.defineProperty(Zc,"__esModule",{value:!0});var Xc={};Object.defineProperty(Xc,"__esModule",{value:!0});var Qc={};Object.defineProperty(Qc,"__esModule",{value:!0});var eu={};Object.defineProperty(eu,"__esModule",{value:!0});var tu={};Object.defineProperty(tu,"__esModule",{value:!0});var ru={};Object.defineProperty(ru,"__esModule",{value:!0});var nu={};Object.defineProperty(nu,"__esModule",{value:!0});var iu={};Object.defineProperty(iu,"__esModule",{value:!0});var ou={};Object.defineProperty(ou,"__esModule",{value:!0});var su={};Object.defineProperty(su,"__esModule",{value:!0});var au={};Object.defineProperty(au,"__esModule",{value:!0});var cu={};Object.defineProperty(cu,"__esModule",{value:!0});var uu,lu={};function hu(){return uu||(uu=1,function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(fc(),e),r(pc,e),r(gc,e)}(ic)),ic}Object.defineProperty(lu,"__esModule",{value:!0}),function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(mc,e),r(vc,e),r(yc,e),r(bc,e),r(wc,e),r(Sc,e),r(Pc,e),r(Ac,e),r(Oc,e),r(Ec,e),r(Rc,e),r(_c,e),r(Ic,e),r(jc,e),r(Tc,e),r(xc,e),r(kc,e),r(Nc,e),r(Bc,e),r(Mc,e),r(Dc,e),r(Cc,e),r(Uc,e),r(Fc,e),r(Lc,e),r(qc,e),r($c,e),r(Vc,e),r(zc,e),r(Hc,e),r(Yc,e),r(Gc,e),r(Wc,e),r(Kc,e),r(Jc,e),r(Zc,e),r(Xc,e),r(Qc,e),r(eu,e),r(tu,e),r(ru,e),r(nu,e),r(iu,e),r(ou,e),r(su,e),r(au,e),r(cu,e),r(lu,e)}(gc);var du={},fu={},pu={},gu={},mu={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RequiredError=e.BaseAPI=e.COLLECTION_FORMATS=e.BASE_PATH=void 0;const t=qr;e.BASE_PATH="http://localhost/payment-api/v1".replace(/\/+$/,""),e.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"\t",pipes:"|"};e.BaseAPI=class{constructor(r,n=e.BASE_PATH,i=t.default){this.basePath=n,this.axios=i,r&&(this.configuration=r,this.basePath=r.basePath||this.basePath)}};class r extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}e.RequiredError=r}(mu);var vu=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(gu,"__esModule",{value:!0}),gu.createRequestFunction=gu.toPathString=gu.serializeDataIfNeeded=gu.setSearchParams=gu.setOAuthToObject=gu.setBearerAuthToObject=gu.setBasicAuthToObject=gu.setApiKeyToObject=gu.assertParamExists=gu.DUMMY_BASE_URL=void 0;const yu=mu;var bu;function wu(){return bu||(bu=1,function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(il(),e),r(pu,e)}(fu)),fu}gu.DUMMY_BASE_URL="https://example.com",gu.assertParamExists=function(e,t,r){if(null==r)throw new yu.RequiredError(t,`Required parameter ${t} was null or undefined when calling ${e}.`)},gu.setApiKeyToObject=function(e,t,r){return vu(this,void 0,void 0,(function*(){if(r&&r.apiKey){const n="function"==typeof r.apiKey?yield r.apiKey(t):yield r.apiKey;e[t]=n}}))},gu.setBasicAuthToObject=function(e,t){t&&(t.username||t.password)&&(e.auth={username:t.username,password:t.password})},gu.setBearerAuthToObject=function(e,t){return vu(this,void 0,void 0,(function*(){if(t&&t.accessToken){const r="function"==typeof t.accessToken?yield t.accessToken():yield t.accessToken;e.Authorization="Bearer "+r}}))},gu.setOAuthToObject=function(e,t,r,n){return vu(this,void 0,void 0,(function*(){if(n&&n.accessToken){const i="function"==typeof n.accessToken?yield n.accessToken(t,r):yield n.accessToken;e.Authorization="Bearer "+i}}))},gu.setSearchParams=function(e,...t){const r=new URLSearchParams(e.search);for(const e of t)for(const t in e)if(Array.isArray(e[t])){r.delete(t);for(const n of e[t])r.append(t,n)}else r.set(t,e[t]);e.search=r.toString()},gu.serializeDataIfNeeded=function(e,t,r){const n="string"!=typeof e;return(n&&r&&r.isJsonMime?r.isJsonMime(t.headers["Content-Type"]):n)?JSON.stringify(void 0!==e?e:{}):e||""},gu.toPathString=function(e){return e.pathname+e.search+e.hash},gu.createRequestFunction=function(e,t,r,n){return(i=t,o=r)=>{const s=Object.assign(Object.assign({},e.options),{url:((null==n?void 0:n.basePath)||o)+e.url});return i.request(s)}},function(e){var t=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.RequestorApi=e.RequestorApiFactory=e.RequestorApiFp=e.RequestorApiAxiosParamCreator=void 0;const r=qr,n=gu,i=mu;e.RequestorApiAxiosParamCreator=function(e){return{acceptDebitNote:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("acceptDebitNote","debitNoteId",r),n.assertParamExists("acceptDebitNote","acceptance",i);const t="/debitNotes/{debitNoteId}/accept".replace("{debitNoteId}",encodeURIComponent(String(r))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),s),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==o&&(h.timeout=o),l["Content-Type"]="application/json",n.setSearchParams(a,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),s.headers),u.data=n.serializeDataIfNeeded(i,u,e),{url:n.toPathString(a),options:u}})),acceptInvoice:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("acceptInvoice","invoiceId",r),n.assertParamExists("acceptInvoice","acceptance",i);const t="/invoices/{invoiceId}/accept".replace("{invoiceId}",encodeURIComponent(String(r))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),s),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==o&&(h.timeout=o),l["Content-Type"]="application/json",n.setSearchParams(a,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),s.headers),u.data=n.serializeDataIfNeeded(i,u,e),{url:n.toPathString(a),options:u}})),amendAllocation:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("amendAllocation","allocationId",r),n.assertParamExists("amendAllocation","allocation",i);const t="/allocations/{allocationId}".replace("{allocationId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"PUT"},a),o),u={};yield n.setBearerAuthToObject(u,e),u["Content-Type"]="application/json",n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),c.data=n.serializeDataIfNeeded(i,c,e),{url:n.toPathString(s),options:c}})),createAllocation:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("createAllocation","allocation",r);const t=new URL("/allocations",n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),s),u={},l={};yield n.setBearerAuthToObject(u,e),void 0!==i&&(l.afterTimestamp=i instanceof Date?i.toISOString():i),void 0!==o&&(l.maxItems=o),u["Content-Type"]="application/json",n.setSearchParams(t,l);let h=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),h),s.headers),c.data=n.serializeDataIfNeeded(r,c,e),{url:n.toPathString(t),options:c}})),getAllocation:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getAllocation","allocationId",r);const t="/allocations/{allocationId}".replace("{allocationId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getAllocations:(r={})=>t(this,void 0,void 0,(function*(){const t=new URL("/allocations",n.DUMMY_BASE_URL);let i;e&&(i=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},i),r),s={};yield n.setBearerAuthToObject(s,e),n.setSearchParams(t,{});let a=i&&i.headers?i.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},s),a),r.headers),{url:n.toPathString(t),options:o}})),getDebitNote:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getDebitNote","debitNoteId",r);const t="/debitNotes/{debitNoteId}".replace("{debitNoteId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getDebitNoteEvents:(r,i,o,s,a={})=>t(this,void 0,void 0,(function*(){const t=new URL("/debitNoteEvents",n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"GET"},c),a),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==r&&(h.timeout=r),void 0!==i&&(h.afterTimestamp=i instanceof Date?i.toISOString():i),void 0!==o&&(h.maxEvents=o),void 0!==s&&(h.appSessionId=s),n.setSearchParams(t,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),a.headers),{url:n.toPathString(t),options:u}})),getDebitNotes:(r,i,o={})=>t(this,void 0,void 0,(function*(){const t=new URL("/debitNotes",n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),o),c={},u={};yield n.setBearerAuthToObject(c,e),void 0!==r&&(u.afterTimestamp=r instanceof Date?r.toISOString():r),void 0!==i&&(u.maxItems=i),n.setSearchParams(t,u);let l=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),l),o.headers),{url:n.toPathString(t),options:a}})),getDemandDecorations:(r,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getDemandDecorations","allocationIds",r);const t=new URL("/demandDecorations",n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),o),c={},u={};yield n.setBearerAuthToObject(c,e),r&&(u.allocationIds=r.join(i.COLLECTION_FORMATS.csv)),n.setSearchParams(t,u);let l=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),l),o.headers),{url:n.toPathString(t),options:a}})),getInvoice:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getInvoice","invoiceId",r);const t="/invoices/{invoiceId}".replace("{invoiceId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getInvoiceEvents:(r,i,o,s,a={})=>t(this,void 0,void 0,(function*(){const t=new URL("/invoiceEvents",n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"GET"},c),a),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==r&&(h.timeout=r),void 0!==i&&(h.afterTimestamp=i instanceof Date?i.toISOString():i),void 0!==o&&(h.maxEvents=o),void 0!==s&&(h.appSessionId=s),n.setSearchParams(t,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),a.headers),{url:n.toPathString(t),options:u}})),getInvoices:(r,i,o={})=>t(this,void 0,void 0,(function*(){const t=new URL("/invoices",n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),o),c={},u={};yield n.setBearerAuthToObject(c,e),void 0!==r&&(u.afterTimestamp=r instanceof Date?r.toISOString():r),void 0!==i&&(u.maxItems=i),n.setSearchParams(t,u);let l=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),l),o.headers),{url:n.toPathString(t),options:a}})),getPayment:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getPayment","paymentId",r);const t="/payments/{paymentId}".replace("{paymentId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getPayments:(r,i,o,s,a={})=>t(this,void 0,void 0,(function*(){const t=new URL("/payments",n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"GET"},c),a),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==r&&(h.timeout=r),void 0!==i&&(h.afterTimestamp=i instanceof Date?i.toISOString():i),void 0!==o&&(h.maxEvents=o),void 0!==s&&(h.appSessionId=s),n.setSearchParams(t,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),a.headers),{url:n.toPathString(t),options:u}})),getPaymentsForDebitNote:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getPaymentsForDebitNote","debitNoteId",r);const t="/debitNotes/{debitNoteId}/payments".replace("{debitNoteId}",encodeURIComponent(String(r))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"GET"},c),s),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==i&&(h.afterTimestamp=i instanceof Date?i.toISOString():i),void 0!==o&&(h.maxItems=o),n.setSearchParams(a,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),s.headers),{url:n.toPathString(a),options:u}})),getPaymentsForInvoice:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getPaymentsForInvoice","invoiceId",r);const t="/invoices/{invoiceId}/payments".replace("{invoiceId}",encodeURIComponent(String(r))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"GET"},c),s),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==i&&(h.afterTimestamp=i instanceof Date?i.toISOString():i),void 0!==o&&(h.maxItems=o),n.setSearchParams(a,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),s.headers),{url:n.toPathString(a),options:u}})),getRequestorAccounts:(r={})=>t(this,void 0,void 0,(function*(){const t=new URL("/requestorAccounts",n.DUMMY_BASE_URL);let i;e&&(i=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},i),r),s={};yield n.setBearerAuthToObject(s,e),n.setSearchParams(t,{});let a=i&&i.headers?i.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},s),a),r.headers),{url:n.toPathString(t),options:o}})),issueInvoice:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("issueInvoice","invoice",r);const t=new URL("/invoices",n.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},o),i),a={};yield n.setBearerAuthToObject(a,e),a["Content-Type"]="application/json",n.setSearchParams(t,{});let c=o&&o.headers?o.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},a),c),i.headers),s.data=n.serializeDataIfNeeded(r,s,e),{url:n.toPathString(t),options:s}})),rejectDebitNote:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("rejectDebitNote","debitNoteId",r),n.assertParamExists("rejectDebitNote","rejection",i);const t="/debitNotes/{debitNoteId}/reject".replace("{debitNoteId}",encodeURIComponent(String(r))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),s),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==o&&(h.timeout=o),l["Content-Type"]="application/json",n.setSearchParams(a,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),s.headers),u.data=n.serializeDataIfNeeded(i,u,e),{url:n.toPathString(a),options:u}})),rejectInvoice:(r,i,o,s={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("rejectInvoice","invoiceId",r),n.assertParamExists("rejectInvoice","rejection",i);const t="/invoices/{invoiceId}/reject".replace("{invoiceId}",encodeURIComponent(String(r))),a=new URL(t,n.DUMMY_BASE_URL);let c;e&&(c=e.baseOptions);const u=Object.assign(Object.assign({method:"POST"},c),s),l={},h={};yield n.setBearerAuthToObject(l,e),void 0!==o&&(h.timeout=o),l["Content-Type"]="application/json",n.setSearchParams(a,h);let d=c&&c.headers?c.headers:{};return u.headers=Object.assign(Object.assign(Object.assign({},l),d),s.headers),u.data=n.serializeDataIfNeeded(i,u,e),{url:n.toPathString(a),options:u}})),releaseAllocation:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("releaseAllocation","allocationId",r);const t="/allocations/{allocationId}".replace("{allocationId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"DELETE"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}}))}},e.RequestorApiFp=function(o){const s=e.RequestorApiAxiosParamCreator(o);return{acceptDebitNote(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.acceptDebitNote(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},acceptInvoice(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.acceptInvoice(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},amendAllocation(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.amendAllocation(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},createAllocation(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.createAllocation(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getAllocation(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getAllocation(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getAllocations(e){return t(this,void 0,void 0,(function*(){const t=yield s.getAllocations(e);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getDebitNote(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getDebitNote(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getDebitNoteEvents(e,a,c,u,l){return t(this,void 0,void 0,(function*(){const t=yield s.getDebitNoteEvents(e,a,c,u,l);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getDebitNotes(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.getDebitNotes(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getDemandDecorations(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getDemandDecorations(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getInvoice(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getInvoice(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getInvoiceEvents(e,a,c,u,l){return t(this,void 0,void 0,(function*(){const t=yield s.getInvoiceEvents(e,a,c,u,l);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getInvoices(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.getInvoices(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getPayment(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getPayment(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getPayments(e,a,c,u,l){return t(this,void 0,void 0,(function*(){const t=yield s.getPayments(e,a,c,u,l);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getPaymentsForDebitNote(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.getPaymentsForDebitNote(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getPaymentsForInvoice(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.getPaymentsForInvoice(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getRequestorAccounts(e){return t(this,void 0,void 0,(function*(){const t=yield s.getRequestorAccounts(e);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},issueInvoice(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.issueInvoice(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},rejectDebitNote(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.rejectDebitNote(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},rejectInvoice(e,a,c,u){return t(this,void 0,void 0,(function*(){const t=yield s.rejectInvoice(e,a,c,u);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},releaseAllocation(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.releaseAllocation(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))}}},e.RequestorApiFactory=function(t,r,n){const i=e.RequestorApiFp(t);return{acceptDebitNote:(e,t,o,s)=>i.acceptDebitNote(e,t,o,s).then((e=>e(n,r))),acceptInvoice:(e,t,o,s)=>i.acceptInvoice(e,t,o,s).then((e=>e(n,r))),amendAllocation:(e,t,o)=>i.amendAllocation(e,t,o).then((e=>e(n,r))),createAllocation:(e,t,o,s)=>i.createAllocation(e,t,o,s).then((e=>e(n,r))),getAllocation:(e,t)=>i.getAllocation(e,t).then((e=>e(n,r))),getAllocations:e=>i.getAllocations(e).then((e=>e(n,r))),getDebitNote:(e,t)=>i.getDebitNote(e,t).then((e=>e(n,r))),getDebitNoteEvents:(e,t,o,s,a)=>i.getDebitNoteEvents(e,t,o,s,a).then((e=>e(n,r))),getDebitNotes:(e,t,o)=>i.getDebitNotes(e,t,o).then((e=>e(n,r))),getDemandDecorations:(e,t)=>i.getDemandDecorations(e,t).then((e=>e(n,r))),getInvoice:(e,t)=>i.getInvoice(e,t).then((e=>e(n,r))),getInvoiceEvents:(e,t,o,s,a)=>i.getInvoiceEvents(e,t,o,s,a).then((e=>e(n,r))),getInvoices:(e,t,o)=>i.getInvoices(e,t,o).then((e=>e(n,r))),getPayment:(e,t)=>i.getPayment(e,t).then((e=>e(n,r))),getPayments:(e,t,o,s,a)=>i.getPayments(e,t,o,s,a).then((e=>e(n,r))),getPaymentsForDebitNote:(e,t,o,s)=>i.getPaymentsForDebitNote(e,t,o,s).then((e=>e(n,r))),getPaymentsForInvoice:(e,t,o,s)=>i.getPaymentsForInvoice(e,t,o,s).then((e=>e(n,r))),getRequestorAccounts:e=>i.getRequestorAccounts(e).then((e=>e(n,r))),issueInvoice:(e,t)=>i.issueInvoice(e,t).then((e=>e(n,r))),rejectDebitNote:(e,t,o,s)=>i.rejectDebitNote(e,t,o,s).then((e=>e(n,r))),rejectInvoice:(e,t,o,s)=>i.rejectInvoice(e,t,o,s).then((e=>e(n,r))),releaseAllocation:(e,t)=>i.releaseAllocation(e,t).then((e=>e(n,r)))}};e.RequestorApi=class extends i.BaseAPI{acceptDebitNote(t,r,n,i){return e.RequestorApiFp(this.configuration).acceptDebitNote(t,r,n,i).then((e=>e(this.axios,this.basePath)))}acceptInvoice(t,r,n,i){return e.RequestorApiFp(this.configuration).acceptInvoice(t,r,n,i).then((e=>e(this.axios,this.basePath)))}amendAllocation(t,r,n){return e.RequestorApiFp(this.configuration).amendAllocation(t,r,n).then((e=>e(this.axios,this.basePath)))}createAllocation(t,r,n,i){return e.RequestorApiFp(this.configuration).createAllocation(t,r,n,i).then((e=>e(this.axios,this.basePath)))}getAllocation(t,r){return e.RequestorApiFp(this.configuration).getAllocation(t,r).then((e=>e(this.axios,this.basePath)))}getAllocations(t){return e.RequestorApiFp(this.configuration).getAllocations(t).then((e=>e(this.axios,this.basePath)))}getDebitNote(t,r){return e.RequestorApiFp(this.configuration).getDebitNote(t,r).then((e=>e(this.axios,this.basePath)))}getDebitNoteEvents(t,r,n,i,o){return e.RequestorApiFp(this.configuration).getDebitNoteEvents(t,r,n,i,o).then((e=>e(this.axios,this.basePath)))}getDebitNotes(t,r,n){return e.RequestorApiFp(this.configuration).getDebitNotes(t,r,n).then((e=>e(this.axios,this.basePath)))}getDemandDecorations(t,r){return e.RequestorApiFp(this.configuration).getDemandDecorations(t,r).then((e=>e(this.axios,this.basePath)))}getInvoice(t,r){return e.RequestorApiFp(this.configuration).getInvoice(t,r).then((e=>e(this.axios,this.basePath)))}getInvoiceEvents(t,r,n,i,o){return e.RequestorApiFp(this.configuration).getInvoiceEvents(t,r,n,i,o).then((e=>e(this.axios,this.basePath)))}getInvoices(t,r,n){return e.RequestorApiFp(this.configuration).getInvoices(t,r,n).then((e=>e(this.axios,this.basePath)))}getPayment(t,r){return e.RequestorApiFp(this.configuration).getPayment(t,r).then((e=>e(this.axios,this.basePath)))}getPayments(t,r,n,i,o){return e.RequestorApiFp(this.configuration).getPayments(t,r,n,i,o).then((e=>e(this.axios,this.basePath)))}getPaymentsForDebitNote(t,r,n,i){return e.RequestorApiFp(this.configuration).getPaymentsForDebitNote(t,r,n,i).then((e=>e(this.axios,this.basePath)))}getPaymentsForInvoice(t,r,n,i){return e.RequestorApiFp(this.configuration).getPaymentsForInvoice(t,r,n,i).then((e=>e(this.axios,this.basePath)))}getRequestorAccounts(t){return e.RequestorApiFp(this.configuration).getRequestorAccounts(t).then((e=>e(this.axios,this.basePath)))}issueInvoice(t,r){return e.RequestorApiFp(this.configuration).issueInvoice(t,r).then((e=>e(this.axios,this.basePath)))}rejectDebitNote(t,r,n,i){return e.RequestorApiFp(this.configuration).rejectDebitNote(t,r,n,i).then((e=>e(this.axios,this.basePath)))}rejectInvoice(t,r,n,i){return e.RequestorApiFp(this.configuration).rejectInvoice(t,r,n,i).then((e=>e(this.axios,this.basePath)))}releaseAllocation(t,r){return e.RequestorApiFp(this.configuration).releaseAllocation(t,r).then((e=>e(this.axios,this.basePath)))}}}(pu);var Su={};Object.defineProperty(Su,"__esModule",{value:!0}),Su.Configuration=void 0;Su.Configuration=class{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ \t]+/[^;/ \t]+[+]json)[ \t]*(;.*)?$","i");return null!==e&&(t.test(e)||"application/json-patch+json"===e.toLowerCase())}};var Pu={},Au={};Object.defineProperty(Au,"__esModule",{value:!0});var Ou={};Object.defineProperty(Ou,"__esModule",{value:!0});var Eu={};Object.defineProperty(Eu,"__esModule",{value:!0});var Ru={};Object.defineProperty(Ru,"__esModule",{value:!0});var _u={};Object.defineProperty(_u,"__esModule",{value:!0});var Iu={};Object.defineProperty(Iu,"__esModule",{value:!0});var ju={};Object.defineProperty(ju,"__esModule",{value:!0});var Tu={};Object.defineProperty(Tu,"__esModule",{value:!0});var xu={};Object.defineProperty(xu,"__esModule",{value:!0});var ku={};Object.defineProperty(ku,"__esModule",{value:!0});var Nu={};Object.defineProperty(Nu,"__esModule",{value:!0});var Bu={};Object.defineProperty(Bu,"__esModule",{value:!0});var Mu={};Object.defineProperty(Mu,"__esModule",{value:!0});var Du={};Object.defineProperty(Du,"__esModule",{value:!0});var Cu={};Object.defineProperty(Cu,"__esModule",{value:!0});var Uu={};Object.defineProperty(Uu,"__esModule",{value:!0});var Fu={};Object.defineProperty(Fu,"__esModule",{value:!0});var Lu={};Object.defineProperty(Lu,"__esModule",{value:!0});var qu={};Object.defineProperty(qu,"__esModule",{value:!0});var $u={};Object.defineProperty($u,"__esModule",{value:!0});var Vu={};Object.defineProperty(Vu,"__esModule",{value:!0});var zu={};Object.defineProperty(zu,"__esModule",{value:!0});var Hu={};Object.defineProperty(Hu,"__esModule",{value:!0});var Yu={};Object.defineProperty(Yu,"__esModule",{value:!0});var Gu={};Object.defineProperty(Gu,"__esModule",{value:!0});var Wu={};Object.defineProperty(Wu,"__esModule",{value:!0});var Ku={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.InvoiceStatus=void 0,(t=e.InvoiceStatus||(e.InvoiceStatus={})).Issued="ISSUED",t.Received="RECEIVED",t.Accepted="ACCEPTED",t.Rejected="REJECTED",t.Failed="FAILED",t.Settled="SETTLED",t.Cancelled="CANCELLED"}(Ku);var Ju={};Object.defineProperty(Ju,"__esModule",{value:!0});var Zu={};Object.defineProperty(Zu,"__esModule",{value:!0});var Xu={};Object.defineProperty(Xu,"__esModule",{value:!0});var Qu={};Object.defineProperty(Qu,"__esModule",{value:!0});var el={};Object.defineProperty(el,"__esModule",{value:!0});var tl={};Object.defineProperty(tl,"__esModule",{value:!0});var rl,nl={};function il(){return rl||(rl=1,function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(wu(),e),r(Su,e),r(Pu,e)}(du)),du}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RejectionReason=void 0,function(e){e.UnsolicitedService="UNSOLICITED_SERVICE",e.BadService="BAD_SERVICE",e.IncorrectAmount="INCORRECT_AMOUNT"}(e.RejectionReason||(e.RejectionReason={}))}(nl),function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(Au,e),r(Ou,e),r(Eu,e),r(Ru,e),r(_u,e),r(Iu,e),r(ju,e),r(Tu,e),r(xu,e),r(ku,e),r(Nu,e),r(Bu,e),r(Mu,e),r(Du,e),r(Cu,e),r(Uu,e),r(Fu,e),r(Lu,e),r(qu,e),r($u,e),r(Vu,e),r(zu,e),r(Hu,e),r(Yu,e),r(Gu,e),r(Wu,e),r(Ku,e),r(Ju,e),r(Zu,e),r(Xu,e),r(Qu,e),r(el,e),r(tl,e),r(nl,e)}(Pu);var ol={},sl={},al={},cl={},ul={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RequiredError=e.BaseAPI=e.COLLECTION_FORMATS=e.BASE_PATH=void 0;const t=qr;e.BASE_PATH="http://localhost/net-api/v1".replace(/\/+$/,""),e.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"\t",pipes:"|"};e.BaseAPI=class{constructor(r,n=e.BASE_PATH,i=t.default){this.basePath=n,this.axios=i,r&&(this.configuration=r,this.basePath=r.basePath||this.basePath)}};class r extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}e.RequiredError=r}(ul);var ll=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(cl,"__esModule",{value:!0}),cl.createRequestFunction=cl.toPathString=cl.serializeDataIfNeeded=cl.setSearchParams=cl.setOAuthToObject=cl.setBearerAuthToObject=cl.setBasicAuthToObject=cl.setApiKeyToObject=cl.assertParamExists=cl.DUMMY_BASE_URL=void 0;const hl=ul;cl.DUMMY_BASE_URL="https://example.com",cl.assertParamExists=function(e,t,r){if(null==r)throw new hl.RequiredError(t,`Required parameter ${t} was null or undefined when calling ${e}.`)},cl.setApiKeyToObject=function(e,t,r){return ll(this,void 0,void 0,(function*(){if(r&&r.apiKey){const n="function"==typeof r.apiKey?yield r.apiKey(t):yield r.apiKey;e[t]=n}}))},cl.setBasicAuthToObject=function(e,t){t&&(t.username||t.password)&&(e.auth={username:t.username,password:t.password})},cl.setBearerAuthToObject=function(e,t){return ll(this,void 0,void 0,(function*(){if(t&&t.accessToken){const r="function"==typeof t.accessToken?yield t.accessToken():yield t.accessToken;e.Authorization="Bearer "+r}}))},cl.setOAuthToObject=function(e,t,r,n){return ll(this,void 0,void 0,(function*(){if(n&&n.accessToken){const i="function"==typeof n.accessToken?yield n.accessToken(t,r):yield n.accessToken;e.Authorization="Bearer "+i}}))},cl.setSearchParams=function(e,...t){const r=new URLSearchParams(e.search);for(const e of t)for(const t in e)if(Array.isArray(e[t])){r.delete(t);for(const n of e[t])r.append(t,n)}else r.set(t,e[t]);e.search=r.toString()},cl.serializeDataIfNeeded=function(e,t,r){const n="string"!=typeof e;return(n&&r&&r.isJsonMime?r.isJsonMime(t.headers["Content-Type"]):n)?JSON.stringify(void 0!==e?e:{}):e||""},cl.toPathString=function(e){return e.pathname+e.search+e.hash},cl.createRequestFunction=function(e,t,r,n){return(i=t,o=r)=>{const s=Object.assign(Object.assign({},e.options),{url:((null==n?void 0:n.basePath)||o)+e.url});return i.request(s)}},function(e){var t=nr&&nr.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.RequestorApi=e.RequestorApiFactory=e.RequestorApiFp=e.RequestorApiAxiosParamCreator=void 0;const r=qr,n=cl,i=ul;e.RequestorApiAxiosParamCreator=function(e){return{addAddress:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("addAddress","networkId",r),n.assertParamExists("addAddress","address",i);const t="/net/{networkId}/addresses".replace("{networkId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={};yield n.setBearerAuthToObject(u,e),u["Content-Type"]="application/json",n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),c.data=n.serializeDataIfNeeded(i,c,e),{url:n.toPathString(s),options:c}})),addNode:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("addNode","networkId",r),n.assertParamExists("addNode","node",i);const t="/net/{networkId}/nodes".replace("{networkId}",encodeURIComponent(String(r))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"POST"},a),o),u={};yield n.setBearerAuthToObject(u,e),u["Content-Type"]="application/json",n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),c.data=n.serializeDataIfNeeded(i,c,e),{url:n.toPathString(s),options:c}})),createNetwork:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("createNetwork","network",r);const t=new URL("/net",n.DUMMY_BASE_URL);let o;e&&(o=e.baseOptions);const s=Object.assign(Object.assign({method:"POST"},o),i),a={};yield n.setBearerAuthToObject(a,e),a["Content-Type"]="application/json",n.setSearchParams(t,{});let c=o&&o.headers?o.headers:{};return s.headers=Object.assign(Object.assign(Object.assign({},a),c),i.headers),s.data=n.serializeDataIfNeeded(r,s,e),{url:n.toPathString(t),options:s}})),getAddresses:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getAddresses","networkId",r);const t="/net/{networkId}/addresses".replace("{networkId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getConnections:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getConnections","networkId",r);const t="/net/{networkId}/tcp".replace("{networkId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getNetwork:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getNetwork","networkId",r);const t="/net/{networkId}".replace("{networkId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),getNetworks:(r={})=>t(this,void 0,void 0,(function*(){const t=new URL("/net",n.DUMMY_BASE_URL);let i;e&&(i=e.baseOptions);const o=Object.assign(Object.assign({method:"GET"},i),r),s={};yield n.setBearerAuthToObject(s,e),n.setSearchParams(t,{});let a=i&&i.headers?i.headers:{};return o.headers=Object.assign(Object.assign(Object.assign({},s),a),r.headers),{url:n.toPathString(t),options:o}})),getNodes:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("getNodes","networkId",r);const t="/net/{networkId}/nodes".replace("{networkId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"GET"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),removeNetwork:(r,i={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("removeNetwork","networkId",r);const t="/net/{networkId}".replace("{networkId}",encodeURIComponent(String(r))),o=new URL(t,n.DUMMY_BASE_URL);let s;e&&(s=e.baseOptions);const a=Object.assign(Object.assign({method:"DELETE"},s),i),c={};yield n.setBearerAuthToObject(c,e),n.setSearchParams(o,{});let u=s&&s.headers?s.headers:{};return a.headers=Object.assign(Object.assign(Object.assign({},c),u),i.headers),{url:n.toPathString(o),options:a}})),removeNode:(r,i,o={})=>t(this,void 0,void 0,(function*(){n.assertParamExists("removeNode","networkId",r),n.assertParamExists("removeNode","nodeId",i);const t="/net/{networkId}/nodes/{nodeId}".replace("{networkId}",encodeURIComponent(String(r))).replace("{nodeId}",encodeURIComponent(String(i))),s=new URL(t,n.DUMMY_BASE_URL);let a;e&&(a=e.baseOptions);const c=Object.assign(Object.assign({method:"DELETE"},a),o),u={};yield n.setBearerAuthToObject(u,e),n.setSearchParams(s,{});let l=a&&a.headers?a.headers:{};return c.headers=Object.assign(Object.assign(Object.assign({},u),l),o.headers),{url:n.toPathString(s),options:c}}))}},e.RequestorApiFp=function(o){const s=e.RequestorApiAxiosParamCreator(o);return{addAddress(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.addAddress(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},addNode(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.addNode(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},createNetwork(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.createNetwork(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getAddresses(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getAddresses(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getConnections(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getConnections(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getNetwork(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getNetwork(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getNetworks(e){return t(this,void 0,void 0,(function*(){const t=yield s.getNetworks(e);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},getNodes(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.getNodes(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},removeNetwork(e,a){return t(this,void 0,void 0,(function*(){const t=yield s.removeNetwork(e,a);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))},removeNode(e,a,c){return t(this,void 0,void 0,(function*(){const t=yield s.removeNode(e,a,c);return n.createRequestFunction(t,r.default,i.BASE_PATH,o)}))}}},e.RequestorApiFactory=function(t,r,n){const i=e.RequestorApiFp(t);return{addAddress:(e,t,o)=>i.addAddress(e,t,o).then((e=>e(n,r))),addNode:(e,t,o)=>i.addNode(e,t,o).then((e=>e(n,r))),createNetwork:(e,t)=>i.createNetwork(e,t).then((e=>e(n,r))),getAddresses:(e,t)=>i.getAddresses(e,t).then((e=>e(n,r))),getConnections:(e,t)=>i.getConnections(e,t).then((e=>e(n,r))),getNetwork:(e,t)=>i.getNetwork(e,t).then((e=>e(n,r))),getNetworks:e=>i.getNetworks(e).then((e=>e(n,r))),getNodes:(e,t)=>i.getNodes(e,t).then((e=>e(n,r))),removeNetwork:(e,t)=>i.removeNetwork(e,t).then((e=>e(n,r))),removeNode:(e,t,o)=>i.removeNode(e,t,o).then((e=>e(n,r)))}};e.RequestorApi=class extends i.BaseAPI{addAddress(t,r,n){return e.RequestorApiFp(this.configuration).addAddress(t,r,n).then((e=>e(this.axios,this.basePath)))}addNode(t,r,n){return e.RequestorApiFp(this.configuration).addNode(t,r,n).then((e=>e(this.axios,this.basePath)))}createNetwork(t,r){return e.RequestorApiFp(this.configuration).createNetwork(t,r).then((e=>e(this.axios,this.basePath)))}getAddresses(t,r){return e.RequestorApiFp(this.configuration).getAddresses(t,r).then((e=>e(this.axios,this.basePath)))}getConnections(t,r){return e.RequestorApiFp(this.configuration).getConnections(t,r).then((e=>e(this.axios,this.basePath)))}getNetwork(t,r){return e.RequestorApiFp(this.configuration).getNetwork(t,r).then((e=>e(this.axios,this.basePath)))}getNetworks(t){return e.RequestorApiFp(this.configuration).getNetworks(t).then((e=>e(this.axios,this.basePath)))}getNodes(t,r){return e.RequestorApiFp(this.configuration).getNodes(t,r).then((e=>e(this.axios,this.basePath)))}removeNetwork(t,r){return e.RequestorApiFp(this.configuration).removeNetwork(t,r).then((e=>e(this.axios,this.basePath)))}removeNode(t,r,n){return e.RequestorApiFp(this.configuration).removeNode(t,r,n).then((e=>e(this.axios,this.basePath)))}}}(al),function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(al,e)}(sl);var dl={};Object.defineProperty(dl,"__esModule",{value:!0}),dl.Configuration=void 0;dl.Configuration=class{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ \t]+/[^;/ \t]+[+]json)[ \t]*(;.*)?$","i");return null!==e&&(t.test(e)||"application/json-patch+json"===e.toLowerCase())}};var fl={},pl={};Object.defineProperty(pl,"__esModule",{value:!0});var gl={};Object.defineProperty(gl,"__esModule",{value:!0});var ml={};Object.defineProperty(ml,"__esModule",{value:!0});var vl={};Object.defineProperty(vl,"__esModule",{value:!0});var yl={};Object.defineProperty(yl,"__esModule",{value:!0}),function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(pl,e),r(gl,e),r(ml,e),r(vl,e),r(yl,e)}(fl),function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(sl,e),r(dl,e),r(fl,e)}(ol),Object.defineProperty(nc,"__esModule",{value:!0}),nc.yaPayment=nc.yaMarket=wl=nc.yaActivity=void 0;var bl=El(hu()),wl=nc.yaActivity=bl,Sl=El(Fr());nc.yaMarket=Sl;var Pl=El(il());nc.yaPayment=Pl;var Al=El(ol);function Ol(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return Ol=function(){return e},e}function El(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=Ol();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}nc.yaNet=Al;var Rl=fc();const _l="http://127.0.0.1:7465",Il=1e4,jl=6e4,Tl=3e3;class xl{api;activityRequestTimeout;activityExecuteTimeout;activityExeBatchResultsFetchInterval;logger;eventTarget;yagnaOptions;constructor(e){const t=e?.yagnaOptions?.apiKey||process.env.YAGNA_APPKEY;if(!t)throw new Error("Api key not defined");const r=e?.yagnaOptions?.basePath||process.env.YAGNA_API_URL||_l,n=new wl.Configuration({apiKey:t,basePath:`${r}/activity-api/v1`,accessToken:t});this.api={control:new Rl.RequestorControlApi(n),state:new Rl.RequestorStateApi(n)},this.activityRequestTimeout=e?.activityRequestTimeout||Il,this.activityExecuteTimeout=e?.activityExecuteTimeout||jl,this.activityExeBatchResultsFetchInterval=e?.activityExeBatchResultsFetchInterval||Tl,this.logger=e?.logger,this.yagnaOptions={apiKey:t,basePath:r},this.eventTarget=e?.eventTarget}}class kl{agreementId;options;constructor(e,t){this.agreementId=e,this.options=new xl(t)}async create(e=!1){try{if(e)throw new Error("Not implemented");return this.createActivity(this.agreementId,this.options)}catch(e){throw e?.response?.data?.message||e}}async createActivity(e,t){const{data:r}=await this.options.api.control.createActivity({agreementId:e}),n="string"==typeof r?r:r.activityId;return this.options.logger?.debug(`Activity ${n} created`),this.options.eventTarget?.dispatchEvent(new Lo({id:n,agreementId:e})),new Bl(n,e,t)}}var Nl;!function(e){e.New="New",e.Initialized="Initialized",e.Deployed="Deployed",e.Ready="Ready",e.Unresponsive="Unresponsive",e.Terminated="Terminated"}(Nl||(Nl={}));class Bl{id;agreementId;options;logger;isRunning=!0;constructor(e,t,r){this.id=e,this.agreementId=t,this.options=r,this.logger=r?.logger}static async create(e,t,r=!1){return new kl(e,t).create(r)}async execute(e,t,r){let n,i,o=new Date;try{n=await this.send(e),o=new Date,i=JSON.parse(e.text).length}catch(e){throw this.logger?.error(e),new Error(e?.response?.data?.message||e)}return this.logger?.debug(`Script sent. Batch ID: ${n}`),this.options.eventTarget?.dispatchEvent(new $o({activityId:this.id,agreementId:this.agreementId})),t?this.streamingBatch(n,i,o,r):this.pollingBatch(n,o,r)}async stop(){return this.isRunning=!1,await this.end(),!0}async getState(){try{const{data:e}=await this.options.api.state.getActivityState(this.id),t=e.state[0];return Nl[t]}catch(e){throw this.logger?.warn(`Cannot query activity state: ${e}`),e}}async send(e){const{data:t}=await this.options.api.control.exec(this.id,e,{timeout:this.options.activityRequestTimeout});return t}async end(){await this.options.api.control.destroyActivity(this.id,this.options.activityRequestTimeout,{timeout:1e3*(this.options.activityRequestTimeout+1)}).catch((e=>{throw this.logger?.warn(`Got API Exception when destroying activity ${this.id}: ${e}`),e})),this.options.eventTarget?.dispatchEvent(new qo(this)),this.logger?.debug(`Activity ${this.id} destroyed`)}async pollingBatch(e,t,r){let n,i=!1,o=0;const{id:s,agreementId:a}=this,c=()=>this.isRunning,{activityExecuteTimeout:u,api:l,activityExeBatchResultsFetchInterval:h,eventTarget:d}=this.options,f=this.handleError.bind(this);return new ec.Readable({objectMode:!0,async read(){for(;!i;){if(t.valueOf()+(r||u)<=(new Date).valueOf())return this.destroy(new Error(`Activity ${s} timeout.`));if(!c())return this.destroy(new Error(`Activity ${s} has been interrupted.`));try{const{data:t}=await l.control.getExecBatchResults(s,e),r=t.slice(n+1);Array.isArray(r)&&r.length&&r.forEach((e=>{this.push(e),i=e.isBatchFinished||!1,n=e.index})),i||await Ct(h,!0)}catch(e){try{o=await f(e,n,o,3)}catch(e){return d?.dispatchEvent(new Vo({activityId:s,agreementId:a,success:!1})),this.destroy(e?.message||e)}}}d?.dispatchEvent(new Vo({activityId:s,agreementId:a,success:!0})),this.push(null)}})}async streamingBatch(e,t,r,n){const i=this.options?.yagnaOptions?.basePath||this.options.api.control.configuration?.basePath,o=this.options?.yagnaOptions?.apiKey||this.options.api.control.configuration?.apiKey,s=new as(`${i}/activity/${this.id}/exec/${e}`,{headers:{Accept:"text/event-stream",Authorization:`Bearer ${o}`}});let a=!1;const c=this.id,u=()=>this.isRunning,l=this.options.activityExecuteTimeout,h=[];s.addEventListener("error",(e=>h.push(e?.message||e)));const d=[];return s.addEventListener("runtime",(e=>d.push(this.parseEventToResult(e.data,t)))),new ec.Readable({objectMode:!0,async read(){for(;!a;){if(r.valueOf()+(n||l)<=(new Date).valueOf())return this.destroy(new Error(`Activity ${c} timeout.`));if(!u())return this.destroy(new Error(`Activity ${c} has been interrupted.`));if(h.length)return this.destroy(new Error(`GetExecBatchResults failed due to errors: ${JSON.stringify(h)}`));if(d.length){const e=d.shift();this.push(e),a=e?.isBatchFinished||!1}await Ct(500,!0)}this.push(null)}})}async handleError(e,t,r,n){if(this.isTimeoutError(e))return this.logger?.warn("API request timeout."+e.toString()),r;const{terminated:i,reason:o,errorMessage:s}=await this.isTerminated();if(i){const t=(o||"")+(s||"");throw this.logger?.warn(`Activity ${this.id} terminated by provider. ${t?"Reason: "+t:""}`),e}if(!this.isGsbError(e))throw e;const a="getExecBatchResults failed due to GSB error";if(++r<n)return this.logger?.debug(`${a}, retrying in ${this.options.activityExeBatchResultsFetchInterval}.`),r;this.logger?.debug(`${a}, giving up after ${r} attempts.`);throw new Error(`Command #${t||0} getExecBatchResults error: ${e?.response?.data?.message||e}`)}isTimeoutError(e){const t=e.message&&e.message.includes("timeout");return e.response&&408===e.response.status||"ETIMEDOUT"===e.code||"ECONNABORTED"===e.code&&t}isGsbError(e){if(!e.response)return!1;if(500!==e.response.status)return!1;if(!e.response.data||!e.response.data.message)return this.logger?.debug(`Cannot read error message, response: ${e.response}`),!1;const t=e.response.data.message;return t.includes("endpoint address not found")&&t.includes("GSB error")}async isTerminated(){try{const{data:e}=await this.options.api.state.getActivityState(this.id);return{terminated:Nl[e?.state?.[0]]===Nl.Terminated,reason:e?.reason,errorMessage:e?.errorMessage}}catch(e){return this.logger?.debug(`Cannot query activity state: ${e}`),{terminated:!1}}}parseEventToResult(e,t){try{const r=JSON.parse(e);return{index:r.index,eventDate:r.timestamp,result:r?.kind?.finished?0===r?.kind?.finished?.return_code?"Ok":"Error":void 0,stdout:r?.kind?.stdout,stderr:r?.kind?.stderr,message:r?.kind?.finished?.message,isBatchFinished:r.index+1>=t&&Boolean(r?.kind?.finished)}}catch(t){throw new Error(`Cannot parse ${e} as StreamingBatchEvent`)}}}const Ml=5,Dl=1e3,Cl=3e4,Ul=1e3;class Fl extends xl{maxParallelTasks;taskRunningInterval;taskTimeout;activityStateCheckingInterval;storageProvider;logger;constructor(e){super(e),this.maxParallelTasks=e?.maxParallelTasks||Ml,this.taskRunningInterval=e?.taskRunningInterval||Dl,this.taskTimeout=e?.taskTimeout||Cl,this.activityStateCheckingInterval=e?.activityStateCheckingInterval||Ul,this.logger=e?.logger,this.storageProvider=e?.storageProvider}}class Ll{tasksQueue;agreementPoolService;paymentService;networkService;activeTasksCount=0;activities=new Map;initWorkersDone=new Set;isRunning=!1;logger;options;constructor(e,t,r,n,i){this.tasksQueue=e,this.agreementPoolService=t,this.paymentService=r,this.networkService=n,this.options=new Fl(i),this.logger=i?.logger}async run(){for(this.isRunning=!0,this.logger?.debug("Task Service has started");this.isRunning;){if(this.activeTasksCount>=this.options.maxParallelTasks){await Ct(this.options.taskRunningInterval,!0);continue}const e=this.tasksQueue.get();e?this.startTask(e).catch((e=>this.isRunning&&this.logger?.error(e))):await Ct(this.options.taskRunningInterval,!0)}}async end(){this.isRunning=!1;for(const e of this.activities.values())await e.stop().catch((e=>this.logger?.error(e)));this.logger?.debug("Task Service has been stopped")}async startTask(e){e.start(),this.logger?.debug(`Starting task. ID: ${e.id}, Data: ${e.getData()}`),++this.activeTasksCount;const t=await this.agreementPoolService.getAgreement();let r;try{this.activities.has(t.id)?r=this.activities.get(t.id):(r=await Bl.create(t.id,this.options),this.activities.set(t.id,r)),this.options.eventTarget?.dispatchEvent(new So({id:e.id,agreementId:t.id,activityId:r.id})),this.logger?.info(`Task ${e.id} sent to provider ${t.provider.name}.${e.getData()?" Data: "+e.getData():""}`),this.paymentService.acceptDebitNotes(t.id);const n=e.getInitWorker(),i=e.getWorker(),o=e.getData(),s=await(this.networkService?.addNode(t.provider.id)),a=new eh(r,{initWorker:n,provider:t.provider,storageProvider:this.options.storageProvider,networkNode:s,logger:this.logger,activityStateCheckingInterval:this.options.activityStateCheckingInterval,workTimeout:this.options.taskTimeout,isRunning:()=>this.isRunning});await a.before(),n&&!this.initWorkersDone.has(r.id)&&(this.initWorkersDone.add(r.id),this.logger?.debug(`Init worker done in activity ${r.id}`));const c=await i(a,o);e.stop(c),this.options.eventTarget?.dispatchEvent(new Oo({id:e.id})),this.logger?.info(`Task ${e.id} computed by provider ${t.provider.name}.${e.getData()?" Data: "+e.getData():""}`)}catch(n){if(e.stop(void 0,n),!e.isRetry()||!this.isRunning){await r.stop().catch((e=>this.logger?.error(e))),this.activities.delete(t.id),await this.agreementPoolService.releaseAgreement(t.id,!1);const i=n.message||n.toString();throw this.options.eventTarget?.dispatchEvent(new Ao({id:e.id,reason:i})),new Error(`Task ${e.id} has been rejected! ${i}`)}this.tasksQueue.addToBegin(e),this.options.eventTarget?.dispatchEvent(new Po({id:e.id,retriesCount:e.getRetriesCount()})),this.logger?.warn(`Task ${e.id} execution failed. Trying to redo the task. Attempt #${e.getRetriesCount()}. ${n}`)}finally{--this.activeTasksCount,this.paymentService.acceptPayments(t)}await this.agreementPoolService.releaseAgreement(t.id,!0)}}var ql;!function(e){e[e.New=0]="New",e[e.Retry=1]="Retry",e[e.Pending=2]="Pending",e[e.Done=3]="Done",e[e.Rejected=4]="Rejected"}(ql||(ql={}));class $l{id;worker;data;initWorker;state=ql.New;results;error;retriesCount=0;constructor(e,t,r,n){this.id=e,this.worker=t,this.data=r,this.initWorker=n}start(){this.state=ql.Pending}stop(e,t,r=!0){t?(++this.retriesCount,this.state=r&&this.retriesCount<=5?ql.Retry:ql.Rejected,this.error=t):(this.state=ql.Done,this.results=e)}isQueueable(){return this.state===ql.New||this.state===ql.Retry}isRetry(){return this.state===ql.Retry}isFinished(){return this.state===ql.Done||this.state===ql.Rejected}isRejected(){return this.state===ql.Rejected}isPending(){return this.state===ql.Pending}isNew(){return this.state===ql.New}getResults(){return this.results}getData(){return this.data}getWorker(){return this.worker}getInitWorker(){return this.initWorker}getRetriesCount(){return this.retriesCount}getError(){return this.error}}class Vl{itemsStack=[];addToEnd(e){this._checkIfTaskIsEligibleForAdd(e),this.itemsStack.push(e)}addToBegin(e){this._checkIfTaskIsEligibleForAdd(e),this.itemsStack.unshift(e)}get size(){return this.itemsStack.length}get(){return this.itemsStack.shift()}_checkIfTaskIsEligibleForAdd(e){if(!e.isQueueable())throw new Error("You cannot add a task that is not in the correct state")}}class zl{commands;static create(e){return new zl(e)}constructor(e=[]){this.commands=e}add(e){this.commands.push(e)}async before(){for(const e of this.commands)await e.before()}async after(){for(const e of this.commands)await e.after()}getExeScriptRequest(){if(!this.commands.length)throw new Error("There are no commands in the script");return{text:JSON.stringify(this.commands.map((e=>e.toJson())))}}}class Hl{commandName;args;constructor(e,t){this.commandName=e,this.args=t||{}}toJson(){return{[this.commandName]:this.args}}toExeScriptRequest(){return{text:JSON.stringify([this.toJson()])}}async before(){}async after(){}}class Yl extends Hl{constructor(e){super("deploy",e)}}class Gl extends Hl{constructor(e){super("start",e)}}class Wl extends Hl{constructor(e,t,r,n){super("run",{entry_point:e,args:t,env:r,capture:n||{stdout:{atEnd:{format:"string"}},stderr:{atEnd:{format:"string"}}}})}}class Kl extends Hl{from;to;constructor(e,t,r){super("transfer",{from:e,to:t,args:r}),this.from=e,this.to=t}}class Jl extends Kl{storageProvider;src;dstPath;constructor(e,t,r){super(),this.storageProvider=e,this.src=t,this.dstPath=r,this.args.to=`container:${r}`}async before(){this.args.from=await this.storageProvider.publish(this.src)}async after(){await this.storageProvider.release([this.args.from])}}class Zl extends Kl{storageProvider;srcPath;dstPath;constructor(e,t,r){super(),this.storageProvider=e,this.srcPath=t,this.dstPath=r,this.args={from:`container:${t}`}}async before(){this.args.to=await this.storageProvider.receive(this.dstPath)}}const Xl=1e4,Ql=1e3;class eh{activity;options;provider;workTimeout;logger;activityStateCheckingInterval;storageProvider;networkNode;constructor(e,t){this.activity=e,this.options=t,this.workTimeout=t?.workTimeout||Xl,this.logger=t?.logger,this.activityStateCheckingInterval=t?.activityStateCheckingInterval||Ql,this.provider=t?.provider,this.storageProvider=t?.storageProvider,this.networkNode=t?.networkNode}async before(){let e=await this.activity.getState();if(e===Nl.Ready)return void(this.options?.initWorker&&await(this.options?.initWorker(this,void 0)));e===Nl.Initialized&&await this.activity.execute(new zl([new Yl(this.networkNode?.getNetworkConfig?.()),new Gl]).getExeScriptRequest());let t=!1;const r=setTimeout((()=>t=!0),this.workTimeout);for(;e!==Nl.Ready&&!t&&this.options?.isRunning();)await Ct(this.activityStateCheckingInterval,!0),e=await this.activity.getState();if(clearTimeout(r),e!==Nl.Ready)throw new Error(`Activity ${this.activity.id} cannot reach the Ready state. Current state: ${e}`);this.options?.initWorker&&await(this.options?.initWorker(this,void 0))}async run(...e){const t=1===e.length?new Wl("/bin/sh",["-c",e[0]]):new Wl(e[0],e[1]);return this.runOneCommand(t)}async uploadFile(e,t){return Vt("Upload File"),this.runOneCommand(new Jl(this.storageProvider,e,t))}async uploadJson(e,t){Vt("Upload JSON");const r=Buffer.from(JSON.stringify(e),"utf-8");return this.runOneCommand(new Jl(this.storageProvider,r,t))}async downloadFile(e,t){return Vt("Download File"),this.runOneCommand(new Zl(this.storageProvider,e,t))}beginBatch(){return th.create(this.activity,this.storageProvider,this.logger)}rejectResult(e){throw new Error(`Work rejected by user. Reason: ${e}`)}getWebsocketUri(e){if(!this.networkNode)throw new Error("There is no network in this work context");return this.networkNode?.getWebsocketUri(e)}async runOneCommand(e){const t=new zl([e]);await t.before(),await Ct(100,!0);const r=await this.activity.execute(t.getExeScriptRequest()),n=[];for await(const e of r)n.push(e);const i=n.filter((e=>"Error"===e.result));if(await t.after(),i.length){const e=i.map((e=>`Error: ${e.message}. Stdout: ${e.stdout?.trim()}. Stderr: ${e.stderr?.trim()}`)).join(". ");throw this.rejectResult(`Task error on provider ${this.provider?.name||"'unknown'"}. ${e}`),new Error(e)}return n[0]}}class th{activity;storageProvider;logger;script;static create(e,t,r){return new th(e,t,r)}constructor(e,t,r){this.activity=e,this.storageProvider=t,this.logger=r,this.script=new zl([])}run(...e){return this.script.add(1===e.length?new Wl("/bin/sh",["-c",e[0]]):new Wl(e[0],e[1])),this}uploadFile(e,t){return Vt("Upload File"),this.script.add(new Jl(this.storageProvider,e,t)),this}uploadJson(e,t){Vt("Upload JSON");const r=Buffer.from(JSON.stringify(e),"utf-8");return this.script.add(new Jl(this.storageProvider,r,t)),this}downloadFile(e,t){return Vt("Download File"),this.script.add(new Zl(this.storageProvider,e,t)),this}async end(){await this.script.before(),await Ct(100,!0);const e=await this.activity.execute(this.script.getExeScriptRequest()),t=[];return new Promise(((r,n)=>{e.on("data",(e=>{if(t.push(e),"Error"===e.result)return this.script.after(),n(`Error: ${e.message}`)})),e.on("end",(()=>{this.script.after(),r(t)})),e.on("error",(e=>{this.script.after(),n(e)}))}))}async endStream(){const e=this.script;await e.before();const t=await this.activity.execute(this.script.getExeScriptRequest()),r=new ec.Transform({objectMode:!0,transform(t,r,n){const i="Error"===t?.result?new Error(`${t?.message}. Stdout: ${t?.stdout?.trim()}. Stderr: ${t?.stderr?.trim()}`):null;i?(e.after(),this.destroy(i)):n(null,t)}});return t.on("end",(()=>this.script.after())),t.on("error",(r=>{e.after(),t.destroy(r)})),t.pipe(r)}}var rh=il(),nh=wu();const ih={basePath:"http://127.0.0.1:7465",budget:1,payment:{driver:"erc20",network:"rinkeby"},paymentTimeout:2e4,allocationExpires:18e5,invoiceReceiveTimeout:3e5,maxInvoiceEvents:10,maxDebitNotesEvents:10,invoiceFetchingInterval:2e3,debitNotesFetchingInterval:2e3,payingInterval:2e3,paymentRequestTimeout:1e4};class oh{options;yagnaOptions;paymentTimeout;api;logger;eventTarget;payment;paymentRequestTimeout;constructor(e){this.options=e,this.yagnaOptions=e?.yagnaOptions;const t=e?.yagnaOptions?.apiKey||process.env.YAGNA_APPKEY;if(!t)throw new Error("Api key not defined");const r=e?.yagnaOptions?.basePath||process.env.YAGNA_API_URL||ih.basePath,n=new rh.Configuration({apiKey:t,basePath:`${r}/payment-api/v1`,accessToken:t});this.api=new nh.RequestorApi(n),this.paymentTimeout=e?.paymentTimeout||ih.paymentTimeout,this.payment={driver:e?.payment?.driver||ih.payment.driver,network:e?.payment?.network||ih.payment.network},this.logger=e?.logger,this.eventTarget=e?.eventTarget,this.paymentRequestTimeout=e?.paymentRequestTimeout||ih.paymentRequestTimeout}}class sh extends oh{invoiceFetchingInterval;debitNotesFetchingInterval;payingInterval;maxInvoiceEvents;maxDebitNotesEvents;constructor(e){super(e),this.invoiceFetchingInterval=e?.invoiceFetchingInterval||ih.invoiceFetchingInterval,this.debitNotesFetchingInterval=e?.debitNotesFetchingInterval||ih.debitNotesFetchingInterval,this.maxInvoiceEvents=e?.maxInvoiceEvents||ih.maxInvoiceEvents,this.maxDebitNotesEvents=e?.maxDebitNotesEvents||ih.maxDebitNotesEvents,this.payingInterval=e?.payingInterval||ih.payingInterval}}class ah extends oh{budget;payment;expires;account;constructor(e){if(super(e),!e||!e?.account)throw new Error("Account option is required");this.account=e.account,this.budget=e?.budget||ih.budget,this.payment={driver:e?.payment?.driver||ih.payment.driver,network:e?.payment?.network||ih.payment.network},this.expires=e?.expires||ih.allocationExpires}}class ch extends oh{constructor(e){super(e)}}class uh extends oh{constructor(e){const t=e?.yagnaOptions?.apiKey||process.env.YAGNA_APPKEY;if(!t)throw new Error("Api key not defined");const r={apiKey:t,basePath:e?.yagnaOptions?.basePath||process.env.YAGNA_API_URL||ih.basePath};super({...e,yagnaOptions:r})}}class lh{options;id;timestamp;timeout;address;paymentPlatform;totalAmount;spentAmount;remainingAmount;static async create(e){const t=new ah(e),r=new Date,n={totalAmount:t.budget.toString(),paymentPlatform:t.account.platform,address:t.account.address,timestamp:r.toISOString(),timeout:new Date(+r+t.expires).toISOString(),makeDeposit:!1,remainingAmount:"",spentAmount:"",allocationId:""},{data:i}=await t.api.createAllocation(n).catch((e=>{throw new Error(`Could not create new allocation. ${e.response?.data?.message||e.response?.data||e}`)}));return t.eventTarget?.dispatchEvent(new Eo({id:i.allocationId,amount:parseFloat(i.totalAmount),platform:i.paymentPlatform})),t.logger?.debug(`Allocation ${i.allocationId} has been created using payment platform ${t.account.platform}`),new lh(t,i)}constructor(e,t){if(this.options=e,this.id=t.allocationId,this.timeout=t.timeout,this.timestamp=t.timestamp,this.totalAmount=t.totalAmount,this.spentAmount=t.spentAmount,this.remainingAmount=t.remainingAmount,!t.address||!t.paymentPlatform)throw new Error("Account address and payment platform are required");this.address=t.address,this.paymentPlatform=t.paymentPlatform}async getRemainingAmount(){return await this.refresh(),this.remainingAmount}async getSpentAmount(){return await this.refresh(),this.spentAmount}async release(){await this.options.api.releaseAllocation(this.id).catch((e=>{throw new Error(`Could not release allocation. ${e.response?.data?.message||e}`)})),this.options?.logger?.debug(`Allocation ${this.id} has been released.`)}async getDemandDecoration(){const{data:e}=await this.options.api.getDemandDecorations([this.id]).catch((e=>{throw new Error(`Unable to get demand decorations. ${e.response?.data?.message||e}`)}));return e}async refresh(){const{data:e}=await this.options.api.getAllocation(this.id).catch((e=>{throw new Error(`Could not get allocation data. ${e.response?.data||e}`)}));this.remainingAmount=e.remainingAmount,this.spentAmount=e.spentAmount}}class hh{options;static async create(e){return new hh(new uh(e))}constructor(e){this.options=e}async list(){const{data:e}=await this.options.api.getRequestorAccounts();return e}}class dh{options;providerId;recipientId;payeeAddr;payerAddr;paymentPlatform;agreementId;paymentDueDate;status;constructor(e,t){this.options=t,this.providerId=e.issuerId,this.recipientId=e.recipientId,this.payeeAddr=e.payeeAddr,this.payerAddr=e.payerAddr,this.paymentPlatform=e.paymentPlatform,this.agreementId=e.agreementId,this.paymentDueDate=e.paymentDueDate,this.status=e.status}async getStatus(){return await this.refreshStatus(),this.status}}class fh extends dh{options;id;activityIds;amount;timestamp;recipientId;static async create(e,t){const r=new ch(t),{data:n}=await r.api.getInvoice(e);return new fh(n,r)}constructor(e,t){super(e,t),this.options=t,this.id=e.invoiceId,this.activityIds=e.activityIds,this.amount=e.amount,this.timestamp=e.timestamp,this.recipientId=e.recipientId}async getStatus(){return await this.refreshStatus(),this.status}async accept(e,t){try{await this.options.api.acceptInvoice(this.id,{totalAmountAccepted:e,allocationId:t})}catch(e){const t=e?.response?.data?.message||e;throw this.options.eventTarget?.dispatchEvent(new Fo({id:this.id,agreementId:this.agreementId,reason:t})),new Error(`Unable to accept invoice ${this.id} ${t}`)}this.options.eventTarget?.dispatchEvent(new Uo(this))}async reject(e){try{await this.options.api.rejectInvoice(this.id,e)}catch(e){throw new Error(`Unable to reject invoice ${this.id} ${e?.response?.data?.message||e}`)}finally{this.options.eventTarget?.dispatchEvent(new Fo({id:this.id,agreementId:this.agreementId,reason:e.message}))}}async refreshStatus(){const{data:e}=await this.options.api.getInvoice(this.id);this.status=e.status}}class ph extends dh{options;id;previousDebitNoteId;timestamp;activityId;totalAmountDue;usageCounterVector;static async create(e,t){const r=new ch(t),{data:n}=await r.api.getDebitNote(e);return new ph(n,r)}constructor(e,t){super(e,t),this.options=t,this.id=e.debitNoteId,this.timestamp=e.timestamp,this.activityId=e.activityId,this.totalAmountDue=e.totalAmountDue,this.usageCounterVector=e.usageCounterVector}async accept(e,t){try{await this.options.api.acceptDebitNote(this.id,{totalAmountAccepted:e,allocationId:t})}catch(e){const t=e?.response?.data?.message||e;throw this.options.eventTarget?.dispatchEvent(new Fo({id:this.id,agreementId:this.agreementId,reason:t})),new Error(`Unable to accept debit note ${this.id} ${e?.response?.data?.message||e}`)}}async reject(e){try{await this.options.api.rejectDebitNote(this.id,e)}catch(e){throw new Error(`Unable to reject debit note ${this.id} ${e?.response?.data?.message||e}`)}finally{this.options.eventTarget?.dispatchEvent(new Fo({id:this.id,agreementId:this.agreementId,reason:e.message}))}}async refreshStatus(){const{data:e}=await this.options.api.getDebitNote(this.id);this.status=e.status}}const gh="PaymentReceived";let mh=class e extends EventTarget{isRunning=!0;options;logger;lastInvoiceFetchingTime=(new Date).toISOString();lastDebitNotesFetchingTime=(new Date).toISOString();static async create(t){return new e(new sh(t))}constructor(e){super(),this.options=new sh(e),this.logger=this.options.logger,this.subscribe().catch((e=>this.logger?.error(e)))}async unsubscribe(){this.isRunning=!1,this.removeEventListener(gh,null),this.logger?.debug("Payments unsubscribed")}async subscribe(){this.subscribeForInvoices().catch((e=>this.logger?.error(`Unable to collect invoices. ${e?.response?.data?.message||e}`))),this.subscribeForDebitNotes().catch((e=>this.logger?.error(`Unable to collect debit notes. ${e?.response?.data?.message||e}`)))}async subscribeForInvoices(){for(;this.isRunning;){const{data:e}=await this.options.api.getInvoiceEvents(this.options.paymentRequestTimeout/1e3,this.lastInvoiceFetchingTime,this.options.maxInvoiceEvents).catch((e=>(this.logger?.error(`Unable to collect invoices. ${e?.response?.data?.message||e}`),{data:[]})));for(const t of e){if("InvoiceReceivedEvent"!==t.eventType)continue;const e=await fh.create(t.invoiceId,{...this.options.options}).catch((e=>this.logger?.error(`Unable to create invoice ID: ${t.invoiceId}. ${e?.response?.data?.message||e}`)));this.dispatchEvent(new vh(gh,e)),this.lastInvoiceFetchingTime=t.eventDate,this.options.eventTarget?.dispatchEvent(new Do(e)),this.logger?.debug(`New Invoice received for agreement ${e.agreementId}`)}await Ct(this.options.invoiceFetchingInterval,!0)}}async subscribeForDebitNotes(){for(;this.isRunning;){const{data:e}=await this.options.api.getDebitNoteEvents(this.options.paymentRequestTimeout/1e3,this.lastDebitNotesFetchingTime,this.options.maxDebitNotesEvents).catch((e=>(this.logger?.error(`Unable to collect debit notes. ${e?.response?.data?.message||e}`),{data:[]})));for(const t of e){if("DebitNoteReceivedEvent"!==t.eventType)continue;const e=await ph.create(t.debitNoteId,{...this.options.options}).catch((e=>this.logger?.error(`Unable to create debit note ID: ${t.debitNoteId}. ${e?.response?.data?.message||e}`)));this.dispatchEvent(new yh(gh,e)),this.lastDebitNotesFetchingTime=t.eventDate,this.options.eventTarget?.dispatchEvent(new Co({id:e.id,agreementId:e.agreementId,amount:e.totalAmountDue})),this.logger?.debug(`New Debit Note received for agreement ${e.agreementId}`)}await Ct(this.options.debitNotesFetchingInterval,!0)}}};class vh extends Event{invoice;constructor(e,t){super(e,t),this.invoice=t}}class yh extends Event{debitNote;constructor(e,t){super(e,t),this.debitNote=t}}class bh{isRunning=!1;options;logger;allocations=[];agreementsToPay=new Map;agreementsDebitNotes=new Set;invoicesToPay=new Map;debitNotesToPay=new Map;paidAgreements=new Set;payments;constructor(e){this.options=new sh(e),this.logger=this.options.logger}async run(){this.isRunning=!0,this.payments=await mh.create(this.options),this.payments.addEventListener(gh,this.subscribePayments.bind(this)),this.processInvoices().catch((e=>this.logger?.error(e))),this.processDebitNotes().catch((e=>this.logger?.error(e))),this.logger?.debug("Payment Service has started")}async end(){if(this.agreementsToPay.size){this.logger?.debug("Waiting for all invoices to be paid...");let e=!1;const t=setTimeout((()=>e=!0),this.options.paymentTimeout);let r=0;for(;this.isRunning&&!e;)this.isRunning=0!==this.agreementsToPay.size,await Ct(2e3,!0),r++,r>10&&(this.logger?.info(`Waiting for ${this.agreementsToPay.size} invoice to be paid...`),r=0);clearTimeout(t)}this.isRunning=!1,this.payments?.unsubscribe().catch((e=>this.logger?.warn(e))),this.payments?.removeEventListener(gh,this.subscribePayments.bind(this));for(const e of this.allocations)await e.release().catch((e=>this.logger?.warn(e)));this.logger?.debug("All allocations has benn released"),this.logger?.debug("Payment service has been stopped")}async createAllocations(){const e=await(await hh.create(this.options)).list().catch((e=>{throw new Error(`Unable to get requestor accounts ${e.response?.data?.message||e.response?.data||e}`)}));for(const t of e)t.driver===this.options.payment.driver.toLowerCase()&&t.network===this.options.payment.network.toLowerCase()?this.allocations.push(await lh.create({...this.options.options,account:t})):this.logger?.debug(`Not using payment platform ${t.platform}, platform's driver/network ${t.driver}/${t.network} is different than requested driver/network ${this.options.payment.driver}/${this.options.payment.network}`);return this.allocations}acceptPayments(e){this.agreementsToPay.set(e.id,e)}acceptDebitNotes(e){this.agreementsDebitNotes.add(e)}async processInvoices(){for(;this.isRunning;){for(const e of this.invoicesToPay.values()){const t=this.agreementsToPay.get(e.agreementId);if(t)try{const r=this.getAllocationForPayment(e);await e.accept(e.amount,r.id),this.invoicesToPay.delete(e.id),this.paidAgreements.add({invoice:e,agreement:t}),this.agreementsDebitNotes.delete(e.agreementId),this.agreementsToPay.delete(e.agreementId),this.logger?.info(`Invoice accepted from ${t.provider.name}`)}catch(e){this.logger?.error(`Invoice failed from ${t.provider.name}. ${e}`)}else this.invoicesToPay.delete(e.id),this.logger?.debug(`Agreement ${e.agreementId} has not been accepted to payment`)}await Ct(this.options.payingInterval,!0)}}async processDebitNotes(){for(;this.isRunning;){for(const e of this.debitNotesToPay.values())if(this.agreementsDebitNotes.has(e.agreementId))try{const t=this.getAllocationForPayment(e);await e.accept(e.totalAmountDue,t.id),this.debitNotesToPay.delete(e.id),this.logger?.debug(`Debit Note accepted for agreement ${e.agreementId}`)}catch(t){this.logger?.error(`Payment Debit Note failed for agreement ${e.agreementId} ${t}`)}await Ct(this.options.payingInterval,!0)}}async subscribePayments(e){e instanceof vh&&this.invoicesToPay.set(e.invoice.id,e.invoice),e instanceof yh&&this.debitNotesToPay.set(e.debitNote.id,e.debitNote)}getAllocationForPayment(e){const t=this.allocations.find((t=>t.paymentPlatform===e.paymentPlatform&&t.address===e.payerAddr));if(!t)throw new Error(`No allocation for ${e.paymentPlatform} ${e.payerAddr}`);return t}}var wh;!function(e){e.UnsolicitedService="UNSOLICITED_SERVICE",e.BadService="BAD_SERVICE",e.IncorrectAmount="INCORRECT_AMOUNT"}(wh||(wh={}));var Sh={},Ph={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.matchingBitCount=e.intLog2=e.cidrPrefixToMaskBinaryString=e.leftPadWithZeroBit=e.dottedDecimalNotationToBinaryString=e.parseBinaryStringToBigInt=e.decimalNumberToOctetString=e.numberToBinaryString=void 0,e.numberToBinaryString=e=>e.toString(2),e.decimalNumberToOctetString=t=>{let r=e.numberToBinaryString(t);if(r.length>8)throw new Error("Given decimal in binary contains digits greater than an octet");return e.leftPadWithZeroBit(r,8)},e.parseBinaryStringToBigInt=e=>BigInt(`0b${e}`),e.dottedDecimalNotationToBinaryString=t=>t.split(".").reduce(((t,r)=>t.concat(e.decimalNumberToOctetString(parseInt(r)))),""),e.leftPadWithZeroBit=(e,t)=>{if(e.length>t)throw new Error(`Given string is already longer than given final length after padding: ${t}`);return"0".repeat(t-e.length).concat(e)},e.cidrPrefixToMaskBinaryString=(e,t)=>{let r;if(r="IPv4"==t?32:128,e>r)throw Error(`Value is greater than ${r}`);return`${"1".repeat(e)}${"0".repeat(r-e)}`},e.intLog2=e=>{let t=0;for(;e%2n===0n;){if(2n===e){t++;break}if((e>>=1n)%2n!==0n){t=0;break}t++}if(0==t)throw new Error(`The value of log2 for ${e.toString()} is not an integer`);return t},e.matchingBitCount=(e,t)=>{let r,n;e.length>=t.length?(r=e,n=t):(r=t,n=e);let i=0;for(;i<r.length&&r.charAt(i)===n.charAt(i);i++);return i}}(Ph);var Ah,Oh={},Eh={},Rh={};function _h(){if(Ah)return Rh;Ah=1,Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.collapseIPv6Number=Rh.expandIPv6Number=void 0;const e=Ph,t=kh();let r=e=>e.includes("/")?`/${e.split("/")[1]}`:"";return Rh.expandIPv6Number=n=>{let i=t=>t.map((t=>e.leftPadWithZeroBit(t,4))).join(":");if(/(:){3,}/.test(n))throw"given IPv6 contains consecutive : more than two";const o=r(n);if(n.includes("/")&&(n=n.split("/")[0]),!t.Validator.IPV6_PATTERN.test(n))throw Error(t.Validator.invalidIPv6PatternMessage);if(n.includes("::")){let e=n.split("::"),t=e[0],r=e[1],s=t.split(":").filter((e=>""!==e)),a=r.split(":").filter((e=>""!==e)),c=(e=>{let t=[];for(let r=0;r<e;r++)t.push("0000");return t.join(":")})(8-(s.length+a.length)),u=i(s);""!==u&&(u+=":");let l=i(a);return""!==l&&(l=":"+l),`${u}${c}${l}${o}`}return`${i(n.split(":"))}${o}`},Rh.collapseIPv6Number=e=>{const n=r(e);if(e.includes("/")&&(e=e.split("/")[0]),!t.Validator.IPV6_PATTERN.test(e))throw Error(t.Validator.invalidIPv6PatternMessage);let i=e.split(":").map((e=>{let t=e.replace(/^0+/,"");return""!==t?t:"0"})).join(":").replace(/((^0)?(:0){2,}|(^0)(:0){1,})/,":");return":"===i.slice(-1)?`${i}:${n}`:(i=i.replace(":0:","::"),`${i}${n}`)},Rh}var Ih,jh,Th={};function xh(){return Ih||(Ih=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hexadectetNotationToBinaryString=e.binaryStringToHexadecimalString=e.colonHexadecimalNotationToBinaryString=e.hexadecimalStringToHexadecatetString=e.hexadecimalStringToBinaryString=e.bigIntToHexadecimalString=void 0;const t=_h(),r=Ph;e.bigIntToHexadecimalString=e=>e.toString(16),e.hexadecimalStringToBinaryString=e=>BigInt(`0x${e}`).toString(2),e.hexadecimalStringToHexadecatetString=t=>{let n=e.hexadecimalStringToBinaryString(t);if(n.length>16)throw new Error("Given decimal in binary contains digits greater than an Hexadecatet");return r.leftPadWithZeroBit(n,16)},e.colonHexadecimalNotationToBinaryString=r=>t.expandIPv6Number(r).split(":").reduce(((t,r)=>t.concat(e.hexadecimalStringToHexadecatetString(r))),""),e.binaryStringToHexadecimalString=e=>BigInt(`0b${e}`).toString(16),e.hexadectetNotationToBinaryString=n=>t.expandIPv6Number(n).split(":").reduce(((t,n)=>t.concat(r.leftPadWithZeroBit(e.hexadecimalStringToBinaryString(n),16))),"")}(Th)),Th}function kh(){if(jh)return Eh;jh=1,Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.Validator=void 0;const e=Ph,t=Ph,r=_h(),n=xh(),i=xh();let o=class o{static isWithinRange(e,t,r){return e>=t&&e<=r}static isValidAsnNumber(e){let t=this.isWithinRange(e,0n,this.THIRTY_TWO_BIT_SIZE);return[t,t?[]:[o.invalidAsnRangeMessage]]}static isValid16BitAsnNumber(e){let t=o.isWithinRange(e,0n,o.SIXTEEN_BIT_SIZE);return[t,t?[]:[o.invalid16BitAsnRangeMessage]]}static isValidIPv4Number(e){e="bigint"==typeof e?e:BigInt(e);let t=this.isWithinRange(e,0n,this.THIRTY_TWO_BIT_SIZE);return t?[t,[]]:[t,[o.invalidIPv4NumberMessage]]}static isValidIPv6Number(e){let t=this.isWithinRange(e,0n,this.ONE_HUNDRED_AND_TWENTY_EIGHT_BIT_SIZE);return t?[t,[]]:[t,[o.invalidIPv6NumberMessage]]}static isValidIPv4Octet(e){let t=this.isWithinRange(e,0n,this.EIGHT_BIT_SIZE);return[t,t?[]:[o.invalidOctetRangeMessage]]}static isValidIPv6Hexadecatet(e){let t=this.isWithinRange(e,0n,this.SIXTEEN_BIT_SIZE);return t?[t,[]]:[t,[o.invalidHexadecatetMessage]]}static isValidIPv4String(e){let t=e.split(".");if(4!=t.length||t.includes(""))return[!1,[o.invalidOctetCountMessage]];let r=t.every((e=>!!o.isNumeric(e)&&o.isValidIPv4Octet(BigInt(e))[0]));return r?(r=o.IPV4_PATTERN.test(e),[r,r?[]:[o.invalidIPv4PatternMessage]]):[!1,[o.invalidOctetRangeMessage]]}static isValidIPv6String(e){try{let t=r.expandIPv6Number(e).split(":");if(8!=t.length)return[!1,[o.invalidHexadecatetCountMessage]];let n=t.every((e=>!!o.isHexadecatet(e)&&o.isValidIPv6Hexadecatet(BigInt(`0x${e}`))[0]));return n?(n=o.IPV6_PATTERN.test(e),[n,n?[]:[o.invalidIPv6PatternMessage]]):[!1,[o.invalidHexadecatetMessage]]}catch(e){return[!1,[e]]}}static isValidPrefixValue(e,t){if("IPv4"===t){let t=o.isWithinRange(BigInt(e),0n,32n);return[t,t?[]:[o.invalidPrefixValueMessage]]}if("IPv6"===t){let t=o.isWithinRange(BigInt(e),0n,128n);return[t,t?[]:[o.invalidPrefixValueMessage]]}return[!1,[o.invalidInetNumType]]}static isValidIPv4Mask(t){let r=e.dottedDecimalNotationToBinaryString(t),n=o.IPV4_CONTIGUOUS_MASK_BIT_PATTERN.test(r);return n?[n,[]]:[n,[o.invalidMaskMessage]]}static isValidIPv6Mask(e){let t=i.hexadectetNotationToBinaryString(e),r=o.IPV6_CONTIGUOUS_MASK_BIT_PATTERN.test(t);return r?[r,[]]:[r,[o.invalidMaskMessage]]}static isValidIPv4CidrNotation(e){let t=e.split("/");if(2!==t.length||0===t[0].length||0===t[1].length)return[!1,[o.invalidIPv4CidrNotationMessage]];let r=t[0],n=t[1];if(isNaN(Number(n)))return[!1,[o.invalidIPv4CidrNotationMessage]];let[i,s]=o.isValidIPv4String(r),[a,c]=o.isValidPrefixValue(BigInt(n),"IPv4"),u=i&&a,l=s.concat(c);return u?[u,[]]:[u,l]}static isValidIPv4CidrRange(r){return o.isValidCidrRange(r,o.isValidIPv4CidrNotation,e.dottedDecimalNotationToBinaryString,(e=>t.cidrPrefixToMaskBinaryString(e,"IPv4")))}static isValidIPv6CidrRange(e){return o.isValidCidrRange(e,o.isValidIPv6CidrNotation,n.colonHexadecimalNotationToBinaryString,(e=>t.cidrPrefixToMaskBinaryString(e,"IPv6")))}static isValidCidrRange(e,t,r,n){let i=t(e);if(!i[0])return i;let s=e.split("/"),a=s[0],c=s[1],u=BigInt(`0b${r(a)}`),l=(u&BigInt(`0b${n(parseInt(c))}`))===u;return l?[l,[]]:[l,[o.InvalidIPCidrRangeMessage]]}static isValidIPv4RangeString(t){return this.isValidRange(t,o.isValidIPv4String,((t,r)=>BigInt(`0b${e.dottedDecimalNotationToBinaryString(t)}`)>=BigInt(`0b${e.dottedDecimalNotationToBinaryString(r)}`)))}static isValidIPv6RangeString(e){return this.isValidRange(e,o.isValidIPv6String,((e,t)=>BigInt(`0b${i.hexadectetNotationToBinaryString(e)}`)>=BigInt(`0b${i.hexadectetNotationToBinaryString(t)}`)))}static isValidRange(e,t,r){let n=e.split("-").map((e=>e.trim()));if(2!==n.length||0===n[0].length||0===n[1].length)return[!1,[o.invalidRangeNotationMessage]];let i=n[0],s=n[1],[a,c]=t(i),[u,l]=t(s),h=a&&u;if(h&&r(i,s))return[!1,[o.invalidRangeFirstNotGreaterThanLastMessage]];let d=c.concat(l);return h?[h,[]]:[h,d]}static isValidIPv6CidrNotation(e){let t=o.IPV6_RANGE_PATTERN.test(e);return t?[t,[]]:[t,[o.invalidIPv6CidrNotationString]]}static isValidBinaryString(e){return/^([10])+$/.test(e)?[!0,[]]:[!1,[o.invalidBinaryStringErrorMessage]]}static isNumeric(e){return/^(\d+)$/.test(e)}static isHexadecatet(e){return/^[0-9A-Fa-f]{4}$/.test(e)}};return Eh.Validator=o,o.IPV4_PATTERN=new RegExp(/^(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/),o.IPV6_PATTERN=new RegExp(/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/),o.IPV4_RANGE_PATTERN=new RegExp(/^(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\.(0?[0-9]?[0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\/)([1-9]|[1-2][0-9]|3[0-2])$/),o.IPV6_RANGE_PATTERN=new RegExp(/^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*(\/([0-9]|[1-9][0-9]|1[0-1][0-9]|12[0-8]))?$/),o.IPV4_CONTIGUOUS_MASK_BIT_PATTERN=new RegExp(/^(1){0,32}(0){0,32}$/),o.IPV6_CONTIGUOUS_MASK_BIT_PATTERN=new RegExp(/^(1){0,128}(0){0,128}$/),o.EIGHT_BIT_SIZE=BigInt(`0b${"1".repeat(8)}`),o.SIXTEEN_BIT_SIZE=BigInt(`0b${"1".repeat(16)}`),o.THIRTY_TWO_BIT_SIZE=BigInt(`0b${"1".repeat(32)}`),o.ONE_HUNDRED_AND_TWENTY_EIGHT_BIT_SIZE=BigInt(`0b${"1".repeat(128)}`),o.IPV4_SIZE=BigInt("4294967296"),o.IPV6_SIZE=BigInt("340282366920938463463374607431768211456"),o.invalidAsnRangeMessage="ASN number given less than zero or is greater than 32bit",o.invalid16BitAsnRangeMessage="ASN number given less than zero or is greater than 16bit",o.invalidIPv4NumberMessage="IPv4 number given less than zero or is greater than 32bit",o.invalidIPv6NumberMessage="IPv6 number given less than zero or is greater than 128bit",o.invalidOctetRangeMessage="Value given contains an invalid Octet; Value is less than zero or is greater than 8bit",o.invalidHexadecatetMessage="The value given is less than zero or is greater than 16bit",o.invalidOctetCountMessage="An IP4 number cannot have less or greater than 4 octets",o.invalidHexadecatetCountMessage="An IP6 number must have exactly 8 hexadecatet",o.invalidMaskMessage="The Mask is invalid",o.invalidPrefixValueMessage="A Prefix value cannot be less than 0 or greater than 32",o.invalidIPv4CidrNotationMessage="Cidr notation should be in the form [ip number]/[range]",o.InvalidIPCidrRangeMessage="Given IP number portion must is not the start of the range",o.invalidRangeNotationMessage="Range notation should be in the form [first ip]-[last ip]",o.invalidRangeFirstNotGreaterThanLastMessage="First IP in [first ip]-[last ip] must be less than Last IP",o.invalidIPv6CidrNotationString="A Cidr notation string should contain an IPv6 number and prefix",o.takeOutOfRangeSizeMessage="$count is greater than $size, the size of the range",o.cannotSplitSingleRangeErrorMessage="Cannot split an IP range with a single IP number",o.invalidInetNumType="Given ipNumType must be either InetNumType.IPv4 or InetNumType.IPv6",o.invalidBinaryStringErrorMessage="Binary string should contain only contiguous 1s and 0s",o.invalidIPRangeSizeMessage="Given size is zero or greater than maximum size of $iptype",o.invalidIPRangeSizeForCidrMessage="Given size can't be created via cidr prefix",o.invalidIPv4PatternMessage="Given IPv4 is not confirm to a valid IPv6 address",o.invalidIPv6PatternMessage="Given IPv6 is not confirm to a valid IPv6 address",Eh}Object.defineProperty(Oh,"__esModule",{value:!0}),Oh.Hexadecatet=void 0;const Nh=kh();class Bh{constructor(e){let t;t="string"==typeof e?parseInt(e,16):parseInt(String(e),16);let[r,n]=Nh.Validator.isValidIPv6Hexadecatet(BigInt(t));if(!r)throw Error(n.filter((e=>""!==e)).toString());this.value=t}static fromString(e){return new Bh(e)}static fromNumber(e){return new Bh(e)}getValue(){return this.value}toString(){return this.value.toString(16)}}Oh.Hexadecatet=Bh;var Mh={},Dh={};Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.Octet=void 0;const Ch=kh();class Uh{constructor(e){let t;t="string"==typeof e?parseInt(e):e;let[r,n]=Ch.Validator.isValidIPv4Octet(BigInt(t));if(!r)throw Error(n.filter((e=>""!==e)).toString());this.value=t}static fromString(e){return new Uh(e)}static fromNumber(e){return new Uh(e)}getValue(){return this.value}toString(){return this.value.toString(10)}}Dh.Octet=Uh,Object.defineProperty(Mh,"__esModule",{value:!0}),Mh.isIPv4=Mh.IPv6Mask=Mh.IPv4Mask=Mh.IPv6=Mh.Asn=Mh.IPv4=Mh.AbstractIPNum=void 0;const Fh=Dh,Lh=kh(),qh=Ph,$h=Ph,Vh=Ph,zh=Ph,Hh=Oh,Yh=xh(),Gh=_h(),Wh=xh();class Kh{getValue(){return this.value}toBinaryString(){return Vh.leftPadWithZeroBit(this.value.toString(2),this.bitSize)}hasNext(){return this.value<this.maximumBitSize}hasPrevious(){return this.value>0n}isEquals(e){return this.value===e.value}isLessThan(e){return this.value<e.value}isGreaterThan(e){return this.value>e.value}isLessThanOrEquals(e){return this.value<=e.value}isGreaterThanOrEquals(e){return this.value>=e.value}}Mh.AbstractIPNum=Kh;class Jh extends Kh{constructor(e){if(super(),this.bitSize=32,this.maximumBitSize=Lh.Validator.THIRTY_TWO_BIT_SIZE,this.type="IPv4",this.octets=[],this.separator=".","string"==typeof e){let[t,r]=this.constructFromDecimalDottedString(e);this.value=t,this.octets=r}else{let[t,r]=this.constructFromBigIntValue(e);this.value=t,this.octets=r}}static fromNumber(e){return new Jh(e)}static fromDecimalDottedString(e){return new Jh(e)}static fromString(e){return Jh.fromDecimalDottedString(e)}static fromBinaryString(e){let t=Lh.Validator.isValidBinaryString(e);if(t[0])return new Jh($h.parseBinaryStringToBigInt(e));throw Error(t[1].join(","))}toString(){return this.octets.map((e=>e.toString())).join(this.separator)}getOctets(){return this.octets}nextIPNumber(){return Jh.fromNumber(this.getValue()+1n)}previousIPNumber(){return Jh.fromNumber(this.getValue()-1n)}toIPv4MappedIPv6(){let e="1".repeat(16)+this.toBinaryString();return Xh.fromBinaryString(e)}constructFromDecimalDottedString(e){let t,r,[n,i]=Lh.Validator.isValidIPv4String(e);if(!n)throw new Error(i.filter((e=>""!==e)).toString());return t=e.split(".").map((e=>Fh.Octet.fromString(e))),r=BigInt(`0b${qh.dottedDecimalNotationToBinaryString(e)}`),[r,t]}constructFromBigIntValue(e){let[t,r]=Lh.Validator.isValidIPv4Number(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let n=zh.numberToBinaryString(e);return[e="bigint"==typeof e?e:BigInt(e),this.binaryStringToDecimalOctets(n)]}binaryStringToDecimalOctets(e){return e.length<32&&(e=Vh.leftPadWithZeroBit(e,32)),e.match(/.{1,8}/g).map((e=>Fh.Octet.fromString($h.parseBinaryStringToBigInt(e).toString())))}}Mh.IPv4=Jh;class Zh extends Kh{constructor(e){if(super(),this.bitSize=32,this.maximumBitSize=Lh.Validator.THIRTY_TWO_BIT_SIZE,this.type="ASN","string"==typeof e)Zh.startWithASPrefix(e)?this.value=BigInt(parseInt(e.substring(2))):-1!=e.indexOf(".")?this.value=BigInt(this.parseFromDotNotation(e)):this.value=BigInt(parseInt(e));else{let t=BigInt(e),[r,n]=Lh.Validator.isValidAsnNumber(t);if(!r)throw Error(n.filter((e=>""!==e)).toString());this.value=t}}static fromString(e){return new Zh(e)}static fromNumber(e){return new Zh(e)}static fromBinaryString(e){let t=Lh.Validator.isValidBinaryString(e);if(t[0])return new Zh(parseInt(e,2));throw Error(t[1].join(","))}toString(){let e=this.value.toString();return`${Zh.AS_PREFIX}${e}`}toASPlain(){return this.value.toString()}toASDot(){return this.value.valueOf()>=65536n?this.toASDotPlus():this.toASPlain()}toASDotPlus(){let e=this.value.valueOf()/65535n;return`${e}.${this.value.valueOf()%65535n-e}`}toBinaryString(){return zh.numberToBinaryString(this.value)}is16Bit(){let[e]=Lh.Validator.isValid16BitAsnNumber(this.value);return e}is32Bit(){return!this.is16Bit()}nextIPNumber(){return new Zh(this.value.valueOf()+1n)}previousIPNumber(){return new Zh(this.value.valueOf()-1n)}static startWithASPrefix(e){return 0===e.indexOf(Zh.AS_PREFIX)}parseFromDotNotation(e){let t=e.split("."),r=parseInt(t[0]);return 65535*r+(parseInt(t[1])+r)}}Mh.Asn=Zh,Zh.AS_PREFIX="AS";class Xh extends Kh{constructor(e){if(super(),this.bitSize=128,this.maximumBitSize=Lh.Validator.ONE_HUNDRED_AND_TWENTY_EIGHT_BIT_SIZE,this.type="IPv6",this.hexadecatet=[],this.separator=":","string"==typeof e){let t=Gh.expandIPv6Number(e),[r,n]=this.constructFromHexadecimalDottedString(t);this.value=r,this.hexadecatet=n}else{let[t,r]=this.constructFromBigIntValue(e);this.value=t,this.hexadecatet=r}}static fromBigInt(e){return new Xh(e)}static fromHexadecatet(e){return new Xh(e)}static fromString(e){return Xh.fromHexadecatet(e)}static fromBinaryString(e){let t=Lh.Validator.isValidBinaryString(e);if(t[0]){let t=Vh.leftPadWithZeroBit(e,128);return new Xh($h.parseBinaryStringToBigInt(t))}throw Error(t[1].join(","))}static fromIPv4(e){return e.toIPv4MappedIPv6()}static fromIPv4DotDecimalString(e){return new Jh(e).toIPv4MappedIPv6()}toString(){let e=this.hexadecatet.map((e=>e.toString())).join(":");return this.hexadecatet.length<8?"::"+e:e}getHexadecatet(){return this.hexadecatet}nextIPNumber(){return Xh.fromBigInt(this.getValue()+1n)}previousIPNumber(){return Xh.fromBigInt(this.getValue()-1n)}constructFromBigIntValue(e){let[t,r]=Lh.Validator.isValidIPv6Number(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let n=zh.numberToBinaryString(e);return[e,this.binaryStringToHexadecatets(n)]}constructFromHexadecimalDottedString(e){let[t,r]=Lh.Validator.isValidIPv6String(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let n=e.split(":").map((e=>Hh.Hexadecatet.fromString(e)));return[BigInt(`0b${Wh.hexadectetNotationToBinaryString(e)}`),n]}binaryStringToHexadecatets(e){let t=Yh.binaryStringToHexadecimalString(e);for(;t.length%4!=0;)t="0"+t;return t.match(/.{1,4}/g).map((e=>Hh.Hexadecatet.fromString(e)))}}Mh.IPv6=Xh;class Qh extends Jh{constructor(e){let t,r;if(super(e),this.octets=[],[t,r]=Lh.Validator.isValidIPv4Mask(e),!t)throw new Error(r.filter((e=>""!==e)).toString());let n=e.split(".");this.octets=n.map((e=>Fh.Octet.fromString(e)));let i=qh.dottedDecimalNotationToBinaryString(e);this.prefix=(i.match(/1/g)||[]).length,this.value=BigInt(`0b${i}`)}static fromDecimalDottedString(e){return new Qh(e)}}Mh.IPv4Mask=Qh;class ed extends Xh{constructor(e){let t,r;super(e),this.hexadecatet=[];let n=Gh.expandIPv6Number(e);if([t,r]=Lh.Validator.isValidIPv6Mask(n),!t)throw new Error(r.filter((e=>""!==e)).toString());let i=n.split(":");this.hexadecatet=i.map((e=>Hh.Hexadecatet.fromString(e)));let o=Wh.hexadectetNotationToBinaryString(n);this.prefix=(o.match(/1/g)||[]).length,this.value=BigInt(`0b${o}`),this.value=BigInt(`0b${Wh.hexadectetNotationToBinaryString(n)}`)}static fromHexadecatet(e){return new ed(e)}}Mh.IPv6Mask=ed,Mh.isIPv4=function(e){return 32===e.bitSize};var td={};Object.defineProperty(td,"__esModule",{value:!0});var rd={},nd={},id={};Object.defineProperty(id,"__esModule",{value:!0}),id.isIPv4Prefix=id.IPv6Prefix=id.IPv4Prefix=void 0;const od=kh(),sd=Mh,ad=Ph,cd=xh(),ud=Oh;class ld{constructor(e){let t,r;if(this.type="IPv4",this.bitValue=32n,[t,r]=od.Validator.isValidPrefixValue(e,"IPv4"),!t)throw new Error(r.filter((e=>""!==e)).toString());this.value=e}static fromNumber(e){return new ld(e)}static fromRangeSize(e){let t=1n===e?32:32-dd(e,od.Validator.IPV4_SIZE);return ld.fromNumber(BigInt(t))}getValue(){return this.value}toString(){return this.value.toString()}toMask(){let e="1".repeat(Number(this.value)),t="0".repeat(Number(32n-this.value));return sd.IPv4Mask.fromDecimalDottedString(this.toDecimalNotation(`${e}${t}`))}toRangeSize(){return 1n<<this.bitValue-this.getValue()}merge(){return new ld(this.value-1n)}split(){return new ld(this.value+1n)}toDecimalNotation(e){return`${ad.parseBinaryStringToBigInt(e.substr(0,8))}.${ad.parseBinaryStringToBigInt(e.substr(8,8))}.${ad.parseBinaryStringToBigInt(e.substr(16,8))}.${ad.parseBinaryStringToBigInt(e.substr(24,8))}`}}id.IPv4Prefix=ld;class hd{constructor(e){let t,r;if(this.type="IPv6",this.bitValue=128n,[t,r]=od.Validator.isValidPrefixValue(e,"IPv6"),!t)throw new Error(r.filter((e=>""!==e)).toString());this.value=e}static fromNumber(e){return new hd(e)}static fromRangeSize(e){let t=1n===e?128:128-dd(e,od.Validator.IPV6_SIZE);return hd.fromNumber(BigInt(t))}getValue(){return this.value}toString(){return this.value.toString()}toMask(){let e="1".repeat(Number(this.value)),t="0".repeat(128-Number(this.value));return sd.IPv6Mask.fromHexadecatet(this.toHexadecatetNotation(`${e}${t}`))}toRangeSize(){return 1n<<this.bitValue-this.getValue()}merge(){return new hd(this.value-1n)}split(){return new hd(this.value+1n)}toHexadecatetNotation(e){return e.match(/.{1,16}/g).map((e=>ud.Hexadecatet.fromString(cd.binaryStringToHexadecimalString(e)))).map((e=>e.toString())).join(":")}}function dd(e,t){let r=t>od.Validator.IPV4_SIZE?"IPv6":"IPv4";if(e>t||0n===e)throw new Error(od.Validator.invalidIPRangeSizeMessage.replace("$iptype",r));try{return ad.intLog2(e)}catch(e){throw new Error(od.Validator.invalidIPRangeSizeForCidrMessage)}}id.IPv6Prefix=hd,id.isIPv4Prefix=function(e){return"IPv4"===e.type},Object.defineProperty(nd,"__esModule",{value:!0}),nd.isIPv4CidrRange=nd.IPv6CidrRange=nd.IPv4CidrRange=nd.AbstractIPRange=nd.RangedSet=void 0;const fd=Mh,pd=id,gd=Ph,md=kh();class vd{constructor(e,t){if(this.first=e,this.last=t,e.isGreaterThan(t))throw new Error(`${e.toString()} should be lower than ${t.toString()}`);this.currentValue=e,this.bitValue=BigInt(e.bitSize)}static fromSingleIP(e){return new vd(e,e)}static fromCidrRange(e){return new vd(e.getFirst(),e.getLast())}static fromRangeString(e){let t=e.split("-").map((e=>e.trim()));if(2!==t.length)throw new Error("Argument should be in the format firstip-lastip");let[r,n]=t,[i]=md.Validator.isValidIPv4String(r),[o]=md.Validator.isValidIPv4String(n),[s]=md.Validator.isValidIPv6String(r),[a]=md.Validator.isValidIPv6String(n);if(i&&o)return new vd(fd.IPv4.fromDecimalDottedString(r),fd.IPv4.fromDecimalDottedString(n));if(s&&a)return new vd(fd.IPv6.fromHexadecatet(r),fd.IPv6.fromHexadecatet(n));throw new Error("First IP and Last IP should be valid and same type")}getFirst(){return this.first}getLast(){return this.last}getSize(){return this.last.getValue()-this.first.getValue()+1n}toRangeString(){return`${this.getFirst()}-${this.getLast()}`}inside(e){return e.contains(this)}contains(e){let t=this.getFirst(),r=this.getLast(),n=e.getFirst(),i=e.getLast();return t.isLessThanOrEquals(n)&&r.isGreaterThanOrEquals(i)}isEquals(e){return this.getFirst().isEquals(e.getFirst())&&this.getLast().isEquals(e.getLast())}isLessThan(e){return!this.isEquals(e)&&(this.getFirst().isEquals(e.getFirst())?this.getSize()<e.getSize():this.getFirst().isLessThan(e.getFirst()))}isGreaterThan(e){return!this.isEquals(e)&&(this.getFirst().isEquals(e.getFirst())?this.getSize()>e.getSize():this.getFirst().isGreaterThan(e.getFirst()))}isOverlapping(e){let t=this.getFirst(),r=this.getLast(),n=e.getFirst(),i=e.getLast();return r.isGreaterThan(n)&&r.isLessThanOrEquals(i)&&t.isLessThan(n)||i.isGreaterThan(t)&&i.isLessThanOrEquals(r)&&n.isLessThan(t)}isCidrAble(){if(1n===this.getSize())return!0;try{let e=gd.intLog2(this.getSize()),t=gd.parseBinaryStringToBigInt(gd.cidrPrefixToMaskBinaryString(e,fd.isIPv4(this.currentValue)?"IPv4":"IPv6"));return this.first.getValue()===(t&this.first.getValue())}catch(e){return!1}}toCidrRange(){return fd.isIPv4(this.currentValue)?this.toIPv4CidrRange():this.toIPv6CidrRange()}isConsecutive(e){let t=this.getFirst(),r=this.getLast(),n=e.getFirst(),i=e.getLast();return r.hasNext()&&r.nextIPNumber().isEquals(n)||i.hasNext()&&i.nextIPNumber().isEquals(t)}union(e){if(this.isEquals(e))return new vd(e.getFirst(),e.getLast());if(this.isOverlapping(e))return this.getFirst().isLessThan(e.getFirst())?new vd(this.getFirst(),e.getLast()):new vd(e.getFirst(),this.getLast());if(this.contains(e))return new vd(this.getFirst(),this.getLast());if(e.contains(this))return new vd(e.getFirst(),e.getLast());throw new Error("Ranges do not overlap nor are equal")}prepend(e){if(e.getLast().nextIPNumber().isEquals(this.getFirst()))return new vd(e.getFirst(),this.getLast());throw new Error("Range to prepend must be adjacent")}append(e){if(this.getLast().nextIPNumber().isEquals(e.getFirst()))return new vd(this.getFirst(),e.getLast());throw new Error("Range to append must be adjacent")}subtract(e){if(!this.isOverlapping(e))throw new Error("Cannot subtract ranges that are not overlapping");if(!this.isLessThan(e))throw new Error("Cannot subtract a larger range from this range");return new vd(this.getFirst(),e.getLast())}takeSubRange(e,t){if(e+t>this.getSize())throw new RangeError("Requested range is greater than what can be taken");if(0n===t)throw new Error("Sub range cannot be zero");let r=this.getFirst().value+e,n=fd.isIPv4(this.getFirst())?fd.IPv4.fromNumber(r):fd.IPv6.fromBigInt(r),i=n.value+(t-1n),o=fd.isIPv4(n)?fd.IPv4.fromNumber(i):fd.IPv6.fromBigInt(i);return new vd(n,o)}difference(e){if(e.getSize()>this.getSize())throw new Error("Range is greater than range to be subtracted from");if(!this.contains(e))throw new Error("Range to subtract is not contained in this range");let t=[];try{t.push(new vd(this.getFirst(),e.getFirst().previousIPNumber()))}catch(e){}try{t.push(new vd(e.getLast().nextIPNumber(),this.getLast()))}catch(e){}return t}*take(e){let t=this.getFirst(),r=void 0===e?this.getSize().valueOf():e;for(;r>0;)r--,yield t,t=t.nextIPNumber()}*[Symbol.iterator](){yield*this.take()}toIPv4CidrRange(){let e=new bd(fd.IPv4.fromNumber(this.getFirst().getValue()),pd.IPv4Prefix.fromRangeSize(this.getSize()));if(e.getFirst().isEquals(this.getFirst()))return e;throw new Error("Range cannot be converted to CIDR")}toIPv6CidrRange(){let e=new wd(fd.IPv6.fromBigInt(this.getFirst().getValue()),pd.IPv6Prefix.fromRangeSize(this.getSize()));if(e.getFirst().isEquals(this.getFirst()))return e;throw new Error("Range cannot be converted to CIDR")}}nd.RangedSet=vd;class yd{hasNextRange(){let e=this.getSize();return 2n**this.bitValue-e>=this.getFirst().getValue()+e}hasPreviousRange(){return this.getSize()<=this.getFirst().getValue()}toRangeSet(){return new vd(this.getFirst(),this.getLast())}inside(e){return this.toRangeSet().inside(e.toRangeSet())}contains(e){return this.toRangeSet().contains(e.toRangeSet())}toRangeString(){return this.toRangeSet().toRangeString()}isOverlapping(e){return this.toRangeSet().isOverlapping(e.toRangeSet())}isConsecutive(e){return this.toRangeSet().isConsecutive(e.toRangeSet())}isCidrMergeable(e){const t=BigInt(gd.matchingBitCount(this.getFirst().toBinaryString(),e.getFirst().toBinaryString()));return this.getPrefix().value-t===1n&&(this.isConsecutive(e)&&this.getSize()===e.getSize())}isMergeable(e){return this.isCidrMergeable(e)||this.contains(e)||this.inside(e)}isEquals(e){return this.toRangeSet().isEquals(e.toRangeSet())}merge(e){if(!this.isCidrMergeable(e))throw new Error(`Cannot merge. Ranges (${this.toRangeString()},${e.toRangeString()}) are not consecutive and/or of same size`);return this.newInstance(this.getFirst(),this.getPrefix().merge())}*takeStream(e){return this.toRangeSet().take(e)}*[Symbol.iterator](){yield*this.toRangeSet()}}nd.AbstractIPRange=yd;class bd extends yd{constructor(e,t){super(),this.ipv4=e,this.cidrPrefix=t,this.bitValue=32n}static fromCidr(e){let[t,r]=md.Validator.isValidIPv4CidrNotation(e);if(!t){let e=r.filter((e=>""!==e));throw new Error(e.join(" and "))}let n=e.split("/"),i=n[0],o=BigInt(parseInt(n[1]));return new bd(fd.IPv4.fromDecimalDottedString(i),pd.IPv4Prefix.fromNumber(o))}getSize(){return this.cidrPrefix.toRangeSize()}toCidrString(){return`${this.ipv4.toString().toString()}/${this.cidrPrefix.toString()}`}toRangeString(){return super.toRangeString()}getFirst(){return fd.IPv4.fromNumber(this.ipv4.getValue()&this.cidrPrefix.toMask().getValue())}getLast(){return Sd(this,this.ipv4)}newInstance(e,t){return new bd(e,t)}getPrefix(){return this.cidrPrefix}isConsecutive(e){return super.isConsecutive(e)}contains(e){return super.contains(e)}inside(e){return super.inside(e)}isOverlapping(e){return super.isOverlapping(e)}take(e){let t=[this.getFirst()],r=this.getFirst();if(e>this.getSize()){let t=md.Validator.takeOutOfRangeSizeMessage.replace("$count",e.toString()).replace("$size",this.getSize().toString());throw new Error(t)}for(let n=0;n<e-1n;n++)t.push(r.nextIPNumber()),r=r.nextIPNumber();return t}split(){let e=this.cidrPrefix.getValue();if(32n===e)throw new Error("Cannot split an IP range with a single IP number");let t=pd.IPv4Prefix.fromNumber(e+1n),r=this.getFirst(),n=new bd(r,t),i=n.getLast().nextIPNumber();return[n,new bd(i,t)]}splitInto(e){let t=e.getValue()-this.cidrPrefix.getValue();if(t<0)throw new Error("Prefix to split into is larger than source prefix");if(0n===t)return[new bd(this.getFirst(),e)];if(1n===t)return this.split();{let e=this.split();for(;t>1;)e=e.flatMap((e=>e.split())),t-=1n;return e}}hasNextRange(){return super.hasNextRange()}hasPreviousRange(){return super.hasPreviousRange()}nextRange(){if(this.hasNextRange()){let e=this.getSize(),t=this.getFirst().getValue()+e;return new bd(new fd.IPv4(t),this.cidrPrefix)}}previousRange(){if(this.hasPreviousRange()){let e=this.getSize(),t=this.getFirst().getValue()-e;return new bd(new fd.IPv4(t),this.cidrPrefix)}}}nd.IPv4CidrRange=bd;class wd extends yd{constructor(e,t){super(),this.ipv6=e,this.cidrPrefix=t,this.bitValue=128n}static fromCidr(e){let[t,r]=md.Validator.isValidIPv6CidrNotation(e);if(!t)throw new Error(r.filter((e=>""!==e)).toString());let n=e.split("/"),i=n[0],o=BigInt(parseInt(n[1]));return new wd(fd.IPv6.fromHexadecatet(i),pd.IPv6Prefix.fromNumber(o))}getSize(){return this.cidrPrefix.toRangeSize()}toCidrString(){return`${this.ipv6.toString().toString()}/${this.cidrPrefix.toString()}`}toRangeString(){return super.toRangeString()}getFirst(){return fd.IPv6.fromBigInt(this.ipv6.getValue()&this.cidrPrefix.toMask().getValue())}getLast(){return Sd(this,this.ipv6)}newInstance(e,t){return new wd(e,t)}getPrefix(){return this.cidrPrefix}isConsecutive(e){return super.isConsecutive(e)}contains(e){return super.contains(e)}inside(e){return super.inside(e)}isOverlapping(e){return super.isOverlapping(e)}take(e){let t=[this.getFirst()],r=this.getFirst();if(e>this.getSize())throw new Error(`${e.toString()} is greater than ${this.getSize().toString()}, the size of the range`);for(var n=0;n<e-1n;n++)t.push(r.nextIPNumber()),r=r.nextIPNumber();return t}split(){let e=this.cidrPrefix.getValue();if(128n===e)throw new Error("Cannot split an IP range with a single IP number");let t=pd.IPv6Prefix.fromNumber(e+1n),r=this.getFirst(),n=new wd(r,t),i=n.getLast().nextIPNumber();return[n,new wd(i,t)]}splitInto(e){let t=e.getValue()-this.cidrPrefix.getValue();if(t<0)throw new Error("Prefix to split into is larger than source prefix");if(0n===t)return[new wd(this.getFirst(),e)];if(1n===t)return this.split();{let e=this.split();for(;t>1;)e=e.flatMap((e=>e.split())),t-=1n;return e}}hasNextRange(){return super.hasNextRange()}hasPreviousRange(){return super.hasPreviousRange()}nextRange(){if(this.hasNextRange()){let e=this.getSize(),t=this.getFirst().getValue()+e;return new wd(new fd.IPv6(t),this.cidrPrefix)}}previousRange(){if(this.hasPreviousRange()){let e=this.getSize(),t=this.getFirst().getValue()-e;return new wd(new fd.IPv6(t),this.cidrPrefix)}}}nd.IPv6CidrRange=wd;let Sd=(e,t)=>{let r=Number(e.bitValue.valueOf()),n=BigInt(`0b${"1".repeat(r)}`),i=e.cidrPrefix.toMask().getValue(),o=gd.leftPadWithZeroBit((i^n).toString(2),r);return Pd(e)?fd.IPv4.fromNumber(t.getValue()|gd.parseBinaryStringToBigInt(o)):fd.IPv6.fromBigInt(t.getValue()|gd.parseBinaryStringToBigInt(o))};function Pd(e){return 32n===e.bitValue.valueOf()}nd.isIPv4CidrRange=Pd,Object.defineProperty(rd,"__esModule",{value:!0}),rd.Pool=void 0;const Ad=nd,Od=id;class Ed{constructor(e){this.backingSet=new Rd,e.forEach((e=>{this.backingSet.add(e)}))}static fromIP(e){let t=e.map((e=>Ad.RangedSet.fromSingleIP(e)));return new Ed(t)}static fromRangeSet(e){return new Ed(e)}static fromCidrRanges(e){let t=e.map((e=>e.toRangeSet()));return new Ed(t)}getRanges(){return this.backingSet.asArray()}aggregate(){let e=this.backingSet.asArray().reduce(((e,t,r,n)=>{if(0==e.length)return e.push(t),e;{let r=e.pop(),n=r.toCidrRange(),i=t.toCidrRange();if(n.isCidrMergeable(i)){let t=n.merge(i);return e.push(t.toRangeSet()),e}return r.contains(t)?e.push(r):(e.push(r),e.push(t)),e}}),[]),t=Ed.fromRangeSet(e);return t.getRanges().length!==this.getRanges().length?t.aggregate():t}getCidrRange(e){if(e.toRangeSize()>this.getSize())throw new Error(`Not enough IP number in the pool for requested prefix: ${e}`);let t,r;e:for(let n of this.getRanges())for(let i=0n;i+e.toRangeSize()<=n.getSize();i+=1n)try{let r=n.takeSubRange(i,e.toRangeSize());t=r.toCidrRange();let o=n.difference(r);this.removeExact(n),this.add(o);break e}catch(e){if(e instanceof RangeError)continue e;r=e}if(t)return t;throw void 0===r?new Error(`No range big enough in the pool for requested prefix: ${e}`):r}getCidrRanges(e){if(e.toRangeSize()>this.getSize())throw new Error("Prefix greater than pool");let t=(e,r,n)=>{try{let i=this.getCidrRange(r);n.push(i);let o=n.reduce(((e,t)=>e+t.getSize()),0n);return e.toRangeSize()===o?n:t(e,r,n)}catch(i){let o=Od.isIPv4Prefix(r)?Od.IPv4Prefix.fromNumber(r.getValue()+1n):Od.IPv6Prefix.fromNumber(r.getValue()+1n);return t(e,o,n)}};return t(e,e,[])}getSize(){return this.aggregate().getRanges().reduce(((e,t)=>e+t.getSize()),0n)}resetWith(e){this.backingSet.clear(),this.backingSet=this.backingSet.add(e)}removeExact(e){let t=this.backingSet.removeExact(e),r=!this.backingSet.isEquals(t);return this.backingSet=t,r}removeOverlapping(e){let t=this.backingSet.removeOverlapping(e),r=!this.backingSet.isEquals(t);return this.backingSet=t,r}add(e){this.backingSet=this.backingSet.add(e)}clear(){this.backingSet.clear()}}rd.Pool=Ed;class Rd{constructor(e){this.backingArray=e?this.sortArray(e):new Array}sortArray(e){return e.sort(((e,t)=>e.isLessThan(t)?-1:e.isGreaterThan(t)?1:0)),e}asArray(){return this.backingArray}isEquals(e){return this.backingArray.length===e.asArray().length&&this.backingArray.every(((t,r)=>t.getSize()===e.asArray()[r].getSize()))}add(e){let t=this.backingArray;return"push"in e?t=t.concat(e):t.push(e),new Rd(this.sortArray(t))}removeExact(e){let t=this.backingArray.filter((t=>"push"in e?void 0!==e.find((e=>e.isEquals(t))):!e.isEquals(t)));return new Rd(this.sortArray(t))}removeOverlapping(e){let t=this.backingArray.flatMap((t=>{if("push"in e)return e.flatMap((e=>t.contains(e)?t.difference(e):t.inside(e)?new Array:t.isOverlapping(e)?[t.subtract(e)]:[e]));try{return t.difference(e)}catch(e){return t}}));return new Rd(this.sortArray(t))}clear(){this.backingArray=[]}}!function(e){var t=nr&&nr.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=nr&&nr.__exportStar||function(e,r){for(var n in e)"default"===n||r.hasOwnProperty(n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),r(Ph,e),r(Oh,e),r(xh(),e),r(Mh,e),r(td,e),r(rd,e),r(nd,e),r(_h(),e),r(Dh,e),r(id,e),r(kh(),e)}(Sh);const _d="http://127.0.0.1:7465",Id="192.168.0.0/24";class jd{api;mask;ip;ownerId;ownerIp;gateway;logger;apiUrl;constructor(e){const t=e?.yagnaOptions?.apiKey||process.env.YAGNA_APPKEY;if(!t)throw new Error("Api key not defined");const r=e?.yagnaOptions?.basePath||process.env.YAGNA_API_URL||_d;this.apiUrl=`${r}/net-api/v1`;const n=new rh.Configuration({apiKey:t,basePath:this.apiUrl,accessToken:t});this.api=new sl.RequestorApi(n),this.ip=e?.networkIp||Id,this.mask=e?.networkMask,this.ownerId=e.networkOwnerId,this.ownerIp=e?.networkOwnerIp,this.gateway=e?.networkGateway,this.logger=e?.logger}}class Td{id;ip;getNetworkInfo;apiUrl;constructor(e,t,r,n){this.id=e,this.ip=t,this.getNetworkInfo=r,this.apiUrl=n}getNetworkConfig(){return{net:[{...this.getNetworkInfo(),nodeIp:this.ip.toString()}]}}getWebsocketUri(e){const t=new URL(this.apiUrl);return t.protocol="ws",`${t.href}/net/${this.getNetworkInfo().id}/tcp/${this.ip}/${e}`}}class xd extends Error{}class kd{id;config;ip;ipRange;ipIterator;mask;ownerId;ownerIp;gateway;nodes=new Map;logger;static async create(e){const t=new jd(e);try{const{data:{id:e,ip:r,mask:n}}=await t.api.createNetwork({id:t.ownerId,ip:t.ip,mask:t.mask,gateway:t.gateway}),i=new kd(e,t);return await i.addNode(i.ownerId,i.ownerIp.toString()).catch((async r=>{throw await t.api.removeNetwork(e),r})),t.logger?.info(`Network created: ID: ${e}, IP: ${r}, Mask: ${n}`),i}catch(e){throw new Error(`Unable to create network. ${e?.response?.data?.message||e}`)}}constructor(e,t){this.id=e,this.config=t,this.ipRange=Sh.IPv4CidrRange.fromCidr(t.mask?`${t.ip}/${t.mask}`:t.ip),this.ipIterator=this.ipRange[Symbol.iterator](),this.ip=this.nextAddress(),this.mask=this.ipRange.getPrefix().toMask(),this.ownerId=t.ownerId,this.ownerIp=t.ownerIp?new Sh.IPv4(t.ownerIp):this.nextAddress(),this.gateway=t.gateway?new Sh.IPv4(t.gateway):void 0,this.logger=t.logger}getNetworkInfo(){return{id:this.id,ip:this.ip.toString(),mask:this.mask.toString(),nodes:Object.fromEntries(Array.from(this.nodes).map((([e,t])=>[t.ip.toString(),e])))}}async addNode(e,t){let r;if(this.ensureIdUnique(e),t)r=Sh.IPv4.fromString(t),this.ensureIpInNetwork(r),this.ensureIpUnique(r);else for(;r=this.nextAddress(),!this.isIpUnique(r););const n=new Td(e,r,this.getNetworkInfo.bind(this),this.getUrl());return this.nodes.set(e,n),await this.config.api.addNode(this.id,{id:e,ip:r.toString()}),this.logger?.debug(`Node has added to the network. ID: ${e}, IP: ${r.toString()}`),n}async remove(){try{await this.config.api.removeNetwork(this.id)}catch(e){return 404===e.status&&this.logger?.warn(`Tried removing a network which doesn't exist. Network ID: ${this.id}`),!1}return this.logger?.info(`Network has removed: ID: ${this.id}, IP: ${this.ip}`),!0}nextAddress(){const e=this.ipIterator.next().value;if(!e)throw new Error(`No more addresses available in ${this.ipRange.toCidrString()}`);return e}ensureIpInNetwork(e){if(!this.ipRange.contains(new Sh.IPv4CidrRange(e,new Sh.IPv4Prefix(BigInt(this.mask.prefix)))))throw new xd(`The given IP ('${e.toString()}') address must belong to the network ('${this.ipRange.toCidrString()}').`);return!0}ensureIpUnique(e){if(!this.isIpUnique(e))throw new xd(`IP '${e.toString()}' has already been assigned in this network.`)}ensureIdUnique(e){if(this.nodes.has(e))throw new xd(`ID '${e}' has already been assigned in this network.`)}isIpUnique(e){for(const t of this.nodes.values())if(t.ip.isEquals(e))return!1;return!0}getUrl(){return this.config.apiUrl}}class Nd{options;network;logger;constructor(e){this.options=e,this.logger=e?.logger}async run(e){e||(e=await(async e=>{const t=e?.yagnaOptions?.apiKey||process.env.YAGNA_APPKEY;if(!t)throw new Error("Api key not defined");const r=`${e?.yagnaOptions?.basePath||process.env.YAGNA_API_URL||"http://127.0.0.1:7465"}/me`,{data:{identity:n}}=await Dt.get(r,{headers:{authorization:`Bearer ${t}`}});return n})(this.options)),this.network=await kd.create({...this.options,networkOwnerId:e}),this.logger?.debug("Network Service has started")}async addNode(e,t){if(!this.network)throw new Error("The service is not started and the network does not exist");return this.network.addNode(e,t)}async end(){await(this.network?.remove()),await(this.logger?.debug("Network Service has been stopped"))}}const Bd={budget:1,subnetTag:"public",logLevel:"info",basePath:"http://127.0.0.1:7465",payment:{driver:"erc20",network:"rinkeby"},maxParallelTasks:5,taskTimeout:18e4};class Md{package;maxParallelTasks;taskTimeout;budget;strategy;subnetTag;payment;networkIp;packageOptions;logLevel;yagnaOptions;logger;eventTarget;constructor(e){const t=qt?{env:{YAGNA_APPKEY:null,YAGNA_API_URL:null,YAGNA_SUBNET:null}}:process;Object.keys(e).forEach((t=>this[t]=e[t])),this.activityExecuteTimeout=e.taskTimeout;const r=e?.yagnaOptions?.apiKey||t.env.YAGNA_APPKEY;if(!r)throw new Error("Api key not defined");this.yagnaOptions={apiKey:r,basePath:e.yagnaOptions?.basePath||t.env.YAGNA_API_URL||Bd.basePath},this.package=e.package,this.budget=e.budget||Bd.budget,this.maxParallelTasks=e.maxParallelTasks||Bd.maxParallelTasks,this.taskTimeout=e.taskTimeout||Bd.taskTimeout,this.subnetTag=e.subnetTag||t.env?.YAGNA_SUBNET||Bd.subnetTag,this.payment={driver:e.payment?.driver||Bd.payment.driver,network:e.payment?.network||Bd.payment.network},this.networkIp=e.networkIp,this.packageOptions={engine:e.engine,minMemGib:e.minMemGib,minStorageGib:e.minStorageGib,minCpuThreads:e.minCpuThreads,capabilities:e.capabilities,repoUrl:e.repoUrl},this.logger=e.logger||(qt?void 0:Ft),this.logLevel=e.logLevel||Bd.logLevel,this.logger?.setLevel&&this.logger?.setLevel(this.logLevel),this.eventTarget=e.eventTarget||new EventTarget}}var Dd={},Cd=function(){var e=this,t=-1;return{next:function(){return t+=1,{value:e.items[t],done:t>=e.items.length}}}},Ud=function(){return this.items};function Fd(e){return Fd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fd(e)}var Ld={isArray:function(e){return Array.isArray(e)},isObject:function(e){return"object"===Fd(e)&&!1===Array.isArray(e)&&null!==e},isFunction:function(e){return"function"==typeof e}},qd=Ld.isFunction,$d=function(e){return void 0===e?this.sum()/this.items.length:qd(e)?new this.constructor(this.items).sum(e)/this.items.length:new this.constructor(this.items).pluck(e).sum()/this.items.length},Vd=$d;function zd(e){return zd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zd(e)}var Hd=function(e){var t=this,r=[],n=0;if(Array.isArray(this.items))do{var i=this.items.slice(n,n+e),o=new this.constructor(i);r.push(o),n+=e}while(n<this.items.length);else if("object"===zd(this.items)){var s=Object.keys(this.items),a=function(){var i=s.slice(n,n+e),o=new t.constructor({});i.forEach((function(e){return o.put(e,t.items[e])})),r.push(o),n+=e};do{a()}while(n<s.length)}else r.push(new this.constructor([this.items]));return new this.constructor(r)};function Yd(e){return function(e){if(Array.isArray(e))return Gd(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Gd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gd(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gd(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Wd=function(){var e;return new this.constructor((e=[]).concat.apply(e,Yd(this.items)))};function Kd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Jd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Jd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jd(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Zd(e){return Zd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zd(e)}var Xd=function(e){var t=this,r=e;r instanceof this.constructor&&(r=e.all());var n={};if(Array.isArray(this.items)&&Array.isArray(r))this.items.forEach((function(e,t){n[e]=r[t]}));else if("object"===Zd(this.items)&&"object"===Zd(r))Object.keys(this.items).forEach((function(e,i){n[t.items[e]]=r[Object.keys(r)[i]]}));else if(Array.isArray(this.items))n[this.items[0]]=r;else if("string"==typeof this.items&&Array.isArray(r)){var i=Kd(r,1);n[this.items]=i[0]}else"string"==typeof this.items&&(n[this.items]=r);return new this.constructor(n)};function Qd(e){return function(e){if(Array.isArray(e))return ef(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ef(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ef(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ef(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var tf=function(e){var t,r;Array.isArray(e)?(r=t=[]).push.apply(r,Qd(e)):(t={},Object.keys(e).forEach((function(r){t[r]=e[r]})));return t};function rf(e){return rf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rf(e)}var nf=tf,of=function(e){var t=e;e instanceof this.constructor?t=e.all():"object"===rf(e)&&(t=[],Object.keys(e).forEach((function(r){t.push(e[r])})));var r=nf(this.items);return t.forEach((function(e){"object"===rf(e)?Object.keys(e).forEach((function(t){return r.push(e[t])})):r.push(e)})),new this.constructor(r)};function sf(e){return function(e){if(Array.isArray(e))return af(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return af(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return af(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function af(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var cf=function(e){var t=[];return Array.isArray(e)?t.push.apply(t,sf(e)):"Collection"===e.constructor.name?t.push.apply(t,sf(e.all())):Object.keys(e).forEach((function(r){return t.push(e[r])})),t};function uf(e){return function(e){if(Array.isArray(e))return lf(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return lf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lf(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var hf=cf,df=Ld.isFunction,ff=function(e,t){if(void 0!==t)return Array.isArray(this.items)?this.items.filter((function(r){return void 0!==r[e]&&r[e]===t})).length>0:void 0!==this.items[e]&&this.items[e]===t;if(df(e))return this.items.filter((function(t,r){return e(t,r)})).length>0;if(Array.isArray(this.items))return-1!==this.items.indexOf(e);var r=hf(this.items);return r.push.apply(r,uf(Object.keys(this.items))),-1!==r.indexOf(e)},pf=function(){return 1===this.count()},gf=function(){var e=0;return Array.isArray(this.items)&&(e=this.items.length),Math.max(Object.keys(this.items).length,e)},mf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return new this.constructor(this.items).groupBy(e).map((function(e){return e.count()}))},vf=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new this.constructor(function e(t,r,n){var i=n[0];i instanceof r&&(i=i.all());for(var o=n.slice(1),s=!o.length,a=[],c=0;c<i.length;c+=1){var u=t.slice();u.push(i[c]),s?a.push(u):a=a.concat(e(u,r,o))}return a}([],this.constructor,[].concat([this.items],t)))},yf=function(){this.dump(),void 0!==Kn&&Kn.exit(1)},bf=function(e){var t;t=e instanceof this.constructor?e.all():e;var r=this.items.filter((function(e){return-1===t.indexOf(e)}));return new this.constructor(r)},wf=function(e){var t=this,r=e;e instanceof this.constructor&&(r=e.all());var n={};return Object.keys(this.items).forEach((function(e){void 0!==r[e]&&r[e]===t.items[e]||(n[e]=t.items[e])})),new this.constructor(n)},Sf=function(e){var t;t=e instanceof this.constructor?e.all():e;var r=Object.keys(t),n=Object.keys(this.items).filter((function(e){return-1===r.indexOf(e)}));return new this.constructor(this.items).only(n)},Pf=function(e,t){return!this.contains(e,t)},Af=function(){return console.log(this),this};function Of(e){return Of="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Of(e)}var Ef=function(){var e=this,t=[],r={},n=function(e){return Array.isArray(e)||"object"===Of(e)?JSON.stringify(e):e};return Array.isArray(this.items)?this.items.forEach((function(e,i){var o=n(e);-1===t.indexOf(o)?t.push(o):r[i]=e})):"object"===Of(this.items)&&Object.keys(this.items).forEach((function(i){var o=n(e.items[i]);-1===t.indexOf(o)?t.push(o):r[i]=e.items[i]})),new this.constructor(r)},Rf=function(e){var t=!1;if(Array.isArray(this.items))for(var r=this.items.length,n=0;n<r&&!t;n+=1)t=!1===e(this.items[n],n,this.items);else for(var i=Object.keys(this.items),o=i.length,s=0;s<o&&!t;s+=1){var a=i[s];t=!1===e(this.items[a],a,this.items)}return this};function _f(e){return function(e){if(Array.isArray(e))return If(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return If(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return If(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function If(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var jf=function(e){return this.each((function(t,r){e.apply(void 0,_f(t).concat([r]))})),this},Tf=cf,xf=function(e){return Tf(this.items).every(e)},kf=function(e){return Array.isArray(e[0])?e[0]:e},Nf=kf,Bf=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=Nf(r);if(Array.isArray(this.items)){var o=this.items.filter((function(e){return-1===i.indexOf(e)}));return new this.constructor(o)}var s={};return Object.keys(this.items).forEach((function(t){-1===i.indexOf(t)&&(s[t]=e.items[t])})),new this.constructor(s)};function Mf(e){return Mf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mf(e)}function Df(e){if(Array.isArray(e)){if(e.length)return!1}else if(null!=e&&"object"===Mf(e)){if(Object.keys(e).length)return!1}else if(e)return!1;return!0}var Cf=function(e){var t=e||!1,r=null;return r=Array.isArray(this.items)?function(e,t){if(e)return t.filter(e);for(var r=[],n=0;n<t.length;n+=1){var i=t[n];Df(i)||r.push(i)}return r}(t,this.items):function(e,t){var r={};return Object.keys(t).forEach((function(n){e?e(t[n],n)&&(r[n]=t[n]):Df(t[n])||(r[n]=t[n])})),r}(t,this.items),new this.constructor(r)},Uf=Ld.isFunction,Ff=function(e,t){if(Uf(e)){for(var r=Object.keys(this.items),n=0;n<r.length;n+=1){var i=r[n],o=this.items[i];if(e(o,i))return o}return Uf(t)?t():t}if(Array.isArray(this.items)&&this.items.length||Object.keys(this.items).length){if(Array.isArray(this.items))return this.items[0];var s=Object.keys(this.items)[0];return this.items[s]}return Uf(t)?t():t},Lf=Ld.isFunction,qf=function(e,t,r){if(Lf(e))return this.first(e,(function(){throw new Error("Item not found.")}));var n=this.where(e,t,r);if(n.isEmpty())throw new Error("Item not found.");return n.first()},$f=function(e,t,r){return this.where(e,t,r).first()||null},Vf=function(e){return this.map(e).collapse()},zf=Ld.isArray,Hf=Ld.isObject,Yf=function(e){var t=e||1/0,r=!1,n=[],i=function(e){n=[],zf(e)?e.forEach((function(e){zf(e)?n=n.concat(e):Hf(e)?Object.keys(e).forEach((function(t){n=n.concat(e[t])})):n.push(e)})):Object.keys(e).forEach((function(t){zf(e[t])?n=n.concat(e[t]):Hf(e[t])?Object.keys(e[t]).forEach((function(r){n=n.concat(e[t][r])})):n.push(e[t])})),r=0===(r=n.filter((function(e){return Hf(e)}))).length,t-=1};for(i(this.items);!r&&t>0;)i(n);return new this.constructor(n)},Gf=function(){var e=this,t={};return Array.isArray(this.items)?Object.keys(this.items).forEach((function(r){t[e.items[r]]=Number(r)})):Object.keys(this.items).forEach((function(r){t[e.items[r]]=r})),new this.constructor(t)},Wf=function(e,t){var r=this,n={};return Array.isArray(this.items)?n=this.items.slice(e*t-t,e*t):Object.keys(this.items).slice(e*t-t,e*t).forEach((function(e){n[e]=r.items[e]})),new this.constructor(n)},Kf=function(e){return Array.isArray(this.items)?this.items.splice(e,1):delete this.items[e],this},Jf=Ld.isFunction,Zf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return void 0!==this.items[e]?this.items[e]:Jf(t)?t():null!==t?t:null},Xf=function(e,t){try{return t.split(".").reduce((function(e,t){return e[t]}),e)}catch(t){return e}},Qf=Xf,ep=Ld.isFunction,tp=function(e){var t=this,r={};return this.items.forEach((function(n,i){var o;o=ep(e)?e(n,i):Qf(n,e)||0===Qf(n,e)?Qf(n,e):"",void 0===r[o]&&(r[o]=new t.constructor([])),r[o].push(n)})),new this.constructor(r)},rp=kf,np=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=rp(r);return i.filter((function(t){return Object.hasOwnProperty.call(e.items,t)})).length===i.length},ip=function(e,t){return void 0===t?this.items.join(e):new this.constructor(this.items).pluck(e).all().join(t)},op=function(e){var t=e;e instanceof this.constructor&&(t=e.all());var r=this.items.filter((function(e){return-1!==t.indexOf(e)}));return new this.constructor(r)},sp=function(e){var t=this,r=Object.keys(e);e instanceof this.constructor&&(r=Object.keys(e.all()));var n={};return Object.keys(this.items).forEach((function(e){-1!==r.indexOf(e)&&(n[e]=t.items[e])})),new this.constructor(n)},ap=function(){return Array.isArray(this.items)?!this.items.length:!Object.keys(this.items).length},cp=function(){return!this.isEmpty()},up=function(e,t){var r=this.values();if(void 0===t)return r.implode(e);var n=r.count();if(0===n)return"";if(1===n)return r.last();var i=r.pop();return r.implode(e)+t+i},lp=Xf,hp=Ld.isFunction,dp=function(e){var t={};return hp(e)?this.items.forEach((function(r){t[e(r)]=r})):this.items.forEach((function(r){var n=lp(r,e);t[n||""]=r})),new this.constructor(t)},fp=function(){var e=Object.keys(this.items);return Array.isArray(this.items)&&(e=e.map(Number)),new this.constructor(e)},pp=Ld.isFunction,gp=function(e,t){var r=this.items;if(pp(e)&&(r=this.filter(e).all()),Array.isArray(r)&&!r.length||!Object.keys(r).length)return pp(t)?t():t;if(Array.isArray(r))return r[r.length-1];var n=Object.keys(r);return r[n[n.length-1]]},mp=function(e,t){this.constructor.prototype[e]=t},vp=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new this.constructor(e)},yp=function(e){var t=this;if(Array.isArray(this.items))return new this.constructor(this.items.map(e));var r={};return Object.keys(this.items).forEach((function(n){r[n]=e(t.items[n],n)})),new this.constructor(r)};function bp(e){return function(e){if(Array.isArray(e))return wp(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return wp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wp(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wp(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Sp=function(e){return this.map((function(t,r){return e.apply(void 0,bp(t).concat([r]))}))};function Pp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ap(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ap(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ap(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Op=function(e){var t={};return this.items.forEach((function(r,n){var i=Pp(e(r,n),2),o=i[0],s=i[1];void 0===t[o]?t[o]=[s]:t[o].push(s)})),new this.constructor(t)},Ep=function(e){return this.map((function(t,r){return new e(t,r)}))};function Rp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ip=function(e){var t={};return this.items.forEach((function(r,n){var i=Rp(e(r,n),2),o=i[0],s=i[1];void 0===t[o]?t[o]=[s]:t[o].push(s)})),new this.constructor(t)};function jp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Tp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tp(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var xp=function(e){var t=this,r={};return Array.isArray(this.items)?this.items.forEach((function(t,n){var i=jp(e(t,n),2),o=i[0],s=i[1];r[o]=s})):Object.keys(this.items).forEach((function(n){var i=jp(e(t.items[n],n),2),o=i[0],s=i[1];r[o]=s})),new this.constructor(r)};function kp(e){return function(e){if(Array.isArray(e))return Np(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Np(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Np(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Np(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Bp=function(e){if("string"==typeof e){var t=this.items.filter((function(t){return void 0!==t[e]}));return Math.max.apply(Math,kp(t.map((function(t){return t[e]}))))}return Math.max.apply(Math,kp(this.items))},Mp=function(e){var t=this.items.length;return void 0===e?t%2==0?(this.items[t/2-1]+this.items[t/2])/2:this.items[Math.floor(t/2)]:t%2==0?(this.items[t/2-1][e]+this.items[t/2][e])/2:this.items[Math.floor(t/2)][e]},Dp=function(e){var t=e;if("string"==typeof t&&(t=[t]),Array.isArray(this.items)&&Array.isArray(t))return new this.constructor(this.items.concat(t));var r=JSON.parse(JSON.stringify(this.items));return Object.keys(t).forEach((function(e){r[e]=t[e]})),new this.constructor(r)};function Cp(e){return Cp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cp(e)}function Up(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Fp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Up(Object(r),!0).forEach((function(t){Lp(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Up(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Lp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var qp=function(e){var t=function e(t,r){var n={};return Object.keys(Fp(Fp({},t),r)).forEach((function(i){void 0===t[i]&&void 0!==r[i]?n[i]=r[i]:void 0!==t[i]&&void 0===r[i]?n[i]=t[i]:void 0!==t[i]&&void 0!==r[i]&&(t[i]===r[i]?n[i]=t[i]:Array.isArray(t[i])||"object"!==Cp(t[i])||Array.isArray(r[i])||"object"!==Cp(r[i])?n[i]=[].concat(t[i],r[i]):n[i]=e(t[i],r[i]))})),n};return e?"Collection"===e.constructor.name?new this.constructor(t(this.items,e.all())):new this.constructor(t(this.items,e)):this};function $p(e){return function(e){if(Array.isArray(e))return Vp(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Vp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vp(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vp(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var zp=function(e){if(void 0!==e){var t=this.items.filter((function(t){return void 0!==t[e]}));return Math.min.apply(Math,$p(t.map((function(t){return t[e]}))))}return Math.min.apply(Math,$p(this.items))},Hp=function(e){var t=[],r=1;return this.items.length?(this.items.forEach((function(n){var i=t.filter((function(t){return void 0!==e?t.key===n[e]:t.key===n}));if(i.length){i[0].count+=1;var o=i[0].count;o>r&&(r=o)}else void 0!==e?t.push({key:n[e],count:1}):t.push({key:n,count:1})})),t.filter((function(e){return e.count===r})).map((function(e){return e.key}))):null},Yp=cf,Gp=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Yp(this.items).slice(t).filter((function(t,r){return r%e==0}));return new this.constructor(r)},Wp=kf,Kp=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=Wp(r);if(Array.isArray(this.items)){var o=this.items.filter((function(e){return-1!==i.indexOf(e)}));return new this.constructor(o)}var s={};return Object.keys(this.items).forEach((function(t){-1!==i.indexOf(t)&&(s[t]=e.items[t])})),new this.constructor(s)},Jp=tf,Zp=function(e,t){var r=Math.abs(e),n=this.count();if(r<=n)return this;for(var i=r-n,o=Jp(this.items),s=Array.isArray(this.items),a=e<0,c=0;c<i;)s?a?o.unshift(t):o.push(t):void 0!==o[c]?i+=1:o[c]=t,c+=1;return new this.constructor(o)},Xp=function(e){var t,r=this;return Array.isArray(this.items)?(t=[new this.constructor([]),new this.constructor([])],this.items.forEach((function(r){!0===e(r)?t[0].push(r):t[1].push(r)}))):(t=[new this.constructor({}),new this.constructor({})],Object.keys(this.items).forEach((function(n){var i=r.items[n];!0===e(i)?t[0].put(n,i):t[1].put(n,i)}))),new this.constructor(t)},Qp=function(e){return e(this)},eg=Ld.isArray,tg=Ld.isObject,rg=Xf,ng=function(e,t){if(-1!==e.indexOf("*")){var r=(l=this.items,h={},l.forEach((function(e,t){!function e(t,r){tg(t)?Object.keys(t).forEach((function(n){e(t[n],"".concat(r,".").concat(n))})):eg(t)&&t.forEach((function(t,n){e(t,"".concat(r,".").concat(n))})),h[r]=t}(e,t)})),h),n=[];if(void 0!==t){var i=new RegExp("0.".concat(t),"g"),o="0.".concat(t).split(".").length;Object.keys(r).forEach((function(e){var t=e.match(i);if(t){var s=t[0];s.split(".").length===o&&n.push(r[s])}}))}var s=[],a=new RegExp("0.".concat(e),"g"),c="0.".concat(e).split(".").length;if(Object.keys(r).forEach((function(e){var t=e.match(a);if(t){var n=t[0];n.split(".").length===c&&s.push(r[n])}})),void 0!==t){var u={};return this.items.forEach((function(e,t){u[n[t]||""]=s})),new this.constructor(u)}return new this.constructor([s])}var l,h;if(void 0!==t){var d={};return this.items.forEach((function(r){void 0!==rg(r,e)?d[r[t]||""]=rg(r,e):d[r[t]||""]=null})),new this.constructor(d)}return this.map((function(t){return void 0!==rg(t,e)?rg(t,e):null}))},ig=kf,og=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];ig(r).forEach((function(t){delete e[t]}))},sg=Ld.isArray,ag=Ld.isObject,cg=og,ug=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.isEmpty())return null;if(sg(this.items))return 1===t?this.items.pop():new this.constructor(this.items.splice(-t));if(ag(this.items)){var r=Object.keys(this.items);if(1===t){var n=r[r.length-1],i=this.items[n];return cg(this.items,n),i}var o=r.slice(-t),s=o.reduce((function(t,r){return t[r]=e.items[r],t}),{});return cg(this.items,o),new this.constructor(s)}return null},lg=function(e,t){return void 0!==t?this.put(t,e):(this.items.unshift(e),this)},hg=Ld.isFunction,dg=function(e,t){var r=this.items[e]||null;return r||void 0===t||(r=hg(t)?t():t),delete this.items[e],r},fg=function(){var e;return(e=this.items).push.apply(e,arguments),this},pg=function(e,t){return this.items[e]=t,this},gg=cf,mg=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=gg(this.items),r=new this.constructor(t).shuffle();return e!==parseInt(e,10)?r.first():r.take(e)},vg=function(e,t){var r=this,n=null;return void 0!==t&&(n=t),Array.isArray(this.items)?this.items.forEach((function(t){n=e(n,t)})):Object.keys(this.items).forEach((function(t){n=e(n,r.items[t],t)})),n},yg=function(e){return new this.constructor(this.items).filter((function(t){return!e(t)}))};function bg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function wg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bg(Object(r),!0).forEach((function(t){Sg(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bg(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Sg(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Pg=function(e){if(!e)return this;if(Array.isArray(e)){var t=this.items.map((function(t,r){return e[r]||t}));return new this.constructor(t)}if("Collection"===e.constructor.name){var r=wg(wg({},this.items),e.all());return new this.constructor(r)}var n=wg(wg({},this.items),e);return new this.constructor(n)};function Ag(e){return Ag="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ag(e)}function Og(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Eg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Og(Object(r),!0).forEach((function(t){Rg(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Og(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Rg(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _g=function(e){var t=function e(t,r){var n=Eg({},t);return Object.keys(Eg(Eg({},t),r)).forEach((function(i){Array.isArray(r[i])||"object"!==Ag(r[i])?void 0===t[i]&&void 0!==r[i]?"object"===Ag(t[i])?n[i]=Eg({},r[i]):n[i]=r[i]:void 0!==t[i]&&void 0===r[i]?"object"===Ag(t[i])?n[i]=Eg({},t[i]):n[i]=t[i]:void 0!==t[i]&&void 0!==r[i]&&("object"===Ag(r[i])?n[i]=Eg({},r[i]):n[i]=r[i]):n[i]=e(t[i],r[i])})),n};return e?Array.isArray(e)||"object"===Ag(e)?"Collection"===e.constructor.name?new this.constructor(t(this.items,e.all())):new this.constructor(t(this.items,e)):new this.constructor(t(this.items,[e])):this},Ig=function(){var e=[].concat(this.items).reverse();return new this.constructor(e)},jg=Ld.isArray,Tg=Ld.isObject,xg=Ld.isFunction,kg=function(e,t){var r,n=this,i=function(r,i){return xg(e)?e(n.items[i],i):t?n.items[i]===e:n.items[i]==e};return jg(this.items)?r=this.items.findIndex(i):Tg(this.items)&&(r=Object.keys(this.items).find((function(e){return i(n.items[e],e)}))),!(void 0===r||r<0)&&r},Ng=Ld.isArray,Bg=Ld.isObject,Mg=og,Dg=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.isEmpty())return null;if(Ng(this.items))return 1===t?this.items.shift():new this.constructor(this.items.splice(0,t));if(Bg(this.items)){if(1===t){var r=Object.keys(this.items)[0],n=this.items[r];return delete this.items[r],n}var i=Object.keys(this.items).slice(0,t),o=i.reduce((function(t,r){return t[r]=e.items[r],t}),{});return Mg(this.items,i),new this.constructor(o)}return null},Cg=cf,Ug=function(){var e,t,r,n=Cg(this.items);for(r=n.length;r;r-=1)e=Math.floor(Math.random()*r),t=n[r-1],n[r-1]=n[e],n[e]=t;return this.items=n,this},Fg=Ld.isObject,Lg=function(e){var t=this;return Fg(this.items)?new this.constructor(Object.keys(this.items).reduce((function(r,n,i){return i+1>e&&(r[n]=t.items[n]),r}),{})):new this.constructor(this.items.slice(e))},qg=Ld.isArray,$g=Ld.isObject,Vg=Ld.isFunction,zg=function(e){var t,r=this,n=null,i=function(t){return t===e};return Vg(e)&&(i=e),qg(this.items)&&(t=this.items.filter((function(e){return!0!==n&&(n=i(e)),n}))),$g(this.items)&&(t=Object.keys(this.items).reduce((function(e,t){return!0!==n&&(n=i(r.items[t])),!1!==n&&(e[t]=r.items[t]),e}),{})),new this.constructor(t)},Hg=Ld.isArray,Yg=Ld.isObject,Gg=Ld.isFunction,Wg=function(e){var t,r=this,n=null,i=function(t){return t===e};return Gg(e)&&(i=e),Hg(this.items)&&(t=this.items.filter((function(e){return!0!==n&&(n=!i(e)),n}))),Yg(this.items)&&(t=Object.keys(this.items).reduce((function(e,t){return!0!==n&&(n=!i(r.items[t])),!1!==n&&(e[t]=r.items[t]),e}),{})),new this.constructor(t)},Kg=function(e,t){var r=this.items.slice(e);return void 0!==t&&(r=r.slice(0,t)),new this.constructor(r)},Jg=Ld.isFunction,Zg=function(e,t,r){var n;if((n=Jg(e)?this.filter(e):this.where(e,t,r)).isEmpty())throw new Error("Item not found.");if(n.count()>1)throw new Error("Multiple items found.");return n.first()},Xg=ff,Qg=function(e){var t=[].concat(this.items);return void 0===e?this.every((function(e){return"number"==typeof e}))?t.sort((function(e,t){return e-t})):t.sort():t.sort(e),new this.constructor(t)},em=function(){return this.sort().reverse()},tm=Xf,rm=Ld.isFunction,nm=function(e){var t=[].concat(this.items),r=function(t){return rm(e)?e(t):tm(t,e)};return t.sort((function(e,t){var n=r(e),i=r(t);return null==n?1:null==i||n<i?-1:n>i?1:0})),new this.constructor(t)},im=function(e){return this.sortBy(e).reverse()},om=function(){var e=this,t={};return Object.keys(this.items).sort().forEach((function(r){t[r]=e.items[r]})),new this.constructor(t)},sm=function(){var e=this,t={};return Object.keys(this.items).sort().reverse().forEach((function(r){t[r]=e.items[r]})),new this.constructor(t)},am=function(e,t,r){var n=this.slice(e,t);if(this.items=this.diff(n.all()).all(),Array.isArray(r))for(var i=0,o=r.length;i<o;i+=1)this.items.splice(e+i,0,r[i]);return n},cm=function(e){for(var t=Math.round(this.items.length/e),r=JSON.parse(JSON.stringify(this.items)),n=[],i=0;i<e;i+=1)n.push(new this.constructor(r.splice(0,t)));return new this.constructor(n)},um=cf,lm=Ld.isFunction,hm=function(e){var t=um(this.items),r=0;if(void 0===e)for(var n=0,i=t.length;n<i;n+=1)r+=parseFloat(t[n]);else if(lm(e))for(var o=0,s=t.length;o<s;o+=1)r+=parseFloat(e(t[o]));else for(var a=0,c=t.length;a<c;a+=1)r+=parseFloat(t[a][e]);return parseFloat(r.toPrecision(12))};function dm(e){return dm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dm(e)}var fm=function(e){var t=this;if(!Array.isArray(this.items)&&"object"===dm(this.items)){var r,n=Object.keys(this.items);r=e<0?n.slice(e):n.slice(0,e);var i={};return n.forEach((function(e){-1!==r.indexOf(e)&&(i[e]=t.items[e])})),new this.constructor(i)}return e<0?new this.constructor(this.items.slice(e)):new this.constructor(this.items.slice(0,e))},pm=Ld.isArray,gm=Ld.isObject,mm=Ld.isFunction,vm=function(e){var t,r=this,n=null,i=function(t){return t===e};return mm(e)&&(i=e),pm(this.items)&&(t=this.items.filter((function(e){return!1!==n&&(n=!i(e)),n}))),gm(this.items)&&(t=Object.keys(this.items).reduce((function(e,t){return!1!==n&&(n=!i(r.items[t])),!1!==n&&(e[t]=r.items[t]),e}),{})),new this.constructor(t)},ym=Ld.isArray,bm=Ld.isObject,wm=Ld.isFunction,Sm=function(e){var t,r=this,n=null,i=function(t){return t===e};return wm(e)&&(i=e),ym(this.items)&&(t=this.items.filter((function(e){return!1!==n&&(n=i(e)),n}))),bm(this.items)&&(t=Object.keys(this.items).reduce((function(e,t){return!1!==n&&(n=i(r.items[t])),!1!==n&&(e[t]=r.items[t]),e}),{})),new this.constructor(t)},Pm=function(e){return e(this),this},Am=function(e,t){for(var r=1;r<=e;r+=1)this.items.push(t(r));return this},Om=function(){var e=this.constructor;function t(r,n){var i=[];r instanceof e?(r.items.forEach((function(e){return t(e,i)})),n.push(i)):Array.isArray(r)?(r.forEach((function(e){return t(e,i)})),n.push(i)):n.push(r)}if(Array.isArray(this.items)){var r=[];return this.items.forEach((function(e){t(e,r)})),r}return this.values().all()};function Em(e){return Em="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Em(e)}var Rm=function(){return"object"!==Em(this.items)||Array.isArray(this.items)?JSON.stringify(this.toArray()):JSON.stringify(this.all())},_m=function(e){var t=this;if(Array.isArray(this.items))this.items=this.items.map(e);else{var r={};Object.keys(this.items).forEach((function(n){r[n]=e(t.items[n],n)})),this.items=r}return this};function Im(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jm(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Im(Object(r),!0).forEach((function(t){Tm(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Im(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Tm(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var xm=function(){var e=this;if(Array.isArray(this.items))return this;var t={};return Object.keys(this.items).forEach((function(r){if(-1!==r.indexOf(".")){var n=t;r.split(".").reduce((function(t,n,i,o){return t[n]||(t[n]={}),i===o.length-1&&(t[n]=e.items[r]),t[n]}),n),t=jm(jm({},t),n)}else t[r]=e.items[r]})),new this.constructor(t)},km=function(e,t,r){e?r(this):t(this)},Nm=function(e,t){if(Array.isArray(this.items)&&this.items.length)return e(this);if(Object.keys(this.items).length)return e(this);if(void 0!==t){if(Array.isArray(this.items)&&!this.items.length)return t(this);if(!Object.keys(this.items).length)return t(this)}return this},Bm=function(e,t){if(Array.isArray(this.items)&&!this.items.length)return e(this);if(!Object.keys(this.items).length)return e(this);if(void 0!==t){if(Array.isArray(this.items)&&this.items.length)return t(this);if(Object.keys(this.items).length)return t(this)}return this},Mm=function(e){var t=this,r=JSON.parse(JSON.stringify(this.items));return Object.keys(e).forEach((function(n){void 0===t.items[n]&&(r[n]=e[n])})),new this.constructor(r)},Dm=Ld.isFunction,Cm=function(e){var t;if(void 0===e)t=this.items.filter((function(e,t,r){return r.indexOf(e)===t}));else{t=[];for(var r=[],n=0,i=this.items.length;n<i;n+=1){var o=void 0;o=Dm(e)?e(this.items[n]):this.items[n][e],-1===r.indexOf(o)&&(t.push(this.items[n]),r.push(o))}}return new this.constructor(t)},Um=function(e){return e instanceof this.constructor?e.all():e},Fm=cf,Lm=function(){return new this.constructor(Fm(this.items))},qm=function(e,t,r){return e?t(this,e):r?r(this,e):this},$m=cf,Vm=Xf,zm=function(e,t,r){var n=t,i=r,o=$m(this.items);if(void 0===t||!0===t)return new this.constructor(o.filter((function(t){return Vm(t,e)})));if(!1===t)return new this.constructor(o.filter((function(t){return!Vm(t,e)})));void 0===r&&(i=t,n="===");var s=o.filter((function(t){switch(n){case"==":return Vm(t,e)===Number(i)||Vm(t,e)===i.toString();default:case"===":return Vm(t,e)===i;case"!=":case"<>":return Vm(t,e)!==Number(i)&&Vm(t,e)!==i.toString();case"!==":return Vm(t,e)!==i;case"<":return Vm(t,e)<i;case"<=":return Vm(t,e)<=i;case">":return Vm(t,e)>i;case">=":return Vm(t,e)>=i}}));return new this.constructor(s)},Hm=function(e,t){return this.where(e,">=",t[0]).where(e,"<=",t[t.length-1])},Ym=cf,Gm=Xf,Wm=function(e,t){var r=Ym(t),n=this.items.filter((function(t){return-1!==r.indexOf(Gm(t,e))}));return new this.constructor(n)},Km=function(e){return this.filter((function(t){return t instanceof e}))},Jm=Xf,Zm=function(e,t){return this.filter((function(r){return Jm(r,e)<t[0]||Jm(r,e)>t[t.length-1]}))},Xm=cf,Qm=Xf,ev=function(e,t){var r=Xm(t),n=this.items.filter((function(t){return-1===r.indexOf(Qm(t,e))}));return new this.constructor(n)},tv=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.where(e,"===",null)},rv=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.where(e,"!==",null)};function nv(e){return nv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nv(e)}var iv,ov,sv=function(e){return e instanceof this.constructor?e:"object"===nv(e)?new this.constructor(e):new this.constructor([e])},av=function(e){var t=this,r=e;r instanceof this.constructor&&(r=r.all());var n=this.items.map((function(e,n){return new t.constructor([e,r[n]])}));return new this.constructor(n)};!function(e){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e){void 0===e||Array.isArray(e)||"object"===t(e)?e instanceof this.constructor?this.items=e.all():this.items=e||[]:this.items=[e]}var n=Cd;"undefined"!=typeof Symbol&&(r.prototype[Symbol.iterator]=n),r.prototype.toJSON=function(){return this.items},r.prototype.all=Ud,r.prototype.average=$d,r.prototype.avg=Vd,r.prototype.chunk=Hd,r.prototype.collapse=Wd,r.prototype.combine=Xd,r.prototype.concat=of,r.prototype.contains=ff,r.prototype.containsOneItem=pf,r.prototype.count=gf,r.prototype.countBy=mf,r.prototype.crossJoin=vf,r.prototype.dd=yf,r.prototype.diff=bf,r.prototype.diffAssoc=wf,r.prototype.diffKeys=Sf,r.prototype.doesntContain=Pf,r.prototype.dump=Af,r.prototype.duplicates=Ef,r.prototype.each=Rf,r.prototype.eachSpread=jf,r.prototype.every=xf,r.prototype.except=Bf,r.prototype.filter=Cf,r.prototype.first=Ff,r.prototype.firstOrFail=qf,r.prototype.firstWhere=$f,r.prototype.flatMap=Vf,r.prototype.flatten=Yf,r.prototype.flip=Gf,r.prototype.forPage=Wf,r.prototype.forget=Kf,r.prototype.get=Zf,r.prototype.groupBy=tp,r.prototype.has=np,r.prototype.implode=ip,r.prototype.intersect=op,r.prototype.intersectByKeys=sp,r.prototype.isEmpty=ap,r.prototype.isNotEmpty=cp,r.prototype.join=up,r.prototype.keyBy=dp,r.prototype.keys=fp,r.prototype.last=gp,r.prototype.macro=mp,r.prototype.make=vp,r.prototype.map=yp,r.prototype.mapSpread=Sp,r.prototype.mapToDictionary=Op,r.prototype.mapInto=Ep,r.prototype.mapToGroups=Ip,r.prototype.mapWithKeys=xp,r.prototype.max=Bp,r.prototype.median=Mp,r.prototype.merge=Dp,r.prototype.mergeRecursive=qp,r.prototype.min=zp,r.prototype.mode=Hp,r.prototype.nth=Gp,r.prototype.only=Kp,r.prototype.pad=Zp,r.prototype.partition=Xp,r.prototype.pipe=Qp,r.prototype.pluck=ng,r.prototype.pop=ug,r.prototype.prepend=lg,r.prototype.pull=dg,r.prototype.push=fg,r.prototype.put=pg,r.prototype.random=mg,r.prototype.reduce=vg,r.prototype.reject=yg,r.prototype.replace=Pg,r.prototype.replaceRecursive=_g,r.prototype.reverse=Ig,r.prototype.search=kg,r.prototype.shift=Dg,r.prototype.shuffle=Ug,r.prototype.skip=Lg,r.prototype.skipUntil=zg,r.prototype.skipWhile=Wg,r.prototype.slice=Kg,r.prototype.sole=Zg,r.prototype.some=Xg,r.prototype.sort=Qg,r.prototype.sortDesc=em,r.prototype.sortBy=nm,r.prototype.sortByDesc=im,r.prototype.sortKeys=om,r.prototype.sortKeysDesc=sm,r.prototype.splice=am,r.prototype.split=cm,r.prototype.sum=hm,r.prototype.take=fm,r.prototype.takeUntil=vm,r.prototype.takeWhile=Sm,r.prototype.tap=Pm,r.prototype.times=Am,r.prototype.toArray=Om,r.prototype.toJson=Rm,r.prototype.transform=_m,r.prototype.undot=xm,r.prototype.unless=km,r.prototype.unlessEmpty=Nm,r.prototype.unlessNotEmpty=Bm,r.prototype.union=Mm,r.prototype.unique=Cm,r.prototype.unwrap=Um,r.prototype.values=Lm,r.prototype.when=qm,r.prototype.whenEmpty=Bm,r.prototype.whenNotEmpty=Nm,r.prototype.where=zm,r.prototype.whereBetween=Hm,r.prototype.whereIn=Wm,r.prototype.whereInstanceOf=Km,r.prototype.whereNotBetween=Zm,r.prototype.whereNotIn=ev,r.prototype.whereNull=tv,r.prototype.whereNotNull=rv,r.prototype.wrap=sv,r.prototype.zip=av;var i=function(e){return new r(e)};e.exports=i,e.exports.collect=i,e.exports.default=i,e.exports.Collection=r}({get exports(){return Dd},set exports(e){Dd=e}});class cv{items=new Map;add(e){const t=this.beforeAdd(e);this.items.set(t.id,t)}getById(e){return this.items.get(e)}getByField(e,t){return this.getAll().where(e,"==",t)}updateItemInfo(e,t){const r=this.items.get(e);r&&this.items?.set(e,{...r,...t})}getAll(){return Dd([...this.items.values()])}}class uv extends cv{beforeAdd(e){if(e.providerName)return e;const t=this.getById(e.id);return{id:e.id,providerName:t?.providerName||"unknown"}}}!function(e){e.Pending="pending",e.Finished="finished",e.Rejected="rejected"}(iv||(iv={}));class lv extends cv{beforeAdd(e){return{...e,stopTime:0,retriesCount:0,status:iv.Pending}}retry(e,t){this.updateItemInfo(e,{retriesCount:t})}reject(e,t,r){this.updateItemInfo(e,{stopTime:t,reason:r,status:iv.Rejected})}finish(e,t){this.updateItemInfo(e,{stopTime:t,status:iv.Finished})}getByAgreementId(e){return this.getByField("agreementId",e)}}class hv extends cv{beforeAdd(e){return{...e,amount:parseFloat(e.amount)}}getByProviderId(e){return this.getByField("providerId",e)}getByAgreementId(e){return this.getByField("agreementId",e)}}!function(e){e.Pending="pending",e.Confirmed="confirmed",e.Rejected="rejected"}(ov||(ov={}));class dv extends cv{beforeAdd(e){return{...e,status:ov.Pending}}confirm(e){this.updateItemInfo(e,{status:ov.Confirmed})}reject(e){this.updateItemInfo(e,{status:ov.Rejected})}getByProviderId(e){return this.getByField("providerId",e)}getByProposalId(e){return this.getByField("proposalId",e).first()}getByStatus(e){return this.getByField("status",e)}}class fv extends cv{beforeAdd(e){return{...e,amount:parseFloat(e.amount)}}getByProviderId(e){return this.getByField("providerId",e)}getByAgreementId(e){return this.getByField("agreementId",e)}}class pv extends cv{beforeAdd(e){return e}getByProviderId(e){return this.getByField("providerId",e)}}class gv extends cv{beforeAdd(e){return e}}class mv extends cv{beforeAdd(e){return e}getByTaskId(e){return this.getByField("taskId",e)}getByAgreementId(e){return this.getByField("agreementId",e)}}class vv extends cv{beforeAdd({id:e,startTime:t,stopTime:r}){return{id:e,stopTime:r||0,startTime:t,duration:r?r-t:0}}stop({id:e,stopTime:t}){const r=this.items.get(e);this.updateItemInfo(e,{stopTime:t,duration:r?.startTime?t-r.startTime:0})}}class yv{eventTarget;logger;allocations;agreements;activities;invoices;proposals;providers;payments;tasks;times;constructor(e){this.eventTarget=e.eventTarget,this.logger=e.logger,this.allocations=new gv,this.activities=new mv,this.agreements=new dv,this.invoices=new fv,this.proposals=new pv,this.providers=new uv,this.payments=new hv,this.tasks=new lv,this.times=new vv}async run(){this.eventTarget.addEventListener(go,(e=>this.handleEvents(e))),this.logger?.debug("Stats service has started")}async end(){this.eventTarget.removeEventListener(go,null),this.logger?.debug("Stats service has stopped")}getAllCostsSummary(){return this.agreements.getAll().map((e=>{const t=this.providers.getById(e.providerId),r=this.tasks.getByAgreementId(e.id),n=this.invoices.getByAgreementId(e.id),i=this.payments.getByAgreementId(e.id);return{Agreement:e.id.substring(0,10),"Provider Name":t?t.providerName:"unknown","Task Computed":r.where("status","finished").count(),Cost:n.sum("amount"),"Payment Status":i.count()>0?"paid":"unpaid"}})).all()}getAllCosts(){const e={total:0,paid:0};return this.agreements.getAll().all().forEach((t=>{const r=this.invoices.getByAgreementId(t.id),n=this.payments.getByAgreementId(t.id);e.total+=r.sum("amount"),e.paid+=n.count()>0?r.sum("amount"):0})),e}getComputationTime(){const e=this.times.getById("all")?.duration;return`${e?(e/1e3).toFixed(1):0}s`}getStatsTree(){return{allocations:this.allocations.getAll().map((e=>e)).all(),providers:this.providers.getAll().map((e=>({...e,proposals:this.proposals.getByProviderId(e.id).map((e=>{const t=this.agreements.getByProposalId(e.id);return{...e,agreement:t?{...t,activities:this.activities.getByAgreementId(t.id).map((e=>({...e,task:this.tasks.getById(e.taskId)}))).all(),invoices:this.invoices.getByAgreementId(t.id).map((e=>e)).all(),payments:this.payments.getByAgreementId(t.id).map((e=>e)).all()}:null}})).all()}))).all()}}handleEvents(e){e instanceof yo?this.times.add({id:"all",startTime:e.timeStamp}):e instanceof bo?this.times.stop({id:"all",stopTime:e.timeStamp}):e instanceof So?(this.activities.add({id:e.detail.activityId,taskId:e.detail.id,agreementId:e.detail.agreementId}),this.tasks.add({id:e.detail.id,startTime:e.timeStamp,agreementId:e.detail.agreementId})):e instanceof Po?this.tasks.retry(e.detail.id,e.detail.retriesCount):e instanceof Ao?this.tasks.reject(e.detail.id,e.timeStamp,e.detail.reason):e instanceof Oo?this.tasks.finish(e.detail.id,e.timeStamp):e instanceof Eo?this.allocations.add({id:e.detail.id,amount:e.detail.amount,platform:e.detail.platform}):e instanceof ko?(this.agreements.add({id:e.detail.id,providerId:e.detail.providerId,proposalId:e.detail.proposalId}),this.providers.add({id:e.detail.providerId,providerName:e.detail.providerName})):e instanceof No?this.agreements.confirm(e.detail.id):e instanceof Bo?this.agreements.reject(e.detail.id):e instanceof jo?(this.proposals.add({id:e.detail.id,providerId:e.detail.providerId}),this.providers.add({id:e.detail.providerId})):e instanceof Do?this.invoices.add({id:e.detail.id,providerId:e.detail.providerId,agreementId:e.detail.agreementId,amount:e.detail.amount}):e instanceof Uo&&this.payments.add({id:e.detail.id,providerId:e.detail.providerId,agreementId:e.detail.agreementId,amount:e.detail.amount})}}class bv{options;marketService;agreementPoolService;taskService;paymentService;networkService;statsService;initWorker;taskQueue;storageProvider;logger;lastTaskIndex=0;isRunning=!0;static async create(e){const t=new bv(e);return await t.init(),t}constructor(e){const t="string"==typeof e?{package:e}:e;this.options=new Md(t),this.logger=this.options.logger,this.taskQueue=new Vl,this.agreementPoolService=new ss(this.options),this.paymentService=new bh(this.options),this.marketService=new po(this.agreementPoolService,this.options),this.networkService=this.options.networkIp?new Nd(this.options):void 0,this.storageProvider=$t?new Ut(this.logger):void 0,this.taskService=new Ll(this.taskQueue,this.agreementPoolService,this.paymentService,this.networkService,{...this.options,storageProvider:this.storageProvider}),this.statsService=new yv(this.options)}async init(){const e="string"==typeof this.options.package?await this.createPackage(this.options.package):this.options.package;this.logger?.debug("Initializing task executor services...");const t=await this.paymentService.createAllocations();this.marketService.run(e,t).catch((e=>this.handleCriticalError(e))),this.agreementPoolService.run().catch((e=>this.handleCriticalError(e))),this.paymentService.run().catch((e=>this.handleCriticalError(e))),this.taskService.run().catch((e=>this.handleCriticalError(e))),this.networkService?.run().catch((e=>this.handleCriticalError(e))),this.statsService.run().catch((e=>this.handleCriticalError(e))),this.storageProvider?.init().catch((e=>this.handleCriticalError(e))),$t&&this.handleCancelEvent(),this.options.eventTarget.dispatchEvent(new yo),this.logger?.info(`Task Executor has started using subnet: ${this.options.subnetTag}, network: ${this.options.payment?.network}, driver: ${this.options.payment?.driver}`)}async end(){this.isRunning&&(this.isRunning=!1,await(this.networkService?.end()),await this.taskService.end(),await this.agreementPoolService.end(),await this.marketService.end(),await this.paymentService.end(),this.storageProvider?.close(),this.options.eventTarget?.dispatchEvent(new bo),this.printStats(),await this.statsService.end(),this.logger?.info("Task Executor has shut down"))}getStats(){return this.statsService.getStatsTree()}beforeEach(e){this.initWorker=e}async run(e){return this.executeTask(e).catch((async e=>{await this.handleCriticalError(e)}))}map(e,t){const r=[...e],n=r.map((e=>this.executeTask(t,e))),i=[];let o=0;n.forEach((e=>e.then((e=>{i.push(e)})).catch((e=>this.handleCriticalError(e)))));const s=()=>this.isRunning;return{[Symbol.asyncIterator]:()=>({async next(){if(o===r.length)return Promise.resolve({done:!0,value:void 0});for(;0===i.length&&o<r.length&&s();)await Ct(1e3,!0);return s()?(o+=1,Promise.resolve({done:!1,value:i.pop()})):Promise.resolve({done:!0,value:void 0})}})}}async forEach(e,t){await Promise.all([...e].map((e=>this.executeTask(t,e)))).catch((e=>this.handleCriticalError(e)))}async createPackage(e){return Zt.create({...this.options.packageOptions,imageHash:e})}async executeTask(e,t){const r=new $l((++this.lastTaskIndex).toString(),e,t,this.initWorker);this.taskQueue.addToEnd(r);let n=!1;const i=setTimeout((()=>n=!0),this.options.taskTimeout);for(;!n&&this.isRunning;){if(r.isFinished()){if(clearTimeout(i),r.isRejected())throw r.getError();return r.getResults()}await Ct(2e3,!0)}if(clearTimeout(i),n){const e=new Error(`Task ${r.id} timeout.`);throw r.stop(void 0,e),e}}handleCriticalError(e){this.options.eventTarget?.dispatchEvent(new wo({reason:e.toString()})),this.logger?.error(e.toString()),this.logger?.debug(e.stack),this.isRunning&&this.logger?.warn("Trying to stop executor..."),this.end().catch((e=>{this.logger?.error(e),process?.exit(1)}))}handleCancelEvent(){const e=["SIGINT","SIGTERM","SIGBREAK","SIGHUP"],t=async()=>{e.forEach((e=>process.off(e,t))),this.logger?.warn("Executor has interrupted by the user. Stopping all tasks..."),await this.end().catch((e=>{this.logger?.error(e),process.exit(1)}))};e.forEach((e=>process.on(e,t)))}printStats(){const e=this.statsService.getAllCosts(),t=this.statsService.getAllCostsSummary(),r=this.statsService.getComputationTime(),n=new Set(t.map((e=>e["Provider Name"]))).size;this.logger?.info(`Computation finished in ${r}`),this.logger?.info(`Negotiated ${t.length} agreements with ${n} providers`),t.length&&this.logger?.table?.(t),this.logger?.info(`Total Cost: ${e.total} Total Paid: ${e.paid}`)}}var wv=Object.freeze({__proto__:null,default:{}});export{hh as Accounts,Bl as Activity,Nl as ActivityStateEnum,os as Agreement,is as AgreementStateEnum,lh as Allocation,Lt as ConsoleLogger,ph as DebitNote,yh as DebitNoteEvent,Go as Demand,Wo as DemandEvent,Yo as DemandEventType,Yl as Deploy,fh as Invoice,vh as InvoiceEvent,Zt as Package,gh as PaymentEventType,mh as Payments,Ho as Proposal,Wl as Run,zl as Script,Gl as Start,bv as TaskExecutor};
